var Modal=function(e,t){let r=this;this.title=e.title||"",this.content=e.content||"",this.size=e.size||"modal-md",this.noModalBodyPadding=e.noModalBodyPadding||!1,this.modalOptions=t||{},this.modalOptions.backdrop="static",this.afterClose=e.afterClose||null,this.afterShown=e.afterShown||null,this.unClosable=e.unClosable||!1;let n=jQuery("#modal"),o=jQuery("#modalHeaderTitle"),a=jQuery("#modalContent");n.off("hidden.bs.modal"),this.resetModalContent=function(){o.html(""),a.html(""),n.find(".modal-body").removeClass("no-padding"),n.find("button.close").show()},this.resetModalContent(),this.noModalBodyPadding&&n.find(".modal-body").addClass("no-padding"),o.html(this.title),a.html(this.content),n.modal(this.modalOptions),this.unClosable&&(n.off("keydown.dismiss.bs.modal"),n.find("button.close").hide()),jQuery("#modal .modal-dialog").removeClass("modal-md").addClass(this.size),jQuery("#modal .modal-dialog").removeClass("modal-fullscreen").addClass(this.size),null!==this.afterClose&&n.on("hidden.bs.modal",function(){"function"==typeof r.afterClose&&r.afterClose()}),n.on("shown.bs.modal",function(){$(":input").inputmask(),"function"==typeof r.afterShown&&r.afterShown()})};const CATEGORY_LOGIN=1,ACTION_LOGIN_INSTALL_METAMASK=11,ACTION_LOGIN_CREATE_ADDRESS=12,ACTION_LOGIN_IMPORT_ADDRESS=13,ACTION_LOGIN_LOGIN_METAMASK=14,CATEGORY_TRANSFER=2,ACTION_TRANSFER_DEPOSIT=21,ACTION_TRANSFER_WITHDRAW=22,CATEGORY_INFORMATION=3,ACTION_INFORMATION_ABOUT_FEES=31,CATEGORY_CLICK=4,ACTION_CLICK_NEW_ORDER=41,ACTION_CLICK_GO_TO_TRADE=42,ACTION_CLICK_DOWNLOAD_METAMASK=43,ACTION_CLICK_IMPORT_ADDRESS=44,ACTION_CLICK_CREATE_ADDRESS=45,ACTION_CLICK_MYBALANCE_ONOFF=46,ACTION_CLICK_DEPOSIT=47,ACTION_CLICK_WITHDRAW=48,ACTION_CLICK_FIAT=49,ACTION_CLICK_BALANCE_TRADE=411,ACTION_CLICK_ORDERBOOK_TRADE=412,CATEGORY_EXCHANGE_ACTION=5,ACTION_EXCHANGE_ACTION_PLACE_ORDER=51,ACTION_EXCHANGE_ACTION_MAKE_TRADE=52;var DexTracking=function(){this.ga={43:{eventCategory:"button",eventAction:"metamask"},13:{eventCategory:"button",eventAction:"import",eventLabel:"create"},44:{eventCategory:"button",eventAction:"import",eventLabel:"dropdown"},12:{eventCategory:"button",eventAction:"import",eventLabel:"create"},45:{eventCategory:"button",eventAction:"new",eventLabel:"button"},46:{eventCategory:"button",eventAction:"mybalance-on-off"},47:{eventCategory:"button",eventAction:"deposit"},48:{eventCategory:"button",eventAction:"withdraw"},49:{eventCategory:"button",eventAction:"fiat"},411:{eventCategory:"button",eventAction:"fiat"},42:{eventCategory:"button",eventAction:"trade",eventLabel:"markets"}},this.log=function(e,t,r,n){}},DexLanguage=function(e){this.data=e,this.t=function(e,t){t=t||{};let r=this.data[e];for(let e in t){let n="{"+e+"}";r=r.replace(new RegExp(n,"g"),t[e])}return r}},Formatter={numbro:null,ethDecimals:18,timeZoneOffset:0,haxSymbols:{weur:2},init:function(){this.numbro=numbro(0),this.timeZoneOffset=60*(new Date).getTimezoneOffset()},sanitizeInputNumber:function(e){return e.toString().replace(/[ ,]/,"")},price:function(e){return Formatter.formatForDisplay(e,9)},priceTicker:function(e,t){let r=Formatter.formatForDisplay(e),n=r.indexOf(".");if(n>-1&&r.length-n>t){return Formatter.formatForDisplay(e,t)+"..."}return r},symbolArr:{usd:{symbol:"$",template:"{symbol}{value}"},eur:{symbol:"€",template:"{symbol}{value}"},cny:{symbol:"¥",template:"{symbol}{value}"},jpy:{symbol:"¥",template:"{symbol}{value}"},krw:{symbol:"₩",template:"{symbol}{value}"},rub:{symbol:"₽",template:"{symbol}{value}"},sgd:{symbol:"S$",template:"{symbol}{value}"}},priceFiat:function(e,t,r){r=r||2,e=parseFloat(e);let n,o="{value} {symbol}",a="";return void 0!==this.symbolArr[t.toLowerCase()]?(a=this.symbolArr[t.toLowerCase()].symbol,o=this.symbolArr[t.toLowerCase()].template):a=t.toUpperCase(),e<.01&&0!=e&&(r=Math.abs(web3.toBigNumber(e).e)+1),this.numbro.set(e),n=this.numbro.format({mantissa:r}),n=Formatter.formatForDisplay(n,r),o=(o=o.replace("{symbol}",a)).replace("{value}",n)},round:function(e,t){let r=Math.pow(10,t),n=e*r;return(n=Math.round(n))/r},haxRound:function(e,t){return Formatter.haxSymbols[t.toLowerCase()],e},volume:function(e){return Formatter.formatForDisplay(e,3)},percent:function(e){return this.numbro.set(e),this.numbro.format({output:"percent"})},int:function(e){return this.numbro.set(e),this.numbro.format({mantissa:0,thousandSeparated:!1})},date:function(e){return moment(e).format("MM-DD HH:mm:ss")},dateDiff:function(e){let t,r,n=parseInt((new Date).getTime()/1e3),o=parseInt(new Date(e).getTime()/1e3),a=n+referenceTime-o;return a>=31536e3?r=(t=parseInt(a/31536e3))>1?dexLang.t("text_x_years_ago"):dexLang.t("text_last_year"):a>=3024e3?r=(t=parseInt(a/3024e3))>1?dexLang.t("text_x_months_ago"):dexLang.t("text_last_month"):a>=604800?r=(t=parseInt(a/604800))>1?dexLang.t("text_x_weeks_ago"):dexLang.t("text_last_week"):a>=86400?r=(t=parseInt(a/86400))>1?dexLang.t("text_x_days_ago"):dexLang.t("text_yesterday"):a>=3600?r=(t=parseInt(a/3600))>1?dexLang.t("text_x_hours_ago"):dexLang.t("text_last_hour"):a>=60?r=(t=parseInt(a/60))>1?dexLang.t("text_x_minutes_ago"):dexLang.t("text_last_minute"):(t=0,r=dexLang.t("text_moments_ago")),r=r.replace("{num}",t)},dateDiffAhead:function(e){let t,r,n=parseInt(new Date(e).getTime()/1e3),o=parseInt((new Date).getTime()/1e3),a=n+referenceTime-o;return a>=31536e3?r=(t=parseInt(a/31536e3))>1?dexLang.t("text_x_years"):dexLang.t("text_next_year"):a>=3024e3?r=(t=parseInt(a/3024e3))>1?dexLang.t("text_x_months"):dexLang.t("text_next_month"):a>=604800?r=(t=parseInt(a/604800))>1?dexLang.t("text_x_weeks"):dexLang.t("text_next_week"):a>=86400?r=(t=parseInt(a/86400))>1?dexLang.t("text_x_days"):dexLang.t("text_tomorrow"):a>=3600?r=(t=parseInt(a/3600))>1?dexLang.t("text_x_hours"):dexLang.t("text_next_hour"):a>=60?r=(t=parseInt(a/60))>1?dexLang.t("text_x_minutes"):dexLang.t("text_next_minute"):(t=0,r=dexLang.t("text_moments")),r=r.replace("{num}",t)},bigNumberFormatForApi:function(e,t){return e.dividedBy(web3.toBigNumber(10).pow(t))},formatForApi:function(e,t){return web3.toBigNumber(e).mul(web3.toBigNumber(10).pow(t)).toFixed(0)},formatForPage:function(e,t){return t=t||ETH_DECIMALS,web3.toBigNumber(e).dividedBy(web3.toBigNumber(10).pow(t)).toFixed()},formatForDisplay:function(e,t){return web3.toBigNumber(e).toFormat(t||null,web3.BigNumber.ROUND_UP,{decimalSeparator:".",groupSeparator:",",groupSize:3})},formatBlockTime:function(e){return e.hours.toString().padStart(2,"0")+":"+e.minutes.toString().padStart(2,"0")+":"+e.seconds.toString().padStart(2,"0")}};Formatter.init();var DexTemplate=function(e){this.id=e;let t="#template-"+this.id;this.getTemplate=function(){return jQuery("#dex-templates").find(t).html()},this.content=this.getTemplate(),this.origContent=this.content,this.replace=function(e,r){try{if("object"==typeof e)for(let t in e)this.content=this.content.replace(new RegExp("{"+t+"}","g"),e[t]);else this.content=this.content.replace(new RegExp(e,"g"),r)}catch(e){console.log(e.message,t)}return this},this.reset=function(){this.content=this.origContent},this.hideSection=function(e){let t=jQuery(this.content);t.find("section."+e).remove(),this.content=t.html()}};const ETH_ADDRESS="0x0000000000000000000000000000000000000000",ETH_SYMBOL="ETH",ETH_DECIMALS=18,ZERO_USER_ADDRESS="0x0000000000000000000000000000000000000000",USD_SYMBOL="USD",EUR_SYMBOL="EUR",CHART_API_INTERVAL=31104e3,CHART_RANGE_M="range-M",CHART_RANGE_D="range-D",CHART_RANGE_H4="range-H4",CHART_RANGE_H1="range-H1",CHART_RANGE_M30="range-M30",CHART_RANGE_M15="range-M15",CHART_RANGE_M5="range-M5",CHART_RANGE_M1="range-M1",CHART_DEFAULT_RANGE="range-D",ORDER_VISIBILITY_VISIBLE="visible",ORDER_VISIBILITY_VISIBLE_SELF="visible_self",ORDER_VISIBILITY_HIDDEN="hidden";var DexHelper=function(e){let t=this,r=jQuery("body");this.controller=e,this.processingDiv='<div class="processing-div"></div>',this.defaultSortOptions=JSON.stringify({orderTableBuy:{sortBy:"price",sortOrder:-1},orderTableSell:{sortBy:"price",sortOrder:-1},tradesTable:{sortBy:"time",sortOrder:-1},myOrdersTable:{sortBy:"price",sortOrder:-1},myTradesTable:{sortBy:"time",sortOrder:-1},myFundsTable:{sortBy:"time",sortOrder:-1},myBalanceTable:{sortBy:"token-wallet-balance",sortOrder:-1,secondaryList:{"token-wallet-balance":"token-dex-balance","token-dex-balance":"token-wallet-balance"}},marketTable:{sortBy:"order-count",sortOrder:-1},tickerTable:{sortBy:"market-id",sortOrder:1},popupTickerTable:{sortBy:"bid",sortOrder:-1}}),this.rangeToFormat={"range-M":{function:"format",format:"YYYY-MM"},"range-D":{function:"format",format:"YYYY-MM-DD"},"range-H4":{function:"round",precision:4,key:"hours"},"range-H1":{function:"format",format:"YYYY-MM-DD HH:00:00"},"range-M30":{function:"round",precision:30,key:"minutes"},"range-M15":{function:"round",precision:15,key:"minutes"},"range-M5":{function:"round",precision:5,key:"minutes"},"range-M1":{function:"format",format:"YYYY-MM-DD HH:mm:00"}},this.formatDateByRange=function(e,r){r=r||"range-D";let n=t.rangeToFormat[r],o=null;return"format"===n.function?o=moment(e).format(n.format):"round"===n.function&&(o=moment(e).round(n.precision,n.key,"floor").format("YYYY-MM-DD HH:mm:ss")),o},this.serializeForm=function(e){let t={};return jQuery(e).serializeArray().map(function(e){t[e.name]=e.value}),t},this.closeModal=function(){r.find("#modal").modal("hide")},this.clearFormError=function(e){e=e||"body",jQuery(e).find(".has-error").removeClass("has-error"),jQuery(e).find(".help-block").text("")},this.disableFormInputs=function(e){jQuery(e).find(".form-control, .btn").prop("disabled",!0)},this.removeLoading=function(e){e.closest("scroll").removeClass("loading")},this.copyToClipboard=function(e){var t=document.createElement("input");t.style.position="absolute",t.style.left="-9999px",t.setAttribute("readonly",""),t.value=e,document.body.appendChild(t);var r=this.copyFromElementToClipboard(t);return document.body.removeChild(t),r},this.copyFromElementToClipboard=function(e){if(navigator.userAgent.match(/ipad|iphone/i)){var t=document.createRange();t.selectNodeContents(e);var r=window.getSelection();r.removeAllRanges(),r.addRange(t),e.setSelectionRange(0,999999)}else e.select();return document.execCommand("copy")},this.getRandomEventNamespace=function(){return"."+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)},this.getRandomString=function(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)},this.removeHashFromUri=function(){var e=window.location.toString();if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));window.history.replaceState({},document.title,t)}},this.createTransactionObj=function(e){let t={};return t.to=e.toAddress,t.from=e.fromAddress,t.data=e.contract[e.functionName].getData.apply(null,e.applyFunctionData),t.value=e.value,t.gasPrice=web3.toHex(dexEth.gasPrice),t},this.showFullPageLoader=function(){jQuery(".full-page-loader").show()},this.hideFullPageLoader=function(){jQuery(".full-page-loader").hide()},this.makeClickableRows=function(e,t,r,n,o){e.on("click."+t,".clickable-row",function(e){let t=jQuery(this).find("input:checkbox");e.target!==t[0]&&t.prop("checked",!t.prop("checked")),n&&"function"==typeof n&&n.call(null)}),e.on("click."+r,".global-clickable-row-toggle",function(){let t=jQuery(this).prop("checked");e.find("input:checkbox:not(.global-clickable-row-toggle)").prop("checked",t),o&&"function"==typeof o&&o.call(null)})},this.arraySum=function(e){var t=0;return e.forEach(e=>t+=parseFloat(e)),t},this.checkOrderVisibility=function(e){let r=void 0!==e.visibility?e.visibility:"visible",n=void 0!==e.make_address?e.make_address:null;switch(r){case"visible":return!0;case"visible_self":return t.controller.user.selectedAccount.address==n;case"hidden":return!1}},this.loginStatusData=!1,this.loginStatusCallCnt=0,this.loginConfirmPopup=function(){return t.loginStatusCallCnt++,5===t.loginStatusCallCnt&&(t.loginStatusData=!1,t.loginStatusCallCnt=0),!1===t.loginStatusData&&jQuery.ajax({url:"/dex-v2/get-login-status",data:{},dataType:"json",async:!1,success:function(e){t.loginStatusData=e}}),!t.loginStatusData||(swal({title:t.loginStatusData.title,text:t.loginStatusData.text,type:"warning",showCancelButton:!0,confirmButtonColor:"#66004a",confirmButtonText:t.loginStatusData.confirmButtonText,cancelButtonText:t.loginStatusData.cancelButtonText},function(e){e&&(window.location=t.loginStatusData.redirectUrl)}),!1)}};String.prototype.capitalize=function(){return this.replace(/^./,function(e){return e.toUpperCase()})};var DexTableSorter=function(e,t){let r=this;this.controller=t,this.container=jQuery(e.containerSelector),this.eventNamespace=e.eventNamespace,this.sortOptionsKey=e.sortOptionsKey,this.copyRowData=e.copyRowData||!1,this.afterSort=e.afterSort||!1,this.sortBy=null,this.sortOrder=null,this.hasSecondarySort=!1,this.secondarySortBy=null,"function"!=typeof this.afterSort&&(this.afterSort=function(){}),this.container.off("click."+this.eventNamespace),this.container.on("click."+this.eventNamespace,"[data-sortby]",function(){let e=JSON.parse(r.controller.helper.defaultSortOptions);r.sortBy=jQuery(this).data("sortby"),r.sortOrder=jQuery(this).data("sortOrder"),void 0===r.sortOrder||-1===r.sortOrder?r.sortOrder=1:r.sortOrder=-1,jQuery(this).data("sortOrder",r.sortOrder),r.sort();let t=JSON.parse(r.controller.storage.getItem("sortOptions",r.controller.helper.defaultSortOptions));void 0===t[r.sortOptionsKey]&&(t[r.sortOptionsKey]=e[r.sortOptionsKey]),t[r.sortOptionsKey].sortBy=r.sortBy,t[r.sortOptionsKey].sortOrder=r.sortOrder,r.controller.storage.setItem("sortOptions",JSON.stringify(t))}),this.sort=function(){r.checkSecondarySort();let e=r.container.find(".sortable-row"),t={};if(this.copyRowData&&e.each(function(e,r){let n=jQuery(r).data("signature");n&&(t[n]=jQuery(r).data())}),r.hasSecondarySort){let t=r.sortBy;r.sortBy=r.secondarySortBy,e.sort(r.sortCompareFunction),r.sortBy=t}e.sort(r.sortCompareFunction),r.container.find(".sortable-row").remove(),r.container.append(e),this.copyRowData&&r.container.find(".sortable-row").each(function(e,r){let n=jQuery(r),o=n.data("signature");t[o]&&n.data(t[o])}),r.container.find(".sort-order-span").remove();let n=1===r.sortOrder?"attributes":"attributes-alt";r.container.find('[data-sortby="'+r.sortBy+'"]').append('<span class="sort-order-span glyphicon glyphicon-sort-by-'+n+'"></span>'),r.afterSort()},this.initSortOptions=function(){let e=JSON.parse(r.controller.helper.defaultSortOptions),t=JSON.parse(r.controller.storage.getItem("sortOptions",r.controller.helper.defaultSortOptions));void 0!==t[r.sortOptionsKey]?(r.sortBy=t[r.sortOptionsKey].sortBy,r.sortOrder=t[r.sortOptionsKey].sortOrder):(r.sortBy=e[r.sortOptionsKey].sortBy,r.sortOrder=e[r.sortOptionsKey].sortOrder)},this.checkSecondarySort=function(){let e=JSON.parse(r.controller.helper.defaultSortOptions)[r.sortOptionsKey];void 0!==e&&void 0!==e.secondaryList&&void 0!==e.secondaryList[r.sortBy]?(r.hasSecondarySort=!0,r.secondarySortBy=e.secondaryList[r.sortBy]):r.hasSecondarySort=!1},this.sortCompareFunction=function(e,t){let n=jQuery(e).data(r.sortBy),o=jQuery(t).data(r.sortBy),a=Formatter.sanitizeInputNumber(n),i=Formatter.sanitizeInputNumber(o);return jQuery.isNumeric(a)&&jQuery.isNumeric(i)?(n=parseFloat(a))===(o=parseFloat(i))?0:1===r.sortOrder?n<=o?-1:1:n>=o?-1:1:1===r.sortOrder?n.toString().localeCompare(o.toString()):o.toString().localeCompare(n.toString())},this.initSortOptions()};const EXPAND_OFF=0,EXPAND_ON=1;var DexSwitchController=function(e){let t=this;this.controller=e,this.minScreenWidth=1200,this.myBalanceDexSwitch=new DexSwitch(t.controller,{selector:"my-balance",relativeSelector:"my-trades",defaultWidth:400,relativeSelectorWidth:500,minScreenWidth:1200,mobileExpand:!0,mobileScroll:!0,mobileScrollSelector:"id-markets",noAccountDefaultWidth:400,initStatus:0,afterExpandOn:function(){t.controller.balanceRenderer.fixMyBalanceHeader(1),t.controller.tracking.log(4,46,"on")},afterExpandOff:function(){t.controller.balanceRenderer.fixMyBalanceHeader(0),t.controller.tracking.log(4,46,"off")}}),this.myTradesDexSwitch=new DexSwitch(t.controller,{selector:"my-trades",relativeSelector:"my-balance",defaultWidth:500,relativeSelectorWidth:400,minScreenWidth:1200,mobileExpand:!1,mobileScroll:!1,mobileScrollSelector:"id-markets",noAccountDefaultWidth:400,initStatus:0}),this.controller.eventDispatcher.listen("switch-changed",function(){let e=jQuery(".header-toggle-container-on-sidebars"),r=jQuery("#depositContainer");t.isOnExchangePage()||(e.is(":visible")?0===t.myBalanceDexSwitch.getStatus()&&0===t.myTradesDexSwitch.getStatus()&&e.fadeOut(200):1!==t.myBalanceDexSwitch.getStatus()&&1!==t.myTradesDexSwitch.getStatus()||e.fadeIn(100)),1===t.myBalanceDexSwitch.getStatus()?r.fadeOut(200):r.fadeIn(100)}),this.isOnExchangePage=function(){let e;return(e=$(window).width()<t.minScreenWidth||0===t.myBalanceDexSwitch.getStatus()&&0===t.myTradesDexSwitch.getStatus())&&"hidden"===t.controller.marketsRenderer.marketStatus},this.resetSwitches=function(){1===t.myBalanceDexSwitch.getStatus()&&(t.myBalanceDexSwitch.toggleStatus(),t.myBalanceDexSwitch.doExpandOff(!0)),1===t.myTradesDexSwitch.getStatus()&&(t.myTradesDexSwitch.toggleStatus(),t.myTradesDexSwitch.doExpandOff(!0))},$("body").on("click",".logo-action",function(){t.resetSwitches(),t.controller.marketsRenderer.showMarkets(),t.controller.marketsRenderer.filter.reset(),t.controller.balanceRenderer.resetFilter(),t.controller.helper.removeHashFromUri()})},DexSwitch=function(e,t){let r=this;this.defaultWidth=t.defaultWidth,this.noAccountDefaultWidth=t.noAccountDefaultWidth,this.selector=t.selector,this.relativeSelector=t.relativeSelector,this.relativeSelectorWidth=t.relativeSelectorWidth,this.controller=e,this.initStatus=t.initStatus,this.minScreenWidth=t.minScreenWidth,this.mobileExpand=t.mobileExpand,this.mobileScroll=t.mobileScroll,this.mobileScrollSelector=t.mobileScrollSelector,this.afterExpandOn=t.afterExpandOn||function(){},this.afterExpandOff=t.afterExpandOff||function(){},this.initialization=!1,this.afterChange=function(e){(e=e||!1)&&$("."+r.selector+" .switch-button").addClass("animated"),0===r.getStatus()?r.doExpandOff(e):r.doExpandOn(e)},this.getStatus=function(){return parseInt($("#"+r.selector+"-switch-status").val())},this.setStatus=function(e){$("#"+r.selector+"-switch-status").val(e)},this.toggleStatus=function(){let e=1===r.getStatus()?0:1;r.setStatus(e)},this.getExpandOnWidth=function(){let e,t=$(window).width();return e=r.hasAccount()?r.relativeSelectorWidth-r.getWidthModify():r.noAccountDefaultWidth,Math.floor(t-e)},this.getExpandOffWidth=function(){$(window).width();return r.hasAccount()?r.defaultWidth-r.getWidthModify():r.noAccountDefaultWidth},this.getWidthModify=function(){let e=$(window).width();return 1300<e&&e<=1600?100:1200<=e&&e<=1300?150:0},this.hasAccount=function(){return r.controller.user.hasAccount()},this.doExpandOn=function(e){r.doAnimate(r.getExpandOnWidth(),1,e),$("."+r.selector+" .switch-button").html('<span class="glyphicon glyphicon-off"></span>'),$("."+r.selector+" .switch-container").removeClass("expand-off"),$("."+r.selector+" .switch-container").addClass("expand-on"),$("."+r.selector+" .switch-button").removeClass("fadeInRight"),$("."+r.selector+" .switch-button").addClass("fadeInLeft"),$("."+r.selector).addClass("no-border"),r.afterExpandOn(),r.controller.eventDispatcher.trigger("switch-changed")},this.doExpandOff=function(e){r.doAnimate(r.getExpandOffWidth(),0,e),$("."+r.selector+" .switch-button").html('<span class="glyphicon glyphicon-new-window"></span>'),$("."+r.selector+" .switch-container").removeClass("expand-on"),$("."+r.selector+" .switch-container").addClass("expand-off"),$("."+r.selector+" .switch-button").removeClass("fadeInLeft"),$("."+r.selector+" .switch-button").addClass("fadeInRight"),$("."+r.selector).removeClass("no-border"),r.afterExpandOff(),r.controller.eventDispatcher.trigger("switch-changed")},this.doAnimate=function(e,t,n){t||$("."+r.selector).removeClass("expand-on"),n?$("."+r.selector).stop(!0,!0).animate({width:e+"px"},{duration:600,easing:"easeInOutCubic",complete:function(){t&&$("."+r.selector).addClass("expand-on")}}):($("."+r.selector).css("width",e),t&&$("."+r.selector).addClass("expand-on")),this.controller.storage.setItem(r.selector+"-expand",t)},this.setFullWidth=function(){r.mobileExpand?(r.setStatus(1),r.doExpandOn()):r.setStatus(0),$("."+r.selector).css("width","100%")},this.detectRelativeSwitch=function(){1===parseInt($("#"+r.relativeSelector+"-switch-status").val())&&$("."+r.relativeSelector+" .switch-bg").trigger("click")},this.afterEvent=function(e){$(window).width()>r.minScreenWidth?r.afterChange(e):r.setFullWidth()},this.afterMarketTradeChange=function(){$(window).width()>r.minScreenWidth&&1===r.getStatus()&&(r.toggleStatus(),r.doExpandOff(!r.initialization))},this.init=function(){r.initialization=!0,r.controller.directToMarket?r.setStatus(r.initStatus):r.setStatus(r.controller.storage.getItem(r.selector+"-expand",r.initStatus)),$("body").on("click","."+r.selector+" .switch-bg",function(){r.detectRelativeSwitch(),r.toggleStatus(),r.afterChange(!0)}),$(window).resize(function(){r.afterEvent(!1)}),r.controller.eventDispatcher.listen("user-has-no-account user-has-account",r.afterEvent),r.controller.eventDispatcher.listen("marketChanged balance-action-trade",r.afterMarketTradeChange),r.afterEvent(!1),r.initialization=!1},r.init()},DexMobileTabController=function(e){let t=this;this.controller=e,this.tabSelector="mobile-tab",this.myBalanceId="id-my-balance",this.exchangeId="id-exchange",this.myTradesId="id-my-trades",this.afterMarketTradeChange=function(){$("."+t.tabSelector+" #"+t.exchangeId+"-tab").trigger("click")},this.init=function(){t.controller.eventDispatcher.listen("marketChanged balance-action-trade",t.afterMarketTradeChange)},t.init()};const API_ACTION_BALANCE_LOAD="balance-load",API_ACTION_DEPOSIT="deposit",API_ACTION_WITHDRAW="withdraw",API_ACTION_APPROVE="approve",API_ACTION_TRADE="trade",API_ACTION_ORDER_CANCELLATION="order-cancellation";var DexApiErrorHandler=function(e,t,r,n){let o,a=this;a.controller=r,a.action=t,a.params=n||{},a.apiActions={"order-cancellation":dexLang.t("text-api-action-order-cancellation"),"balance-load":dexLang.t("text-api-action-balance-load"),deposit:dexLang.t("text-api-action-deposit"),withdraw:dexLang.t("text-api-action-withdraw"),approve:dexLang.t("text-api-action-approve"),trade:dexLang.t("text-api-action-trade")},a.errorCodesData={"-32602":{translateKey:"error-desc--32602",params:{apiAction:a.apiActions[a.action],address:a.controller.user.selectedAccount.address}},"-32000":{translateKey:"error-desc--32000"},"-32603":{translateKey:"error-desc--32603"},4001:{translateKey:"error-desc-4001"}},o=void 0!==a.errorCodesData[e.code]?void 0!==a.errorCodesData[e.code].params?dexLang.t(a.errorCodesData[e.code].translateKey,a.errorCodesData[e.code].params):dexLang.t(a.errorCodesData[e.code].translateKey):dexLang.t("error_unknown"),a.controller.helper.closeModal(),swal({title:dexLang.t("title_dear_customer"),text:o,icon:"error"})},DexPrivacyFormRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.template=new DexTemplate("no-account-popup-new"),this.form=null,this.rules=[[["privacyAccept"],"required",dexLang.t("errmsg_must_accept")],["privacyAccept",{validatorName:"equal",params:{value:"accepted"}},dexLang.t("errmsg_must_accept")]],this.render=function(){new Modal({title:dexLang.t("errmsg_get_started"),content:this.template.content,unClosable:!0}),this.form=new DexForm("#privacy-form",this.rules)},r.off("submit.privacy-form"),r.on("submit.privacy-form","#privacy-form",function(){return t.form.validate(!0)&&(t.controller.helper.closeModal(),t.controller.storage.setItem("no-account-popup",!0)),!1})},DexRefreshRenderer=function(e){let t=jQuery("body");new Modal({title:dexLang.t("title_refresh"),content:new DexTemplate("refresh-popup").content}),t.on("click","[data-refresh-now]",function(){window.location.reload()});let r=10,n=jQuery("#refreshCountDown");n.html(r);let o=setInterval(function(){if(n.html(r),0===r)return clearInterval(o),void window.location.reload();r-=1},1e3)},DexEmptyTablePlaceholderRenderer=function(e,t){let r=this;this.container=t.container,this.controller=e,this.templatePostfix=t.templatePostfix||"default",this.type=t.type,this.marketId=t.marketId||"choose",this.tokenAddress=t.tokenAddress||"choose",this.baseTokenAddress=t.baseTokenAddress||"choose",this.template=new DexTemplate("empty-table-placeholder-"+this.templatePostfix),this.render=function(){if(0===this.container.find(".empty-table-placeholder-row").length){let e={type:this.type,marketId:this.marketId};this.template.replace(e),this.container.prepend(this.template.content)}this.container.find("tr.sortable-row:not(.filtered)").length>0&&this.container.find(".empty-table-placeholder-row").length>0&&this.container.find(".empty-table-placeholder-row").remove()},this.controller.eventDispatcher.ignore("filtering."+r.container.attr("id")),this.controller.eventDispatcher.listen("filtering."+r.container.attr("id"),function(){r.render()})},DexLogoutConfirmPopupRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.template=new DexTemplate("logout-confirm"),this.render=function(){new Modal({title:dexLang.t("title_logout"),content:this.template.content});let e="";for(let t in this.controller.user.accounts){let r=this.controller.user.accounts[t];if(!r.metamask){let n=r.metamask?"No private key":r.pk;e+=dexLang.t("text_address")+": "+t+"\n",e+=dexLang.t("text_private_key")+": "+n+"\n\n"}}jQuery("#exportAll").text(e)},r.off("click.confirm-logout"),r.on("click.confirm-logout","#modal #modalContent [data-logout-confirm]",function(){t.controller.storage.clear(),window.location.reload()}),r.on("click.exportAll","#modal #modalContent #exportAllCopy",function(){let e=document.getElementById("exportAll");t.controller.helper.copyFromElementToClipboard(e)})},DexExportAllRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.template=new DexTemplate("export-all"),this.render=function(){new Modal({title:dexLang.t("title_export_all"),content:this.template.content,size:"modal-lg"});let e="";for(let t in this.controller.user.accounts){let r=this.controller.user.accounts[t];if(!r.metamask){let n=r.metamask?"No private key":r.pk;e+=dexLang.t("text_address")+": "+t+"\n",e+=dexLang.t("text_private_key")+": "+n+"\n\n"}}jQuery("#exportAll").text(e)},r.on("click.exportAll","#modal #modalContent #exportAllCopy",function(){let e=document.getElementById("exportAll");t.controller.helper.copyFromElementToClipboard(e),t.controller.helper.closeModal(),swal({title:dexLang.t("title_goodjob"),text:dexLang.t("text_export_all_success"),icon:"success"})})},DexUserMenuRenderer=function(e,t){let r=this,n=jQuery("body");this.user=e,this.controller=t,this.container=jQuery("#accountsDropdown"),this.template="",this.templateUserItem=new DexTemplate("account-dropdown-item"),this.render=function(){let e="",t=this.container.find(".dropdown-menu").scrollTop(),r=this.user.hasAccount()?"accounts-dropdown-user":"accounts-dropdown-nouser";if(this.template=new DexTemplate(r),this.user.hasAccount()){let t,r="";for(let n in this.user.accounts){t=!1;let o=this.user.accounts[n],a='<span class="label label-'+o.type+'">'+o.type+"</span>";this.user.hasSelectedAccount()&&n===this.user.selectedAccount.address&&(r=a,t=!0);let i={userAddress:o.address,label:a,isActive:t?"active":""};this.templateUserItem.replace(i),e+=this.templateUserItem.content,this.templateUserItem.reset()}let n={selectedUserAddreessFull:this.user.hasSelectedAccount()?this.user.selectedAccount.address:"???",selectedUserAddreess:this.user.hasSelectedAccount()?this.user.selectedAccount.address.substring(0,12)+"...":"???",label:r,accounts:e};this.template.replace(n)}this.container.html(this.template.content),this.container.find(".dropdown-menu").scrollTop(t)},n.off("click.changeAccount"),n.on("click.changeAccount",".change-account",function(){let e=jQuery(this).data("user-addr");r.user.changeAccount(e),r.controller.initPage()})},DexMarketsTokenFilterRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.template=new DexTemplate("markets-filter-dropdown"),this.templateItem=new DexTemplate("markets-filter-dropdown-item"),this.templateSearchForm=new DexTemplate("markets-filter-dropdown-search-from"),this.value=this.controller.filterTokenAddress||this.controller.storage.getItem("markets-filter","ALL"),this.container=jQuery("#marketsFilter"),this.emptyTable=new DexEmptyTablePlaceholderRenderer(t.controller,{type:dexLang.t("text_markets"),container:jQuery("#marketsTableBody")}),this.render=function(){this.template.reset(),this.templateSearchForm.reset(),this.templateItem.reset();let e="",r="",n="",o=Object.keys(this.controller.tokens).map(e=>this.controller.tokens[e]);o.unshift({name:"All",symbol:"ALL",address:"ALL"}),o.forEach(function(o){if(o.isVisible){let a={tokenAddr:o.address,tokenName:o.name,tokenSymbol:o.symbol,tokenNameLower:o.name.toLowerCase(),tokenSymbolLower:o.symbol.toLowerCase()};t.templateItem.replace(a),o.symbol===t.value?(r=o.symbol,n=o.address):e+=t.templateItem.content,t.templateItem.reset()}});let a={searchForm:this.templateSearchForm.content,items:e,filteredTokenSymbol:r,filteredTokenAddress:n};this.template.replace(a),this.container.html(this.template.content),"ALL"!==t.value?t.container.find(".dropdown-toggle").addClass("orange"):t.container.find(".dropdown-toggle").removeClass("orange")},this.container.on("submit.marketsFiltertokenSearch",".marketsFilterTokenSearchTextForm",function(){return!1}),this.container.off("keyup.marketsFiltertokenSearch"),this.container.on("keyup.marketsFiltertokenSearch","#marketsFilterTokenSearchText",function(){let e=jQuery.trim(jQuery(this).val().toLowerCase());if(t.container.find(".search-result-not-found").hide(),""!==e){t.container.find("[data-token-name]").hide();let r=t.container.find('[data-token-name*="'+e+'"], [data-token-symbol*="'+e+'"]');r.length>0?r.show():t.container.find(".search-result-not-found").show()}else t.container.find("[data-token-name]").show()}),r.on("click",".filter-markets",function(){t.doFilter(jQuery(this).data("token-symbol")),t.render()}),this.doFilter=function(e){if((e=e||null)&&(e=e.toUpperCase(),t.value=e),t.controller.storage.setItem("markets-filter",t.value),"ALL"!==t.value){t.container.find("dropdown-toggle").addClass("orange"),jQuery(".markets-box-title").text(dexLang.t("title_markets_filtered",{tokenName:t.value})),r.find(".filterable-row").addClass("filtered").hide();let e=r.find('.filterable-row[data-market-key*="'+t.value+'"]');e.length>0&&e.removeClass("filtered").show(),t.controller.switchController.isOnExchangePage()||jQuery(".my-trades-box-title").text(dexLang.t("title_mytrades_filtered",{tokenName:t.value}))}else t.container.find("dropdown-toggle").removeClass("orange"),this.controller.switchController.isOnExchangePage()||(r.find(".filterable-row").removeClass("filtered").show(),jQuery("#myTradesTableBody").find(".filterable-row").removeClass("filtered").show(),jQuery(".markets-box-title").text(dexLang.t("title_markets")),jQuery(".my-trades-box-title").text(dexLang.t("title_mytrades")));this.emptyTable.render(),this.controller.eventDispatcher.trigger("filtering")},t.controller.eventDispatcher.listen("marketChanged",function(){jQuery(".my-trades-box-title").text(dexLang.t("title_mytrades_filtered",{tokenName:t.controller.selectedMarket.name}))}),this.reset=function(){this.value="ALL",this.doFilter(this.value),this.render()}},DexMarketsTableHeaderRenderer=function(e){this.controller=e,this.template=new DexTemplate("markets-header"),this.container=jQuery("#marketsTableHead"),this.tableSorter=new DexTableSorter({containerSelector:"#marketsContainer",eventNamespace:"marketslistsortby",sortOptionsKey:"marketTable",copyRowData:!0},this.controller),this.render=function(){if(0===this.container.find(".table-header").length)return this.container.html(this.template.content)}},DexMarketsRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.container=jQuery("#marketsContainer"),this.containerBody=jQuery("#marketsTableBody"),this.data={},this.marketStatus="visible",this.template=new DexTemplate("markets-row"),this.emptyTable=new DexEmptyTablePlaceholderRenderer(t.controller,{type:dexLang.t("text_markets"),container:this.containerBody}),this.filter=new DexMarketsTokenFilterRenderer(e),this.render=function(){let e=new DexMarketsTableHeaderRenderer(t.controller);e.render(),this.filter.render();for(let e in t.data){let r=t.data[e];for(let n in r.orderData){let o=e+"-"+n,a=r.orderData[n],i=t.containerBody.find('[data-market-key="'+o+'"]');if(r.isEnabled&&r.isVisible){if(a.count<=0){i.length>0&&i.remove();continue}let t={quoteTokenName:r.quoteCurrency.name,quoteTokenSymbol:r.quoteCurrency.symbol,quoteTokenAddress:r.quoteCurrency.address,baseTokenSymbol:r.baseCurrency.symbol,baseTokenName:r.baseCurrency.name,baseTokenAddress:r.baseCurrency.address,orderCount:a.count,side:n,lastCreatedAtTime:a.max_created,lastCreatedAt:Formatter.dateDiff(a.max_created),lastCreatedAtFormatted:Formatter.date(a.max_created),lastCreatedAtTimestamp:new Date(a.max_created).getTime(),marketKey:o,marketId:e};this.template.replace(t),i.length>0?i.replaceWith(this.template.content):this.containerBody.append(this.template.content),this.template.reset()}else i.length>0&&i.remove()}}this.emptyTable.render(),e.tableSorter.sort(),t.controller.eventDispatcher.trigger("moduleRendered",{container:jQuery("#marketsContainer")}),this.filter.doFilter(this.filter.value)},this.setData=function(e){e.forEach(function(e){let r=t.controller.tokens[e.base_address].symbol+"-"+t.controller.tokens[e.quote_address].symbol,n=t.controller.getMarket(r);n.orderData[e.type]=e,t.data[r]=n})},this.hideMarkets=function(){"visible"===t.marketStatus&&(t.marketStatus="hidden",jQuery(".row-box-markets").fadeOut(200,function(){jQuery(".row-box-order-book, .row-box-trades").fadeIn(200,function(){t.controller.eventDispatcher.trigger("pageStateChangedChart")}),t.controller.eventDispatcher.trigger("pageStateChanged")}))},this.showMarkets=function(){"hidden"===t.marketStatus&&(t.marketStatus="visible",jQuery(".row-box-order-book, .row-box-trades").fadeOut(200,function(){jQuery(".row-box-markets").fadeIn(200)}),t.controller.eventDispatcher.trigger("pageStateChanged"))},this.controller.eventDispatcher.listen("marketChanged",t.hideMarkets),r.off("click.backtomarkets"),r.on("click.backtomarkets",".action-back-to-market",function(){t.controller.eventDispatcher.trigger("backToMarkets"),t.showMarkets(),t.controller.helper.removeHashFromUri(),t.controller.switchController.resetSwitches()}),r.off("click.depositswitchtrigger"),r.on("click.depositswitchtrigger",".deposit-switch-trigger",function(){t.controller.eventDispatcher.trigger("depositswitchtrigger"),t.controller.switchController.myBalanceDexSwitch.toggleStatus(),t.controller.switchController.myBalanceDexSwitch.afterChange(!0)})},DexChartsTradesVolumeRenderer=function(e){let t=this;t.controller=e;if(this.containerChartsTradesVolume=new function(e,t){let r=this;r.controller=t,r.containerId=e,r.container=jQuery("#"+r.containerId),this.show=function(){r.container.show()},this.hide=function(){r.container.hide()},this.html=function(e){r.container.html(e)},r.activeTab="charts",this.navTabs=r.container.find(".nav-tabs"),this.navTabs.find('a[data-toggle="tab"]').on("shown.bs.tab",function(e){r.activeTab=$(e.target).data("tab"),r.controller.eventDispatcher.trigger(r.containerId+".tab-changed",{activeTab:r.activeTab})}),this.isOnCharts=function(){return"charts"===r.activeTab},this.isOnTrades=function(){return"trades"===r.activeTab},this.isOnVolume=function(){return"volume"===r.activeTab}}("chartsTradesVolume",t.controller),this.fullScreenButton=jQuery("#chartFullScreenButton"),this.candleStickButton=jQuery("#chartCandleStickButton"),this.lineButton=jQuery("#chartLineButton"),t.containerChartsTradesVolume.isOnCharts()){"line"===t.controller.storage.getItem("chart-type","line")?t.candleStickButton.show():t.lineButton.show(),t.fullScreenButton.show()}else t.containerChartsTradesVolume.isOnVolume()?(t.candleStickButton.hide(),t.lineButton.hide(),t.fullScreenButton.show()):(t.candleStickButton.hide(),t.lineButton.hide(),t.fullScreenButton.hide());t.controller.eventDispatcher.listen("chartsTradesVolume.tab-changed",function(e,r){if("charts"===r.activeTab){"line"===t.controller.storage.getItem("chart-type","line")?t.candleStickButton.show():t.lineButton.show(),t.fullScreenButton.show()}else"volume"==r.activeTab?(t.candleStickButton.hide(),t.lineButton.hide(),t.fullScreenButton.show()):(t.candleStickButton.hide(),t.lineButton.hide(),t.fullScreenButton.hide())}),t.fullScreenButton.off("click.chartsFullScreen"),t.fullScreenButton.on("click.chartsFullScreen",function(){t.containerChartsTradesVolume.isOnCharts()?new DexChartsPopupRenderer(t.controller).render():t.containerChartsTradesVolume.isOnVolume()&&new DexVolumePopupRenderer(t.controller).render()}),t.candleStickButton.off("click.chartCandleStickButton"),t.candleStickButton.on("click.chartCandleStickButton",function(){t.controller.storage.setItem("chart-type","candle"),t.controller.priceChartRenderer.render(),t.candleStickButton.hide(),t.lineButton.show()}),t.lineButton.off("click.chartLineButton"),t.lineButton.on("click.chartLineButton",function(){t.controller.storage.setItem("chart-type","line"),t.controller.priceChartRenderer.render(),t.candleStickButton.show(),t.lineButton.hide()})},DexChartsPopupRenderer=function(e){let t=this;t.controller=e,t.template=new DexTemplate("charts-popup"),t.render=function(){new Modal({title:"Charts",content:t.template.content,size:"modal-fullscreen",afterShown:t.afterShown})},t.afterShown=function(){t.renderPriceChart($("#priceChartTab").find('[name="chartRange"]').val()),$("#priceChartTab").find('[name="chartRange"]').on("change",function(){t.renderPriceChart($(this).val())}),$("#chartLineButtonPopup").on("click",function(){t.controller.storage.setItem("chart-type","line"),t.renderPriceChart($("#priceChartTab").find('[name="chartRange"]').val()),$("#chartLineButtonPopup").addClass("active"),$("#chartCandleStickButtonPopup").removeClass("active")}),$("#chartCandleStickButtonPopup").on("click",function(){t.controller.storage.setItem("chart-type","candle"),t.renderPriceChart($("#priceChartTab").find('[name="chartRange"]').val()),$("#chartCandleStickButtonPopup").addClass("active"),$("#chartLineButtonPopup").removeClass("active")}),"line"===t.controller.storage.getItem("chart-type","line")?($("#chartLineButtonPopup").addClass("active"),$("#chartCandleStickButtonPopup").removeClass("active")):($("#chartCandleStickButtonPopup").addClass("active"),$("#chartLineButtonPopup").removeClass("active")),t.controller.depthChartRenderer.createAmCharts("chartDepthPopup")},t.renderPriceChart=function(e){"line"===t.controller.storage.getItem("chart-type","line")?t.controller.priceChartRenderer.configAmLineChart("chartPricePopup"):t.controller.priceChartRenderer.configAmCharts("chartPricePopup"),t.controller.priceChartRenderer.prepareDataOhlc(e),t.controller.priceChartRenderer.createAmCharts()}},DexMyBalanceItemRenderer=function(e,t,r){this.controller=t,this.tokenAddress=e,this.filtertext=r.toLowerCase(),this.template=new DexTemplate("my-balance-item"),this.container=jQuery("#myBalances"),this.render=function(){let e,t,r,n;e=this.controller.tokens[this.tokenAddress].symbol,r=this.controller.tokens[this.tokenAddress].name,t=e.toLowerCase(),n=r.toLowerCase();let o={tokenAddress:this.tokenAddress,isNullBalance:this.controller.user.selectedAccount.balances[this.tokenAddress].isNullBalance,tokenSymbol:e,tokenName:r,tokenSymbolLower:t,tokenNameLower:n,dexTokenBalance:Formatter.haxRound(Formatter.volume(this.controller.user.selectedAccount.balances[this.tokenAddress].dex),e),dexTokenBalanceUsd:Formatter.priceFiat(this.controller.user.selectedAccount.balances[this.tokenAddress].dex.toCurrentFiat(),this.controller.currencySelector.currentCurrency),dexTokenBalanceEth:this.controller.user.selectedAccount.balances[this.tokenAddress].dex.toETH(),walletTokenBalance:Formatter.haxRound(Formatter.volume(this.controller.user.selectedAccount.balances[this.tokenAddress].wallet),e),walletTokenBalanceUsd:Formatter.priceFiat(this.controller.user.selectedAccount.balances[this.tokenAddress].wallet.toCurrentFiat(),this.controller.currencySelector.currentCurrency),walletTokenBalanceEth:this.controller.user.selectedAccount.balances[this.tokenAddress].wallet.toETH(),disabled:this.controller.tokens[this.tokenAddress].isDepositEnabled?"":"disabled",lowBalance:this.controller.user.selectedAccount.balances[this.tokenAddress].isLowBalance?"~ ":""};this.template.replace(o);let a=!1;""!==this.filtertext&&t.indexOf(this.filtertext)<0&&n.indexOf(this.filtertext)<0&&(a=!0);let i=this.container.find('[data-token-address="'+this.tokenAddress+'"]');if(this.tokenAddress!==ETH_ADDRESS&&this.controller.tokens[this.tokenAddress].isVisible)if(i.length>0){let e=i.is(":visible");i.replaceWith(this.template.content),e&&!a&&this.container.find('[data-token-address="'+this.tokenAddress+'"]').show()}else this.container.append(this.template.content),this.controller.user.selectedAccount.balances[this.tokenAddress].isNullBalance&&this.controller.balanceRenderer.hideNullBalances||a||this.container.find('[data-token-address="'+this.tokenAddress+'"]').show()}},DexMyBalanceRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.template=new DexTemplate("my-balance"),this.templateNoAccount=new DexTemplate("my-balance-no-account"),this.container=jQuery("#myBalanceContainer"),this.containerBalances=null,this.sortTimeout=null,this.hideNullBalances=JSON.parse(this.controller.storage.getItem("hideNullBalances","false")),this.render=function(){this.container.html(this.template.content),this.containerBalances=jQuery("#myBalances"),this.tableSorter=new DexTableSorter({containerSelector:"#myBalanceTable",eventNamespace:"mybalancelistsortby",sortOptionsKey:"myBalanceTable",afterSort:function(){let e=t.containerBalances.find('[data-token-address="'+ETH_ADDRESS+'"]'),r=e.clone();e.remove(),t.containerBalances.prepend(r)}},this.controller),jQuery("#hideNullBalances").prop("checked",this.hideNullBalances),jQuery("#hideNullBalances").next().removeClass("glyphicon-heart glyphicon-heart-empty").addClass(this.hideNullBalances?"glyphicon-heart":"glyphicon-heart-empty"),this.container.off("change.hideNullBalances"),this.container.on("change.hideNullBalances","#hideNullBalances",function(){let e=jQuery(this).prop("checked");t.hideNullBalances=e,jQuery("#hideNullBalances").next().removeClass("glyphicon-heart glyphicon-heart-empty").addClass(t.hideNullBalances?"glyphicon-heart":"glyphicon-heart-empty"),t.controller.storage.setItem("hideNullBalances",e);let r=jQuery.trim(jQuery("#myBalanceTokenFilter").val().toLowerCase()),n='[data-is-null-balance="true"]';""!==r&&(n='[data-token-name*="'+r+'"][data-is-null-balance="true"], [data-token-symbol*="'+r+'"][data-is-null-balance="true"]');let o=jQuery("#myBalanceTable").find(n);e?o.hide():o.show()}),this.controller.eventDispatcher.ignore("balanceLoaded"),this.controller.eventDispatcher.listen("balanceLoaded",function(e,r){let n=jQuery.trim(jQuery("#myBalanceTokenFilter").val().toLowerCase());new DexMyBalanceItemRenderer(r.tokenAddress,t.controller,n).render(),t.controller.eventDispatcher.trigger("balanceRendered"+r.tokenAddress),t.refreshSum()}),this.refreshAll(),this.container.off("click.balanceRendererWithdraw"),this.container.on("click.balanceRendererWithdraw",".balance-action-withdraw",function(){let e=jQuery(this).closest(".my-balance-row").data("token-address");t.controller.helper.clearFormError(),t.controller.helper.loginConfirmPopup()&&new Modal({title:dexLang.t("title_withdraw"),content:new DexWithdrawFormRenderer(e,t.controller).render()}),t.controller.tracking.log(4,48,t.controller.tokens[e].symbol)}),this.container.off("click.balanceRendererDeposit"),this.container.on("click.balanceRendererDeposit",".balance-action-deposit",function(){let e=jQuery(this).closest(".my-balance-row").data("token-address");t.controller.helper.clearFormError(),t.controller.helper.loginConfirmPopup()&&new Modal({title:dexLang.t("title_deposit"),content:new DexDepositFormRenderer(e,t.controller).render()}),t.controller.tracking.log(4,47,t.controller.tokens[e].symbol)}),this.container.off("click.balanceRendererTrade"),this.container.on("click.balanceRendererTrade",".balance-action-trade",function(){let e=jQuery(this).closest(".my-balance-row").data("token-address"),r=t.controller.tokens[e].symbol;t.controller.marketsRenderer.filter.doFilter(r),t.controller.marketsRenderer.filter.render(),t.controller.marketsRenderer.showMarkets(),t.controller.eventDispatcher.trigger("balance-action-trade"),t.controller.tracking.log(4,411,r)}),this.typeTimeout=null,this.container.off("keyup.myBalanceTokenFilter"),this.container.on("keyup.myBalanceTokenFilter","#myBalanceTokenFilter",function(){let e=jQuery.trim(jQuery(this).val().toLowerCase());null!==t.typeTimeout&&clearTimeout(t.typeTimeout),t.typeTimeout=setTimeout(function(){if(""!==e){t.container.find("[data-token-name]").hide();let r='[data-token-name*="'+e+'"]{hideNullBalance}, [data-token-symbol*="'+e+'"]{hideNullBalance}';r=r.replace(new RegExp("{hideNullBalance}","g"),t.hideNullBalances?'[data-is-null-balance="false"]':"");let n=t.container.find(r);n.length>0&&n.show()}else{let e="[data-token-name]";t.hideNullBalances&&(e+='[data-is-null-balance="false"]'),t.container.find(e).show()}t.typeTimeout=null},1)}),t.fixMyBalanceHeader(t.controller.switchController.myBalanceDexSwitch.getStatus())},this.allEvents=[];for(let e in this.controller.tokens)this.allEvents.push("balanceRendered"+e);this.refreshAll=function(){this.controller.eventDispatcher.waitForAllEvents(this.allEvents,function(){if(t.refreshSum(),t.container.find(".refresh-balance").removeClass("rotating"),t.controller.user.selectedAccount.isNew){let e=JSON.parse(t.controller.helper.defaultSortOptions).myBalanceTable;t.tableSorter.sortBy=e.sortBy,t.tableSorter.sortOrder=e.sortOrder}t.tableSorter.sort(),t.controller.eventDispatcher.trigger("tokenPricesRefreshed")})},r.on("click","[data-refresh-balance]",function(){let e=jQuery(this);e.addClass("rotating");let r=e.data("refresh-balance");"all"===r?(t.containerBalances.html(""),t.refreshAll(),t.container.find(".dexBalanceSumUsd").text("???"),t.container.find(".dexBalanceSumEth").text("???"),t.container.find(".walletBalanceSumUsd").text("???"),t.container.find(".walletBalanceSumEth").text("???"),t.controller.user.selectedAccount.refreshAll()):t.controller.user.selectedAccount.refreshBalanceByAddress(r)}),this.refreshSum=function(){let e=web3.toBigNumber(0),r=web3.toBigNumber(0),n=web3.toBigNumber(0),o=web3.toBigNumber(0);for(let a in t.controller.user.selectedAccount.balances)if(a!==ETH_ADDRESS){let i=t.controller.user.selectedAccount.balances[a];i.isNullBalance||(e=e.plus(i.dex.toUSD()),r=r.plus(i.dex.toETH()),n=n.plus(i.wallet.toUSD()),o=o.plus(i.wallet.toETH()))}t.container.find(".dexBalanceSumUsd").text(Formatter.priceFiat(e,t.controller.currencySelector.currentCurrency)).data("convertable-price",r.toFixed()),t.container.find(".dexBalanceSumEth").text(Formatter.volume(r)),t.container.find(".walletBalanceSumUsd").text(Formatter.priceFiat(n,t.controller.currencySelector.currentCurrency)).data("convertable-price",o.toFixed()),t.container.find(".walletBalanceSumEth").text(Formatter.volume(o))},this.resetFilter=function(){let e=this.container.find("#myBalanceTokenFilter");e.val(""),e.trigger("keyup.myBalanceTokenFilter"),jQuery("#hideNullBalances").prop("checked",!1).trigger("change.hideNullBalances"),t.controller.storage.setItem("hideNullBalances",!1)},this.fixMyBalanceHeader=function(e){e?($(".my-dex-wallet-sum").removeAttr("colspan"),$(".my-dex-wallet-sum").next().show()):($(".my-dex-wallet-sum").attr("colspan",2),$(".my-dex-wallet-sum").next().hide());let r=function(){if(t.controller.user.hasSelectedAccount()){let e='<span class="label label-'+t.controller.user.selectedAccount.type+'">'+t.controller.user.selectedAccount.type+" "+dexLang.t("title_address")+"</span>";t.container.find(".label-container").html(e)}};null!==t.controller.user.selectedAccount?r():this.controller.eventDispatcher.listen("user-post-instantitiate",function(){r()})}},DexMultiMyBalanceRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.template=new DexTemplate("multi-my-balance"),this.templateNoAccount=new DexTemplate("my-balance-no-account"),this.container=jQuery("#myBalanceContainer"),this.containerBalances=null,this.sortTimeout=null,this.hideNullBalances=JSON.parse(this.controller.storage.getItem("hideNullBalances","false")),this.render=function(){this.container.html(this.template.content),this.containerBalances=jQuery("#myBalances"),this.tableSorter=new DexTableSorter({containerSelector:"#myBalanceTable",eventNamespace:"mybalancelistsortby",sortOptionsKey:"myBalanceTable",afterSort:function(){let e=t.containerBalances.find('[data-token-address="'+ETH_ADDRESS+'"]'),r=e.clone();e.remove(),t.containerBalances.prepend(r)}},this.controller),jQuery("#hideNullBalances").prop("checked",this.hideNullBalances),jQuery("#hideNullBalances").next().removeClass("glyphicon-heart glyphicon-heart-empty").addClass(this.hideNullBalances?"glyphicon-heart":"glyphicon-heart-empty"),this.container.off("change.hideNullBalances"),this.container.on("change.hideNullBalances","#hideNullBalances",function(){let e=jQuery(this).prop("checked");t.hideNullBalances=e,jQuery("#hideNullBalances").next().removeClass("glyphicon-heart glyphicon-heart-empty").addClass(t.hideNullBalances?"glyphicon-heart":"glyphicon-heart-empty"),t.controller.storage.setItem("hideNullBalances",e);let r=jQuery.trim(jQuery("#myBalanceTokenFilter").val().toLowerCase()),n='[data-is-null-balance="true"]';""!==r&&(n='[data-token-name*="'+r+'"][data-is-null-balance="true"], [data-token-symbol*="'+r+'"][data-is-null-balance="true"]');let o=jQuery("#myBalanceTable").find(n);e?o.hide():o.show()}),this.controller.eventDispatcher.ignore("balanceLoaded"),this.controller.eventDispatcher.listen("balanceLoaded",function(e,r){let n=jQuery.trim(jQuery("#myBalanceTokenFilter").val().toLowerCase());new DexMultiMyBalanceItemRenderer(r.tokenAddress,t.controller,n).render(),t.controller.eventDispatcher.trigger("balanceRendered"+r.tokenAddress),t.refreshSum()}),this.refreshAll(),this.container.off("click.balanceRendererWithdraw"),this.container.on("click.balanceRendererWithdraw",".balance-action-withdraw",function(){let e=jQuery(this).closest(".my-balance-row").data("token-address");t.controller.helper.clearFormError(),t.controller.helper.loginConfirmPopup()&&new Modal({title:dexLang.t("title_withdraw"),content:new DexWithdrawFormRenderer(e,t.controller).render()}),t.controller.tracking.log(4,48,t.controller.tokens[e].symbol)}),this.container.off("click.balanceRendererDeposit"),this.container.on("click.balanceRendererDeposit",".balance-action-deposit",function(){let e=jQuery(this).closest(".my-balance-row").data("token-address");t.controller.helper.clearFormError(),t.controller.helper.loginConfirmPopup()&&new Modal({title:dexLang.t("title_deposit"),content:new DexDepositFormRenderer(e,t.controller).render()}),t.controller.tracking.log(4,47,t.controller.tokens[e].symbol)}),this.container.off("click.balanceRendererTrade"),this.container.on("click.balanceRendererTrade",".balance-action-trade",function(){let e=jQuery(this).closest(".my-balance-row").data("token-address"),r=t.controller.tokens[e].symbol;t.controller.marketsRenderer.filter.doFilter(r),t.controller.marketsRenderer.filter.render(),t.controller.marketsRenderer.showMarkets(),t.controller.eventDispatcher.trigger("balance-action-trade"),t.controller.tracking.log(4,411,r)}),this.typeTimeout=null,this.container.off("keyup.myBalanceTokenFilter"),this.container.on("keyup.myBalanceTokenFilter","#myBalanceTokenFilter",function(){let e=jQuery.trim(jQuery(this).val().toLowerCase());null!==t.typeTimeout&&clearTimeout(t.typeTimeout),t.typeTimeout=setTimeout(function(){if(""!==e){t.container.find("[data-token-name]").hide();let r='[data-token-name*="'+e+'"]{hideNullBalance}, [data-token-symbol*="'+e+'"]{hideNullBalance}';r=r.replace(new RegExp("{hideNullBalance}","g"),t.hideNullBalances?'[data-is-null-balance="false"]':"");let n=t.container.find(r);n.length>0&&n.show()}else{let e="[data-token-name]";t.hideNullBalances&&(e+='[data-is-null-balance="false"]'),t.container.find(e).show()}t.typeTimeout=null},1)}),this.container.off("click.multiWithdrawToggle"),this.container.on("click.multiWithdrawToggle",".balance-action-multi-withdraw-toggle",function(){t.controller.helper.loginConfirmPopup()&&(t.controller.multiwithdrawStatus=!t.controller.multiwithdrawStatus,t.container.find(".simple-withdraw-input-container").toggleClass("hidden"),t.container.find(".multi-withdraw-input-container").toggleClass("hidden"))}),this.container.off("click.multiDepositToggle"),this.container.on("click.multiDepositToggle",".balance-action-multi-deposit-toggle",function(){t.controller.helper.loginConfirmPopup()&&(t.controller.multidepositStatus=!t.controller.multidepositStatus,t.container.find(".simple-deposit-input-container").toggleClass("hidden"),t.container.find(".multi-deposit-input-container").toggleClass("hidden"))}),this.container.off("click.fillDepositBalances"),this.container.on("click.fillDepositBalances",".fill-deposit-balances",function(){t.controller.helper.loginConfirmPopup()&&t.container.find(".deposit-input").each(function(e,r){let n=jQuery(r),o=n.data("input-type");t.controller.user.selectedAccount.balances[o].wallet.origValue.gt(0)&&n.val(t.controller.user.selectedAccount.balances[o].wallet.toFixed())})}),this.container.off("click.fillWithdrawBalances"),this.container.on("click.fillWithdrawBalances",".fill-withdraw-balances",function(){t.controller.helper.loginConfirmPopup()&&t.container.find(".withdraw-input").each(function(e,r){let n=jQuery(r),o=n.data("input-type");t.controller.user.selectedAccount.balances[o].dex.origValue.gt(0)&&n.val(t.controller.user.selectedAccount.balances[o].dex.toFixed())})}),this.container.off("click.multiWithdrawApply"),this.container.on("click.multiWithdrawApply",".balance-action-multi-withdraw-apply",function(){if(t.controller.helper.loginConfirmPopup()){let e=new DexMultiFundForm("withdraw",t.controller);e.init(),e.validate()&&e.multiWithdraw()}}),this.container.off("click.multiDepositApply"),this.container.on("click.multiDepositApply",".balance-action-multi-deposit-apply",function(){if(t.controller.helper.loginConfirmPopup()){let e=new DexMultiFundForm("deposit",t.controller);e.init(),e.validate()&&e.multiDeposit()}}),t.fixMyBalanceHeader(t.controller.switchController.myBalanceDexSwitch.getStatus())},this.allEvents=[];for(let e in this.controller.tokens)this.allEvents.push("balanceRendered"+e);this.refreshAll=function(){this.controller.eventDispatcher.waitForAllEvents(this.allEvents,function(){if(t.refreshSum(),t.container.find(".refresh-balance").removeClass("rotating"),t.controller.user.selectedAccount.isNew){let e=JSON.parse(t.controller.helper.defaultSortOptions).myBalanceTable;t.tableSorter.sortBy=e.sortBy,t.tableSorter.sortOrder=e.sortOrder}t.tableSorter.sort(),t.controller.eventDispatcher.trigger("tokenPricesRefreshed")})},r.on("click","[data-refresh-balance]",function(){let e=jQuery(this);e.addClass("rotating");let r=e.data("refresh-balance");"all"===r?(t.containerBalances.html(""),t.refreshAll(),t.container.find(".dexBalanceSumUsd").text("???"),t.container.find(".dexBalanceSumEth").text("???"),t.container.find(".walletBalanceSumUsd").text("???"),t.container.find(".walletBalanceSumEth").text("???"),t.controller.user.selectedAccount.refreshAll()):t.controller.user.selectedAccount.refreshBalanceByAddress(r)}),this.refreshSum=function(){let e=web3.toBigNumber(0),r=web3.toBigNumber(0),n=web3.toBigNumber(0),o=web3.toBigNumber(0);for(let a in t.controller.user.selectedAccount.balances){let i=t.controller.user.selectedAccount.balances[a];a!==ETH_ADDRESS&&(i.isNullBalance||(e=e.plus(i.dex.toUSD()),r=r.plus(i.dex.toETH()),n=n.plus(i.wallet.toUSD()),o=o.plus(i.wallet.toETH())))}t.container.find(".dexBalanceSumUsd").text(Formatter.priceFiat(e,t.controller.currencySelector.currentCurrency)).data("convertable-price",r.toFixed()),t.container.find(".dexBalanceSumEth").text(Formatter.volume(r)),t.container.find(".walletBalanceSumUsd").text(Formatter.priceFiat(n,t.controller.currencySelector.currentCurrency)).data("convertable-price",o.toFixed()),t.container.find(".walletBalanceSumEth").text(Formatter.volume(o))},this.resetFilter=function(){let e=this.container.find("#myBalanceTokenFilter");e.val(""),e.trigger("keyup.myBalanceTokenFilter"),jQuery("#hideNullBalances").prop("checked",!1).trigger("change.hideNullBalances"),t.controller.storage.setItem("hideNullBalances",!1)},this.fixMyBalanceHeader=function(e){e?($(".my-dex-wallet-sum").removeAttr("colspan"),$(".my-dex-wallet-sum").next().show()):($(".my-dex-wallet-sum").attr("colspan",2),$(".my-dex-wallet-sum").next().hide());let r=function(){if(t.controller.user.hasSelectedAccount()){let e='<span class="label label-'+t.controller.user.selectedAccount.type+'">'+t.controller.user.selectedAccount.type+" "+dexLang.t("title_address")+"</span>";t.container.find(".label-container").html(e)}};null!==t.controller.user.selectedAccount?r():this.controller.eventDispatcher.listen("user-post-instantitiate",function(){r()})}},DexMultiMyBalanceItemRenderer=function(e,t,r){this.controller=t,this.tokenAddress=e,this.filtertext=r.toLowerCase(),this.template=new DexTemplate("multi-my-balance-item"),this.templateSimple=new DexTemplate("my-balance-item"),this.container=jQuery("#myBalances"),this.render=function(){let e,t,r,n,o;e=this.controller.tokens[this.tokenAddress].symbol,r=this.controller.tokens[this.tokenAddress].name,t=e.toLowerCase(),n=r.toLowerCase(),o=this.tokenAddress===ETH_ADDRESS?this.templateSimple:this.template;let a={tokenAddress:this.tokenAddress,isNullBalance:this.controller.user.selectedAccount.balances[this.tokenAddress].isNullBalance,tokenSymbol:e,tokenName:r,tokenSymbolLower:t,tokenNameLower:n,dexTokenBalance:Formatter.haxRound(Formatter.volume(this.controller.user.selectedAccount.balances[this.tokenAddress].dex),e),dexTokenBalanceUsd:Formatter.priceFiat(this.controller.user.selectedAccount.balances[this.tokenAddress].dex.toCurrentFiat(),this.controller.currencySelector.currentCurrency),dexTokenBalanceEth:this.controller.user.selectedAccount.balances[this.tokenAddress].dex.toETH(),walletTokenBalance:Formatter.haxRound(Formatter.volume(this.controller.user.selectedAccount.balances[this.tokenAddress].wallet),e),walletTokenBalanceUsd:Formatter.priceFiat(this.controller.user.selectedAccount.balances[this.tokenAddress].wallet.toCurrentFiat(),this.controller.currencySelector.currentCurrency),walletTokenBalanceEth:this.controller.user.selectedAccount.balances[this.tokenAddress].wallet.toETH(),disabled:this.controller.tokens[this.tokenAddress].isDepositEnabled?"":"disabled",lowBalance:this.controller.user.selectedAccount.balances[this.tokenAddress].isLowBalance?"~ ":"",simpleWithdrawVisible:this.controller.multiwithdrawStatus?"hidden":"",multiWithdrawVisible:this.controller.multiwithdrawStatus?"":"hidden",simpleDepositVisible:this.controller.multidepositStatus?"hidden":"",multiDepositVisible:this.controller.multidepositStatus?"":"hidden"};o.replace(a);let i=!1;""!==this.filtertext&&t.indexOf(this.filtertext)<0&&n.indexOf(this.filtertext)<0&&(i=!0);let l=this.container.find('[data-token-address="'+this.tokenAddress+'"]');if(this.tokenAddress!==ETH_ADDRESS)if(l.length>0){let e=l.is(":visible");l.replaceWith(o.content),e&&!i&&this.container.find('[data-token-address="'+this.tokenAddress+'"]').show()}else this.container.append(o.content),this.controller.user.selectedAccount.balances[this.tokenAddress].isNullBalance&&this.controller.balanceRenderer.hideNullBalances||i||this.container.find('[data-token-address="'+this.tokenAddress+'"]').show()}},DexMultiFundForm=function(e,t){let r=this;jQuery("body");this.controller=t,this.container=jQuery("#myBalanceContainer"),this.type=e,this.data=null,this.transactionData={},this.applyFunctionData=[],this.init=function(){r.data=r.container.find("."+r.type+"-input").filter(function(){return""!==jQuery(this).val()}).serializeArray();for(let e in r.data){let t=r.data[e],n=t.name.substring(7);r.transactionData[n]=t.value}},this.validate=function(){let e=!0;r.clearFormErrors();for(let t in r.transactionData){let n=r.transactionData[t];if(!r.checkAvailableBalance(t,n)){e=!1;let n=this.container.find("."+r.type+'-input[name="amount_'+t+'"]').closest(".form-group");n.addClass("has-error"),n.find(".help-block").text(dexLang.t("errmsg_insufficient_funds"))}}return r.controller.user.checkUserKyc()||(e=!1),e},this.checkAvailableBalance=function(e,t){let n="withdraw"===this.type?"dex":"wallet",o=web3.toBigNumber(t);return r.controller.user.selectedAccount.balances[e][n].value.gte(o)},this.clearFormErrors=function(){r.container.find("."+r.type+"-input-fg.has-error").find(".help-block").text(""),r.container.find("."+r.type+"-input-fg.has-error").removeClass("has-error")},this.multiWithdraw=function(){let e=[],t=[],n=r.controller.user.selectedAccount.balances[ETH_ADDRESS].wallet.origValue;for(let n in r.transactionData)e.push(n),t.push(Formatter.formatForApi(r.transactionData[n],r.controller.tokens[n].decimals));r.applyFunctionData=[e,t];let o=r.controller.helper.createTransactionObj({toAddress:r.controller.dexVault.contract.contractAddress,fromAddress:dexEth.userAddress,contract:r.controller.dexVault.contract.contract,functionName:"multiWithdraw",applyFunctionData:r.applyFunctionData});dexEth.call("eth_estimateGas",[o],function(t,o){if(t)new DexApiErrorHandler(t,"withdraw",r.controller);else{let t=web3.fromWei(r.controller.gasApi.getGasPrice(),"gwei"),a=web3.toBigNumber(web3.toWei(o,"gwei"));a=a.mul(t),n.lt(a)?(r.controller.helper.closeModal(),swal({title:dexLang.t("title_warning"),text:dexLang.t("text_insufficient_funds_for_gas",{eth:web3.fromWei(a.toFixed(),"ether"),eur:web3.toBigNumber(web3.fromWei(a.toFixed(),"ether")).mul(web3.toBigNumber(r.controller.tokenPrices.getCurrentFiatPriceByAddress(ETH_ADDRESS))).toFixed(2),fiatSymbol:r.controller.currencySelector.currentCurrency.symbol}),icon:"warning"})):new Modal({title:dexLang.t("title_confirm_withdraw"),content:new DexMultiFundFormConfirmRenderer({transactionData:r.transactionData,gas:a},function(){r.applyFunctionData.push(function(e,t){e?r.withdrawTokenErrorCallback(e):r.withdrawTokenSuccessCallback(t)}),r.controller.dexVault.multiWithdraw(...r.applyFunctionData),e.map(function(e){r.controller.user.selectedAccount.balances[e].refreshable()})},r.controller).render()})}})},this.withdrawTokenSuccessCallback=function(e){swal({title:dexLang.t("title_withdraw_processing"),text:new DexTemplate("withdraw-confirm-success").replace({txHash:e}).content,icon:"success",html:!0}),new DexTransactionProcessingPopupRenderer(e,r.controller)},this.withdrawTokenErrorCallback=function(e){new DexApiErrorHandler(e,"withdraw",r.controller)},this.multiDeposit=function(){r.controller.eventDispatcher.listen("allowancesChecked",function(){let e=[],t=[],n=r.controller.user.selectedAccount.balances[ETH_ADDRESS].wallet.origValue;for(let n in r.transactionData)r.transactionData[n]&&(e.push(n),t.push(Formatter.formatForApi(r.transactionData[n],r.controller.tokens[n].decimals)));r.applyFunctionData=[e,t];let o=r.controller.helper.createTransactionObj({toAddress:r.controller.dexVault.contract.contractAddress,fromAddress:dexEth.userAddress,contract:r.controller.dexVault.contract.contract,functionName:"multiDeposit",applyFunctionData:r.applyFunctionData});dexEth.call("eth_estimateGas",[o],function(t,o){if(t)new DexApiErrorHandler(t,"deposit",r.controller);else{let t=web3.fromWei(r.controller.gasApi.getGasPrice(),"gwei"),a=web3.toBigNumber(web3.toWei(o,"gwei"));a=a.mul(t),n.lt(a)?(r.controller.helper.closeModal(),swal({title:dexLang.t("title_warning"),text:dexLang.t("text_insufficient_funds_for_gas",{eth:web3.fromWei(a.toFixed(),"ether"),eur:web3.toBigNumber(web3.fromWei(a.toFixed(),"ether")).mul(web3.toBigNumber(r.controller.tokenPrices.getCurrentFiatPriceByAddress(ETH_ADDRESS))).toFixed(2),fiatSymbol:r.controller.currencySelector.currentCurrency.symbol}),icon:"warning"})):new Modal({title:dexLang.t("title_confirm_withdraw"),content:new DexMultiFundFormConfirmRenderer({transactionData:r.transactionData,gas:a},function(){r.applyFunctionData.push(function(e,t){e?r.depositTokenErrorCallback(e):r.depositTokenSuccessCallback(t)}),r.controller.dexVault.multiDeposit(...r.applyFunctionData),e.map(function(e){r.controller.user.selectedAccount.balances[e].refreshable()})},r.controller).render()})}})}),r.checkAllowances()},this.approvesSet=!1,this.checkAllowances=function(){r.controller.eventDispatcher.listen("allowancesRefreshed",function(){let e={};Object.keys(r.transactionData).map(function(t){let n=r.transactionData[t];r.controller.user.selectedAccount.balances[t].allowance.lt(web3.toBigNumber(n))&&(e[t]=Formatter.formatForApi(n,r.controller.tokens[t].decimals))}),jQuery.isEmptyObject(e)?r.controller.eventDispatcher.trigger("allowancesChecked"):r.approvesSet?setTimeout(r.refreshAllowances,2e3):(r.controller.eventDispatcher.listen("approvesSet",function(){setTimeout(r.refreshAllowances,2e3)}),r.setApprove(e),r.approvesSet=!0)}),r.refreshAllowances()},this.refreshAllowances=function(){let e=Object.keys(r.transactionData).map(function(e){return"refreshEvent_"+e});r.controller.eventDispatcher.waitForAllEvents(e,function(){r.controller.eventDispatcher.trigger("allowancesRefreshed")}),Object.keys(r.transactionData).map(function(e){r.controller.user.selectedAccount.balances[e].refreshAllowance(function(){r.controller.eventDispatcher.trigger("refreshEvent_"+e)})})},this.setApprove=function(e){let t=Object.keys(e).map(function(e){return"approveEvent_"+e});r.controller.eventDispatcher.waitForAllEvents(t,function(){r.controller.eventDispatcher.trigger("approvesSet")}),new Modal({title:dexLang.t("title_processing"),content:new DexTemplate("processing-popup").content}),Object.keys(e).map(function(t){r.controller.tokens[t].contract().approve(r.controller.dexVault.contract.contractAddress,e[t],function(e,n){e&&(r.transactionData[t]=null),r.controller.eventDispatcher.trigger("approveEvent_"+t)})})},this.depositTokenSuccessCallback=function(e){swal({title:dexLang.t("title_deposit_processing"),text:new DexTemplate("deposit-confirm-success").replace({txHash:e}).content,icon:"success",html:!0}),new DexTransactionProcessingPopupRenderer(e,r.controller)},this.depositTokenErrorCallback=function(e){new DexApiErrorHandler(e,"deposit",r.controller)}},DexMultiFundFormConfirmRenderer=function(e,t,r){let n=this,o=jQuery("body");this.data=e,this.controller=r,this.template=new DexTemplate("multi-fund-form"),this.templateHeader=new DexTemplate("multi-fund-form-table-header"),this.templateItem=new DexTemplate("multi-fund-form-table-row"),this.render=function(){let e=jQuery('<table class="table table-condensed table-borderless"/>'),t=jQuery("<thead/>"),r=jQuery("<tbody/>");for(let e in n.data.transactionData){let t,o,a,i,l;n.templateItem.reset(),n.data.transactionData[e]?(o=(t=web3.toBigNumber(n.data.transactionData[e]).shift(n.controller.tokens[e].decimals)).mul(n.controller.tokens[e].depositFeeRate),a=Formatter.formatForPage(o),i=t.minus(o),l=Formatter.formatForPage(i,n.controller.tokens[e].decimals)):(a="-",l='<span class="text-danger"><b>'+dexLang.t("errmsg_approve_rejected")+"</b></span>"),n.templateItem.replace({amount:l,fee:a,tokenSymbol:n.controller.tokens[e].symbol}),r.append(n.templateItem.content)}return n.template.replace({estimatedGas:Formatter.formatForPage(n.data.gas)}),e.append(t.append(n.templateHeader.content)),e.append(r),this.template.replace("{fundsTable}",e[0].outerHTML),this.template.content},o.off("submit.confirm-fund-form"),o.on("submit.confirm-fund-form","#modal #modalContent #multi-fund-form",function(){return"function"==typeof t&&(t(),n.controller.helper.closeModal()),!1})},DexTokenGuidesRenderer=function(e){this.controller=e,this.templateButton=new DexTemplate("token-guides-button"),this.container=jQuery("#tokenGuidesContainer"),this.render=function(){if(void 0!==this.controller.selectedMarket){let e={tokenAddr:this.controller.selectedMarket.baseCurrencyAddress,tokenSymbol:this.controller.selectedMarket.baseCurrency.symbol,href:"/coin/"+this.controller.selectedMarket.baseCurrency.symbol};this.templateButton.replace(e),this.container.html(this.templateButton.content)}else this.container.html("")}},DexOrdersTableHeaderRenderer=function(e,t,r){this.data=e,this.type=r||"buy",this.controller=t;let n=this.controller.multitradeEnabled?"orderbook-table-header-multitrade":"orderbook-table-header";this.template=new DexTemplate(n),this.container=jQuery("#orderBookTable"+this.data.type+"Head"),this.tableSorter=new DexTableSorter({containerSelector:"#orderBookTable"+this.data.type,eventNamespace:"orderlistsortby",sortOptionsKey:"orderTable"+("buy"===r?"Buy":"Sell"),copyRowData:!0},this.controller),this.render=function(){if(0===this.container.find(".table-header").length){let e={baseTokenSymbol:this.controller.selectedMarket.baseCurrency.symbol,baseTokenAddress:this.controller.selectedMarket.baseCurrencyAddress,quoteTokenSymbol:this.controller.selectedMarket.quoteCurrency.symbol,quoteTokenAddress:this.controller.selectedMarket.quoteCurrencyAddress,usernameIsVisible:this.controller.showUserNames?"visible":"not-visible"};return this.template.replace(e),this.container.html(this.template.content)}}},DexTradesTableHeaderRenderer=function(e,t){this.data=e,this.controller=t,this.template=new DexTemplate("trades-table-header"),this.container=jQuery("#tradesTable"),this.tableSorter=new DexTableSorter({containerSelector:"#tradesTable",eventNamespace:"tradeslistsortby",sortOptionsKey:"tradesTable"},this.controller),this.render=function(){let e=this.container.find(".table-header"),t={baseTokenSymbol:this.controller.selectedMarket.baseCurrency.symbol,baseTokenAddress:this.controller.selectedMarket.baseCurrencyAddress,quoteTokenSymbol:this.controller.selectedMarket.quoteCurrency.symbol,quoteTokenAddress:this.controller.selectedMarket.quoteCurrencyAddress};if(this.template.replace(t),0===e.length)return this.container.prepend(this.template.content);jQuery(e[0]).parent().replaceWith(this.template.content)}},DexMyTransactionsRenderer=function(e){let t=this;this.controller=e;let r=function(e,t){let r=this;r.controller=t,r.containerId=e,r.container=jQuery("#"+r.containerId),this.show=function(){r.container.show()},this.hide=function(){r.container.hide()},this.html=function(e){r.container.html(e)},r.activeTab="trades",this.navTabs=r.container.find(".nav-tabs"),this.navTabs.find('a[data-toggle="tab"]').on("shown.bs.tab",function(e){r.activeTab=$(e.target).data("tab"),r.controller.eventDispatcher.trigger(r.containerId+".tab-changed",{activeTab:r.activeTab})}),this.isOnOrders=function(){return"orders"===r.activeTab},this.isOnTrades=function(){return"trades"===r.activeTab},this.isOnFunds=function(){return"funds"===r.activeTab}};this.containerNoAccount=new r("myTransactionsNoAccount",t.controller),this.containerExchange=new r("myTransactionsContainer",t.controller),this.containerExchangeHistory=new r("myTransactionsHistoryContainer",t.controller),this.render=function(){this.controller.user.hasAccount()?this.controller.switchController.isOnExchangePage()?(this.containerNoAccount.hide(),this.containerExchange.show(),this.containerExchangeHistory.hide()):(this.containerNoAccount.hide(),this.containerExchange.hide(),this.containerExchangeHistory.show()):(this.containerNoAccount.html(new DexTemplate("empty-balance-form").content),this.containerNoAccount.show(),this.containerExchange.hide(),this.containerExchangeHistory.hide(),this.controller.switchController.isOnExchangePage()||("ALL"===this.controller.marketsRenderer.filter.value?jQuery(".my-trades-box-title").text(dexLang.t("title_mytrades")):jQuery(".my-trades-box-title").text(dexLang.t("title_mytrades_filtered",{tokenName:t.controller.marketsRenderer.filter.value}))))}},DexMyFundsTableHeaderRenderer=function(e,t){this.data=e,this.controller=t,this.template=new DexTemplate("my-funds-table-header"),this.container=jQuery("#myFundsTableHead"),this.tableSorter=new DexTableSorter({containerSelector:"#myFundsTable",eventNamespace:"myfundslistsortby",sortOptionsKey:"myFundsTable"},this.controller),this.render=function(){this.container.html(this.template.content)}},DexMyOrdersTableHeaderRenderer=function(e,t){let r=this;this.data=e,this.controller=t;let n=this.controller.multicancelEnabled?"my-orders-table-header-multicancel":"my-orders-table-header";this.template=new DexTemplate(n),this.container=jQuery("#myOrdersTableHead"),this.tableSorter=new DexTableSorter({containerSelector:"#myOrdersTable",eventNamespace:"myorderlistsortby",sortOptionsKey:"myOrdersTable",copyRowData:!0},this.controller),this.render=function(){this.template.reset();let e={baseTokenSymbol:this.controller.selectedMarket.baseCurrency.symbol,baseTokenAddress:this.controller.selectedMarket.baseCurrency.address,quoteTokenSymbol:this.controller.selectedMarket.quoteCurrency.symbol,quoteTokenAddress:this.controller.selectedMarket.quoteCurrency.address};this.template.replace(e),this.container.html(this.template.content),r.controller.multicancelStatus?(r.container.find(".multicancel-checkbox-container").show(),r.container.find(".simple-cancel-button-container").hide()):(r.container.find(".multicancel-checkbox-container").hide(),r.container.find(".simple-cancel-button-container").show())}},DexMyTradesTableHeaderRenderer=function(e,t){this.data=e,this.controller=t,this.template=new DexTemplate("my-trades-table-header"),this.container=jQuery("#myTradesTableHead"),this.tableSorter=new DexTableSorter({containerSelector:"#myTradesTable",eventNamespace:"mytradeslistsortby",sortOptionsKey:"myTradesTable"},this.controller),this.render=function(){let e={baseTokenSymbol:this.controller.selectedMarket.baseCurrency.symbol,baseTokenAddress:this.controller.selectedMarket.baseCurrencyAddress,quoteTokenSymbol:this.controller.selectedMarket.quoteCurrency.symbol,quoteTokenAddress:this.controller.selectedMarket.quoteCurrencyAddress};this.template.replace(e),this.container.html(this.template.content)}},DexMyFundsHistoryTableHeaderRenderer=function(e,t){this.data=e,this.controller=t,this.template=new DexTemplate("my-funds-history-table-header"),this.container=jQuery("#myFundsHistoryTableHead"),this.tableSorter=new DexTableSorter({containerSelector:"#myFundsHistoryTable",eventNamespace:"myfundshistorylistsortby",sortOptionsKey:"myFundsTable"},this.controller),this.render=function(){this.container.html(this.template.content)}},DexMyOrdersHistoryTableHeaderRenderer=function(e,t){let r=this;this.data=e,this.controller=t;let n=this.controller.multicancelEnabled?"my-orders-history-table-header-multicancel":"my-orders-history-table-header";this.template=new DexTemplate(n),this.container=jQuery("#myOrdersHistoryTableHead"),this.tableSorter=new DexTableSorter({containerSelector:"#myOrdersHistoryTable",eventNamespace:"myorderhisorylistsortby",sortOptionsKey:"myOrdersTable",copyRowData:!0},this.controller),this.render=function(){this.template.reset();let e={tokenName:this.controller.selectedMarket.baseCurrency.symbol,baseTokenName:this.controller.selectedMarket.quoteCurrency.symbol};this.template.replace(e),this.container.html(this.template.content),r.controller.multicancelStatus?(r.container.find(".multicancel-checkbox-container").show(),r.container.find(".simple-cancel-button-container").hide()):(r.container.find(".multicancel-checkbox-container").hide(),r.container.find(".simple-cancel-button-container").show())}},DexMyTradesHistoryTableHeaderRenderer=function(e,t){this.data=e,this.controller=t,this.template=new DexTemplate("my-trades-history-table-header"),this.container=jQuery("#myTradesHistoryTableHead"),this.tableSorter=new DexTableSorter({containerSelector:"#myTradesHistoryTable",eventNamespace:"mytradeshistorylistsortby",sortOptionsKey:"myTradesTable"},this.controller),this.render=function(){let e={baseTokenSymbol:this.controller.selectedMarket.baseCurrency.symbol,baseTokenAddress:this.controller.selectedMarket.baseCurrencyAddress,quoteTokenSymbol:this.controller.selectedMarket.quoteCurrency.symbol,quoteTokenAddress:this.controller.selectedMarket.quoteCurrencyAddress};this.template.replace(e),this.container.html(this.template.content)}},DexCancelOrderConfirmRenderer=function(e,t,r){let n=this,o=jQuery("body");this.data=e,this.controller=r,this.template=new DexTemplate("cancel-order-confirm"),this.render=function(){return this.template.content},o.off("click.confirm-cancel-order"),o.on("click.confirm-cancel-order","#modal #modalContent [data-confirm-cancel-order]",function(){"function"==typeof t&&n.controller.user.checkUserKyc()&&(t(),n.controller.helper.closeModal())})},DexDepositConfirmRenderer=function(e,t,r){let n=this,o=jQuery("body");this.data=e,this.controller=r,this.template=new DexTemplate("deposit-confirm"),this.render=function(){let e={estimatedGas:Formatter.formatForDisplay(Formatter.formatForPage(this.data.estimateGas)),depositFee:Formatter.formatForDisplay(Formatter.formatForPage(this.data.depositFee,this.data.decimals)),amountCredited:Formatter.formatForDisplay(Formatter.formatForPage(this.data.amountCredited,this.data.decimals)),depositTokenSymbol:this.controller.tokens[this.data.tokenAddr].symbol,depositTokenAddress:this.controller.tokens[this.data.tokenAddr].address};return this.template.replace(e),this.template.content},o.off("click.confirm-deposit"),o.on("click.confirm-deposit","#modal #modalContent [data-confirm-deposit]",function(){"function"==typeof t&&(t(),n.controller.helper.closeModal())})},DexMarketDropdownRenderer=function(e,t){let r=this,n=jQuery("body");this.container=null,this.controller=e,this.containerId="marketsDropdown",this.containerSelector="#"+this.containerId,this.templateBase=new DexTemplate("market-dropdown-base"),this.template=new DexTemplate("market-dropdown"),this.templateItem=new DexTemplate("market-dropdown-item"),this.templateSearchForm=new DexTemplate("market-dropdown-search-from"),this.render=function(){let e=dexLang.t("text_choose_market"),t="";this.templateBase.reset(),this.template.reset(),this.templateItem.reset(),this.templateSearchForm.reset();let r="";for(let n in this.controller.markets){if(!this.controller.markets[n].isEnabled||!this.controller.markets[n].isVisible)continue;let o={marketId:this.controller.markets[n].id,marketName:this.controller.markets[n].name,marketNameLower:this.controller.markets[n].name.toLowerCase()+"/"+this.controller.markets[n].baseCurrency.name.toLowerCase()+"/"+this.controller.markets[n].quoteCurrency.name,baseTokenName:this.controller.markets[n].baseCurrency.name,quoteTokenName:this.controller.markets[n].quoteCurrency.name};this.templateItem.replace(o),n===this.controller.selectedMarket.id?(e=this.controller.selectedMarket.id,t=this.controller.markets[n].name):r+=this.templateItem.content,this.templateItem.reset()}let n={searchForm:this.templateSearchForm.content,items:r,selectedMarketName:t};this.template.replace(n),this.templateBase.replace("{marketSelect}",this.template.content),this.container=jQuery(this.containerSelector),this.container.html(this.templateBase.content),this.bindEvents()},n.off("click.market"+this.containerId),n.on("click.market"+this.containerId,this.containerSelector+" .market-select-container .change-market",function(){r.render()}),this.bindEvents=function(){this.container.on("submit.marketSearchMarket",".market-select-container .marketSearchText",function(){return!1}),this.container.off("keyup.marketSearchMarket"),this.container.on("keyup.marketSearchMarket",".market-select-container .marketSearchText",function(){let e=jQuery.trim(jQuery(this).val().toLowerCase());if(r.container.find(".search-result-not-found").hide(),""!==e){r.container.find("[data-market-name]").hide();let t=r.container.find('[data-market-name*="'+e+'"]');t.length>0?t.show():r.container.find(".search-result-not-found").show()}else r.container.find("[data-market-name]").show()})}},DexMyFundsRenderer=function(e,t){let r=this;this.data=e,this.controller=t,this.container=jQuery("#myFundsTable"),this.containerBody=jQuery("#myFundsTableBody"),this.template=new DexTemplate("my-funds-table-row"),this.emptyTable=new DexEmptyTablePlaceholderRenderer(r.controller,{container:this.containerBody,templatePostfix:"fund"}),this.render=function(){if(this.controller.user.hasAccount()){if(this.data.length>0){this.container.find("p.text-center").remove();let e=new DexMyFundsTableHeaderRenderer([],this.controller);e.render();for(let e=0;e<this.data.length;++e){let t=this.data[e],n=r.container.find('[data-signature="'+t.signature+'"]');if(t.is_removed)n.remove();else{let e={hash:t.eth_hash.substring(0,10),txHash:t.eth_hash,time:new Date(t.created).getTime(),date:Formatter.date(t.created),kind:t.type,tokenSymbol:this.controller.tokens[t.token_address].symbol,tokenAddress:this.controller.tokens[t.token_address].address,amount:Formatter.volume(t.amount),balance:Formatter.volume(t.balance),signature:t.signature};this.template.replace(e),n.length>0?jQuery(n[0]).replaceWith(this.template.content):this.containerBody.append(this.template.content)}this.template.reset()}e.tableSorter.sort()}this.emptyTable.render()}else this.container.html(new DexTemplate("empty-balance-form").content);r.controller.eventDispatcher.trigger("moduleRendered",{container:jQuery("#myFunds")})},this.controller.eventDispatcher.listen("backToMarkets",function(){r.containerBody.html("")})},DexMyOrdersRenderer=function(e,t){let r=this,n=jQuery("body");this.data=e,this.controller=t,this.container=jQuery("#myOrdersTable"),this.containerBody=jQuery("#myOrdersTableBody"),this.multiCancelButton=jQuery("#multiCancelButton"),this.applyMultiCancelButton=jQuery("#applyMultiCancelButton");let o=this.controller.multicancelEnabled?"my-orders-row-multicancel":"my-orders-row";this.controller.multicancelEnabled&&r.controller.myTransactionsRenderer.containerExchange.isOnOrders()?this.multiCancelButton.show():this.multiCancelButton.hide(),this.template=new DexTemplate(o),this.emptyTable=new DexEmptyTablePlaceholderRenderer(r.controller,{container:this.containerBody,templatePostfix:"order"}),this.render=function(){if(this.controller.user.hasAccount()){if(void 0!==this.data&&this.data.length>0){let e=new DexMyOrdersTableHeaderRenderer({tokenName:this.controller.selectedMarket.baseCurrency.symbol},this.controller);e.render(),new Promise(function(e,t){for(let e=0;e<r.data.length;++e){let t=r.data[e],n=new Date(t.expire),o=r.containerBody.find('[data-signature="'+t.signature+'"]');if(n.getTime()<=(new Date).getTime()||"open"!==t.status){jQuery(o).remove();continue}let a=r.controller.getMarketByAddresses(t.base_address,t.quote_address),i={price:Formatter.price(parseFloat(t.quote_amount)/parseFloat(t.base_amount)),availableAmount:Formatter.volume(t.available_amount),type:t.type,signature:t.signature,expires:n.getTime(),expiresLabel:n.toLocaleString(),expiresTime:Formatter.dateDiffAhead(n),marketKey:a.id+"-"+t.type};r.template.replace(i);let l=r.controller.helper.checkOrderVisibility(t);o.length>0?l?jQuery(o).replaceWith(r.template.content):jQuery(o).remove():l&&r.containerBody.append(r.template.content),r.template.reset(),jQuery('[data-signature="'+t.signature+'"]').data(t)}r.toggleControlElements(),e()}).then(function(t){t&&e.tableSorter.sort()})}this.emptyTable.render()}else this.containerBody.html(new DexTemplate("empty-balance-form").content);r.controller.eventDispatcher.trigger("moduleRendered",{container:jQuery("#myOrders")})},this.toggleApplyButton=function(){r.container.find("input:checkbox:checked:not(.multicancel-toggle-checked)").length>0?r.applyMultiCancelButton.show():r.applyMultiCancelButton.hide()},this.toggleControlElements=function(){r.controller.multicancelStatus?(r.container.find(".multicancel-checkbox-container").show(),r.container.find(".simple-cancel-button-container").hide()):(r.container.find(".multicancel-checkbox-container").hide(),r.container.find(".simple-cancel-button-container").show())},this.initSimpleCancel=function(){r.controller.multicancelStatus=!1,r.container.find(".multicancel-checkbox-container").hide(),r.container.find(".simple-cancel-button-container").show(),r.container.off("click.simpleCancel"),r.container.off("click.collectRowsCancel"),r.applyMultiCancelButton.hide(),r.container.on("click.simpleCancel",".cancel-button",function(){let e=jQuery(this).closest(".myorder-row"),t=jQuery(this).closest(".myorder-row").data();new Modal({title:dexLang.t("title_confirm_cancel"),content:new DexCancelOrderConfirmRenderer({},function(){let n=[t.base_address,t.quote_address,web3.toBigNumber(Formatter.formatForApi(t.base_amount,r.controller.tokens[t.base_address].decimals)),web3.toBigNumber(Formatter.formatForApi(t.quote_amount,r.controller.tokens[t.quote_address].decimals)),"buy"===t.type,new Date(t.expire).getTime()/1e3,t.nonce,t.ecds_v,t.ecds_r,t.ecds_s,function(t,n){t?new DexApiErrorHandler(t,"order-cancellation",r.controller):(jQuery(e).remove(),new DexTransactionProcessingPopupRenderer(n,r.controller))}];r.controller.dexExchange.cancel(...n)},r.controller).render()})})},this.initMultiCancel=function(){r.controller.multicancelStatus=!0,r.container.find(".multicancel-checkbox-container").show(),r.container.find(".simple-cancel-button-container").hide(),r.container.off("click.simpleCancel"),r.container.off("click.collectRowsCancel"),r.container.off("click.collectRowsCancelGlobal"),r.toggleApplyButton(),r.controller.helper.makeClickableRows(r.container,"collectRowsCancel","collectRowsCancelGlobal",r.toggleApplyButton,r.toggleApplyButton),n.on("click.multiCancelModal","#applyMultiCancelButton",function(){if(r.controller.user.hasAccount()){let e=r.container.find("tr:has(input:checkbox:checked:not(.global-clickable-row-toggle))");r.toggleApplyButton(),new DexMultiCancelFormRenderer(e,r.controller,function(){r.toggleApplyButton()}).render()}else new Modal({title:dexLang.t("title_important"),content:"<p>"+dexLang.t("text_user_not_logged_popup")+"</p>"})})},this.controller.multicancelEnabled?(r.controller.eventDispatcher.listen("myTransactionsContainer.tab-changed",function(e,t){"orders"===t.activeTab?(r.multiCancelButton.show(),r.toggleApplyButton()):(r.multiCancelButton.hide(),r.applyMultiCancelButton.hide())}),n.off("click.toggleMultiCancel"),n.on("click.toggleMultiCancel","#multiCancelButton",function(){r.controller.multicancelStatus?r.initSimpleCancel():r.initMultiCancel()}),r.controller.multicancelStatus?r.initMultiCancel():r.initSimpleCancel()):r.initSimpleCancel(),this.controller.eventDispatcher.listen("backToMarkets",function(){r.containerBody.html("")})},DexMyTradesRenderer=function(e,t){let r=this;this.data=e,this.controller=t,this.container=jQuery("#myTradesTable"),this.containerBody=jQuery("#myTradesTableBody"),this.template=new DexTemplate("my-trade-table-row"),this.emptyTable=new DexEmptyTablePlaceholderRenderer(r.controller,{container:this.containerBody,templatePostfix:"trade"}),this.render=function(){if(this.controller.user.hasAccount()){if(this.data.length>0){this.container.find("p.text-center").remove();let e=new DexMyTradesTableHeaderRenderer({tokenName:this.controller.selectedMarket.baseCurrency.symbol},this.controller);e.render(),this.data.forEach(function(e){e.tokenPrice=web3.toBigNumber(e.price).dividedBy(web3.toBigNumber(e.amount)).toFixed()});for(let e=0;e<this.data.length;++e){let t,n=this.data[e],o=r.container.find('[data-signature="'+n.signature+'"]');if(n.is_removed)o.remove();else{"buy"===n.type?t=n.make_address===this.controller.user.selectedAccount.address?"buy":n.take_address===this.controller.user.selectedAccount.address?"sell":n.type:"sell"===n.type&&(t=n.make_address===this.controller.user.selectedAccount.address?"sell":n.take_address===this.controller.user.selectedAccount.address?"buy":n.type);r.controller.getMarketByAddresses(n.base_address,n.quote_address);let e={signature:n.signature,price:Formatter.haxRound(Formatter.price(n.tokenPrice),r.controller.tokens[n.base_address].symbol),amount:Formatter.volume(n.amount),date:Formatter.date(n.created),time:new Date(n.created).getTime(),type:t,hash:n.eth_hash.substring(0,10),txHash:n.eth_hash};this.template.replace(e),o.length>0?jQuery(o[0]).replaceWith(this.template.content):this.containerBody.prepend(this.template.content)}this.template.reset(),1===this.data.length&&n.take_address!==this.controller.user.selectedAccount.address&&this.controller.user.selectedAccount.refreshBalanceByAddress([n.base_address,n.quote_address])}e.tableSorter.sort()}this.emptyTable.render()}else this.container.html(new DexTemplate("empty-balance-form").content);r.controller.eventDispatcher.trigger("moduleRendered",{container:jQuery("#myTrades")}),r.controller.currencySelector.refresh()},this.controller.eventDispatcher.listen("backToMarkets",function(){r.containerBody.html("")})},DexMyFundsHistoryRenderer=function(e,t){let r=this;this.data=e,this.controller=t,this.container=jQuery("#myFundsHistoryTable"),this.containerBody=jQuery("#myFundsHistoryTableBody"),this.template=new DexTemplate("my-funds-history-table-row"),this.emptyTable=new DexEmptyTablePlaceholderRenderer(r.controller,{container:this.containerBody,templatePostfix:"fund"}),this.render=function(){if(this.controller.user.hasAccount()){if(this.data.length>0){let e=new DexMyFundsHistoryTableHeaderRenderer([],this.controller);e.render();for(let e=0;e<this.data.length;++e){let t=this.data[e],n=r.container.find('[data-signature="'+t.signature+'"]');if(t.is_removed)n.remove();else{let e={hash:t.eth_hash.substring(0,10),txHash:t.eth_hash,time:new Date(t.created).getTime(),date:Formatter.date(t.created),kind:t.type,tokenSymbol:this.controller.tokens[t.token_address].symbol,tokenAddress:this.controller.tokens[t.token_address].address,amount:Formatter.volume(t.amount),balance:Formatter.volume(t.balance),marketKey:this.controller.tokens[t.token_address].symbol,signature:t.signature};this.template.replace(e),n.length>0?jQuery(n[0]).replaceWith(this.template.content):this.containerBody.append(this.template.content)}this.template.reset()}e.tableSorter.sort()}this.emptyTable.render()}else this.container.html(new DexTemplate("empty-balance-form").content);r.controller.eventDispatcher.trigger("moduleRendered",{container:jQuery("#myFundsHistory")}),r.controller.marketsRenderer.filter.doFilter(),r.controller.currencySelector.refresh()}},DexMyOrdersHistoryRenderer=function(e,t){let r=this,n=jQuery("body");this.data=e,this.controller=t,this.container=jQuery("#myOrdersHistoryTable"),this.containerBody=jQuery("#myOrdersHistoryTableBody"),this.multiCancelButton=jQuery("#multiCancelButton"),this.applyMultiCancelButton=jQuery("#applyMultiCancelButton");let o=this.controller.multicancelEnabled?"my-orders-history-row-multicancel":"my-orders-history-row";this.controller.multicancelEnabled&&r.controller.myTransactionsRenderer.containerExchangeHistory.isOnOrders()?this.multiCancelButton.show():this.multiCancelButton.hide(),this.template=new DexTemplate(o),this.emptyTable=new DexEmptyTablePlaceholderRenderer(r.controller,{container:this.containerBody,templatePostfix:"order"}),this.render=function(){if(this.controller.user.hasAccount()){if(void 0!==this.data&&this.data.length>0){let e=new DexMyOrdersHistoryTableHeaderRenderer({tokenName:this.controller.selectedMarket.baseCurrency.symbol},this.controller);e.render(),new Promise(function(e,t){for(let e=0;e<r.data.length;++e){let t=r.data[e],n=new Date(t.expire),o=r.containerBody.find('[data-signature="'+t.signature+'"]');if(n.getTime()<=(new Date).getTime()||"open"!==t.status){jQuery(o).remove();continue}let a=r.controller.getMarketByAddresses(t.base_address,t.quote_address),i={price:Formatter.price(parseFloat(t.quote_amount)/parseFloat(t.base_amount)),availableAmount:Formatter.volume(t.available_amount),type:t.type,signature:t.signature,expires:n.getTime(),expiresLabel:n.toLocaleString(),expiresTime:Formatter.dateDiffAhead(n),baseTokenSymbol:a.baseCurrency.symbol,baseTokenAddress:t.base_address,quoteTokenSymbol:a.quoteCurrency.symbol,quoteTokenAddress:t.quote_address,marketKey:a.id+"-"+t.type,marketId:a.id};r.template.replace(i);let l=r.controller.helper.checkOrderVisibility(t);o.length>0?l?jQuery(o).replaceWith(r.template.content):jQuery(o).remove():l&&r.containerBody.append(r.template.content),r.template.reset(),jQuery('[data-signature="'+t.signature+'"]').data(t)}r.toggleControlElements(),e()}).then(function(t){t&&e.tableSorter.sort()})}this.emptyTable.render()}else this.containerBody.html(new DexTemplate("empty-balance-form").content);r.controller.eventDispatcher.trigger("moduleRendered",{container:jQuery("#myOrdersHistory")}),r.controller.marketsRenderer.filter.doFilter(),r.controller.currencySelector.refresh()},this.toggleApplyButton=function(){r.container.find("input:checkbox:checked:not(.multicancel-toggle-checked)").length>0?r.applyMultiCancelButton.show():r.applyMultiCancelButton.hide()},this.toggleControlElements=function(){r.controller.multicancelStatus?(r.container.find(".multicancel-checkbox-container").show(),r.container.find(".simple-cancel-button-container").hide()):(r.container.find(".multicancel-checkbox-container").hide(),r.container.find(".simple-cancel-button-container").show())},this.initSimpleCancel=function(){r.controller.multicancelStatus=!1,r.toggleControlElements(),r.container.off("click.simpleCancelHistory"),r.container.off("click.collectRowsCancelHistory"),r.applyMultiCancelButton.hide(),r.container.on("click.simpleCancel",".cancel-button",function(){let e=jQuery(this).closest(".myorder-row"),t=jQuery(this).closest(".myorder-row").data();new Modal({title:dexLang.t("title_confirm_cancel"),content:new DexCancelOrderConfirmRenderer({},function(){let n=[t.base_address,t.quote_address,web3.toBigNumber(Formatter.formatForApi(t.base_amount,r.controller.tokens[t.base_address].decimals)),web3.toBigNumber(Formatter.formatForApi(t.quote_amount,r.controller.tokens[t.quote_address].decimals)),"buy"===t.type,new Date(t.expire).getTime()/1e3,t.nonce,t.ecds_v,t.ecds_r,t.ecds_s,function(t,n){t?new DexApiErrorHandler(t,"order-cancellation",r.controller):(jQuery(e).remove(),new DexTransactionProcessingPopupRenderer(n,r.controller))}];r.controller.dexExchange.cancel(...n)},r.controller).render()})})},this.initMultiCancel=function(){r.controller.multicancelStatus=!0,r.toggleControlElements(),r.container.off("click.simpleCancelHistory"),r.container.off("click.collectRowsCancelHistory"),r.container.off("click.collectRowsCancelGlobalHistory"),r.toggleApplyButton(),r.controller.helper.makeClickableRows(r.container,"collectRowsCancelHistory","collectRowsCancelGlobalHistory",r.toggleApplyButton,r.toggleApplyButton),n.on("click.multiCancelModalHistory","#applyMultiCancelButton",function(){if(r.controller.user.hasAccount()){let e=r.container.find("tr:has(input:checkbox:checked:not(.global-clickable-row-toggle))");r.toggleApplyButton(),new DexMultiCancelFormRenderer(e,r.controller,function(){r.toggleApplyButton()}).render()}else new Modal({title:dexLang.t("title_important"),content:"<p>"+dexLang.t("text_user_not_logged_popup")+"</p>"})})},this.controller.multicancelEnabled?(r.controller.eventDispatcher.listen("myTransactionsHistoryContainer.tab-changed",function(e,t){"orders"===t.activeTab?(r.multiCancelButton.show(),r.toggleApplyButton()):(r.multiCancelButton.hide(),r.applyMultiCancelButton.hide())}),n.off("click.toggleMultiCancel"),n.on("click.toggleMultiCancel","#multiCancelButton",function(){r.controller.multicancelStatus?r.initSimpleCancel():r.initMultiCancel()}),r.controller.multicancelStatus?r.initMultiCancel():r.initSimpleCancel()):r.initSimpleCancel(),this.controller.eventDispatcher.listen("marketChanged",function(){r.containerBody.html("")})},DexMyTradesHistoryRenderer=function(e,t){let r=this;this.data=e,this.controller=t,this.container=jQuery("#myTradesHistoryTable"),this.containerBody=jQuery("#myTradesHistoryTableBody"),this.template=new DexTemplate("my-trade-history-table-row"),this.emptyTable=new DexEmptyTablePlaceholderRenderer(r.controller,{container:this.containerBody,templatePostfix:"trade"}),this.render=function(){if(this.controller.user.hasAccount()){if(this.data.length>0){this.container.find("p.text-center").remove();let e=new DexMyTradesHistoryTableHeaderRenderer({tokenName:this.controller.selectedMarket.baseCurrency.symbol},this.controller);e.render(),this.data=this.data.reverse();for(let e=0;e<this.data.length;++e){let t,n=this.data[e],o=r.container.find('[data-signature="'+n.signature+'"]');if(n.is_removed)o.remove();else{"buy"===n.type?t=n.make_address===this.controller.user.selectedAccount.address?"buy":n.take_address===this.controller.user.selectedAccount.address?"sell":n.type:"sell"===n.type&&(t=n.make_address===this.controller.user.selectedAccount.address?"sell":n.take_address===this.controller.user.selectedAccount.address?"buy":n.type);let e=r.controller.getMarketByAddresses(n.base_address,n.quote_address),a={signature:n.signature,price:Formatter.price(n.price),amount:Formatter.volume(n.amount),date:Formatter.date(n.created),time:new Date(n.created).getTime(),type:t,hash:n.eth_hash.substring(0,10),txHash:n.eth_hash,baseTokenSymbol:e.baseCurrency.symbol,baseTokenAddress:n.base_address,quoteTokenSymbol:e.quoteCurrency.symbol,quoteTokenAddress:n.quote_address,marketKey:e.id+"-"+t,marketId:e.id};this.template.replace(a),o.length>0?jQuery(o[0]).replaceWith(this.template.content):this.containerBody.prepend(this.template.content)}this.template.reset(),1===this.data.length&&n.takeAddress!==this.controller.user.selectedAccount.address&&this.controller.user.selectedAccount.refreshBalanceByAddress([n.tokenAddress,n.baseTokenAddress])}e.tableSorter.sort()}this.emptyTable.render()}else this.container.html(new DexTemplate("empty-balance-form").content);r.controller.eventDispatcher.trigger("moduleRendered",{container:jQuery("#myTradesHistory")}),r.controller.marketsRenderer.filter.doFilter(),r.controller.currencySelector.refresh()},this.controller.eventDispatcher.listen("marketChanged",function(){r.containerBody.html("")})},DexOrdersRenderer=function(e,t){let r=this,n=jQuery("body");this.data=e,this.controller=t,this.addressToUsername={},this.container=jQuery("#orders"),this.containerBuys=jQuery("#orderBookTableBuys"),this.containerBuysBody=jQuery("#orderBookTableBuysBody"),this.containerSells=jQuery("#orderBookTableSells"),this.containerSellsBody=jQuery("#orderBookTableSellsBody"),this.multiTradeButton=jQuery("#multiTradeButton"),this.applyMultiTradeButton=jQuery("#applyMultiTradeButton");let o=this.controller.multitradeEnabled?"orderbook-row-multitrade":"orderbook-row";this.template=new DexTemplate(o),this.controller.multitradeEnabled&&this.multiTradeButton.show(),this.emptyBodyBuys=new DexEmptyTablePlaceholderRenderer(r.controller,{type:dexLang.t("text_orders"),container:this.containerBuysBody}),this.emptyBodySells=new DexEmptyTablePlaceholderRenderer(r.controller,{type:dexLang.t("text_orders"),container:this.containerSellsBody}),this.loadAddressToUsername=function(){jQuery.ajax({url:"/dex-v2/get-address-to-username",data:{},dataType:"json",async:!1,success:function(e){e.success?r.addressToUsername=e.data:r.controller.showUserNames=!1}})},this.render=function(){let e;r.controller.showUserNames&&r.loadAddressToUsername();let t=new DexOrdersTableHeaderRenderer({tokenName:this.controller.selectedMarket.baseCurrency.symbol,type:"Buys"},this.controller,"buy");t.render();let n=new DexOrdersTableHeaderRenderer({tokenName:this.controller.selectedMarket.baseCurrency.symbol,type:"Sells"},this.controller,"sell");if(n.render(),void 0!==this.data&&this.data.length>0){var o=jQuery("<div></div>"),a=jQuery("<div></div>");for(let t=0;t<this.data.length;++t){e=this.data[t];let n=new Date(e.expire),i=r.container.find('[data-signature="'+e.signature+'"]');if(r.controller.orderExpireObserver.addOrder(e),n.getTime()<=(new Date).getTime()||"open"!==e.status){jQuery(i).remove();continue}r.controller.getMarketByAddresses(e.base_address,e.quote_address);let l=web3.toBigNumber(e.quote_amount).dividedBy(web3.toBigNumber(e.base_amount)),s=!1;r.controller.user.hasAccount()&&(s=e.make_address===r.controller.user.selectedAccount.address)&&(r.controller.orderPlacedCounter+=1);let c={price:Formatter.price(l.toFixed()),availableAmount:Formatter.formatForDisplay(e.available_amount,3),quoteAmount:Formatter.formatForDisplay(l*e.available_amount,3),type:e.type,signature:e.signature,expires:n.getTime(),expiresLabel:n.toLocaleString(),expiresTime:Formatter.dateDiffAhead(n),owner:s?'<span class="glyphicon glyphicon-user"></span>':"",isOwner:s?"1":"0",makeAddress:e.makeAddress};r.controller.multitradeEnabled&&(r.controller.multitradeStatus?c.isVisible="visible":c.isVisible=""),r.controller.showUserNames?(c.username=r.addressToUsername[e.make_address],c.usernameIsVisible="visible"):(c.username="",c.usernameIsVisible="not-visible"),this.template.replace(c);let d=jQuery(this.template.content);d.data(e);let u=this.controller.helper.checkOrderVisibility(e);u?this.controller.dexDepthChartDataCache[e.type][e.signature]={price:Formatter.price(l.toFixed()),volume:e.available_amount}:void 0!==this.controller.dexDepthChartDataCache[e.type][e.signature]&&delete this.controller.dexDepthChartDataCache[e.type][e.signature],i.length>0?u?jQuery(i[0]).replaceWith(this.template.content):jQuery(i[0]).remove():"buy"==e.type?u&&o.append(d):u&&a.append(d),jQuery('[data-signature="'+e.signature+'"]').data(e),this.template.reset()}this.containerBuysBody.append(o.children()),this.containerSellsBody.append(a.children()),t.tableSorter.sort(),n.tableSorter.sort()}r.controller.orderExpireObserver.observe(),this.emptyBodyBuys.render(),this.emptyBodySells.render(),r.controller.switchController.isOnExchangePage()?r.controller.depthChartRenderer.render():r.controller.eventDispatcher.listen("pageStateChangedChart",function(){r.controller.depthChartRenderer.render()}),r.controller.eventDispatcher.trigger("moduleRendered",{container:r.containerSells}),r.controller.currencySelector.refresh()},this.initSimpleTrade=function(){r.container.find(".multitrade-checkbox-container").hide(),r.container.off("click.tradeModal"),r.container.off("click.collectRows"),r.container.off("click.collectRowsGlobal"),n.off("click.multiTradeModal"),r.applyMultiTradeButton.hide(),r.controller.multitradeStatus=!1,r.container.on("click.tradeModal",".clickable-row",function(){if(r.controller.user.hasAccount()){let e=jQuery(this).data();new Modal({title:dexLang.t("title_trade"),content:new DexTradeFormRenderer(e,r.controller).render()}),r.controller.currencySelector.refresh()}else new Modal({title:dexLang.t("title_important"),content:"<p>"+dexLang.t("text_user_not_logged_popup")+"</p>"})})},this.initMultiTrade=function(){r.container.off("click.tradeModal"),r.container.off("click.collectRowsGlobal"),n.off("click.multiTradeModal"),r.controller.multitradeStatus=!0,r.container.find(".multitrade-checkbox-container").show(),r.toggleApplyButton(),r.controller.helper.makeClickableRows(r.container,"collectRows","collectRowsGlobal",r.toggleApplyButton,r.toggleApplyButton),n.on("click.multiTradeModal","#applyMultiTradeButton",function(){if(r.controller.helper.loginConfirmPopup()){let e=r.container.find(".tab-pane:visible tr:has(input:checkbox:checked:not(.global-clickable-row-toggle))");r.container.find(".tab-pane:visible input:checkbox:checked:not(.global-clickable-row-toggle)").prop("checked",!1),r.toggleApplyButton(),new Modal({title:dexLang.t("title_multi_trade"),content:new DexMultiTradeFormRenderer(e,r.controller).render()})}})},this.toggleApplyButton=function(){r.container.find("input:checkbox:checked:not(.multitrade-toggle-checked)").length>0?r.applyMultiTradeButton.show():r.applyMultiTradeButton.hide()},this.controller.eventDispatcher.listen("backToMarkets",function(){r.controller.multitradeStatus=!1,r.applyMultiTradeButton.hide(),r.container.off("click.tradeModal"),r.container.off("click.collectRows"),r.container.off("click.toggleMultiTradeGlobalChecked"),n.off("click.multiTradeModal")}),this.controller.multitradeEnabled?(n.off("click.toggleMultiTrade"),n.on("click.toggleMultiTrade","#multiTradeButton",function(){r.controller.multitradeStatus?r.initSimpleTrade():r.initMultiTrade()}),r.controller.multitradeStatus?r.initMultiTrade():r.initSimpleTrade()):r.initSimpleTrade()},DexTickersTableHeaderRenderer=function(e,t){let r=this;t=t||{},this.controller=e,this.template=new DexTemplate("ticker-table-head"),this.containerDiv=t.containerDiv||"#tickerTable",this.containerHeadDiv=t.containerHeadDiv||"#tickerTableHead",this.containerBodyDiv=t.containerBodyDiv||"#tickerTableBody",this.eventNamespace=t.eventNamespace||"tickerlistsortby",this.sortOptionsKey=t.sortOptionsKey||"tickerTable",this.tableSorter=new DexTableSorter({containerSelector:r.containerDiv,eventNamespace:r.eventNamespace,sortOptionsKey:r.sortOptionsKey,afterSort:function(){let e=r.container.find('[data-token-address="'+r.controller.selectedMarket.baseCurrencyAddress+'"]'),t=e.clone();e.remove(),jQuery(r.containerBodyDiv).prepend(t)}},this.controller),this.render=function(){this.container=jQuery(this.containerDiv),this.containerHead=jQuery(this.containerHeadDiv),this.containerHead.html(this.template.content)}},DexTickersRenderer=function(e,t){let r=this;this.data=e,this.controller=t,this.container=jQuery("#tickerTable"),this.containerBody=jQuery("#tickerTableBody"),this.template=new DexTemplate("ticker-table-row"),this.render=function(){this.containerBody.html("");let e=new DexTickersTableHeaderRenderer(r.controller);e.render();let t={};for(let e=0;e<this.data.length;e++){let r=this.data[e],n=this.controller.getMarketByAddresses(r.base_address,r.quote_address);if(void 0!==n&&void 0===t[n.id]){t[n.id]=n.id;let e=0!==parseFloat(r.base_volume)?Formatter.priceTicker(r.base_volume,4):"-",o=0!==parseFloat(r.quote_volume)?Formatter.priceTicker(r.quote_volume,4):"-",a=null!==r.bid_price?Formatter.priceTicker(r.bid_price,4):"-",i=null!==r.ask_price?Formatter.priceTicker(r.ask_price,4):"-",l=null!==r.last_price?Formatter.priceTicker(r.last_price,4):"-",s=0!==parseFloat(r.base_volume)?Formatter.priceTicker(r.base_volume):"-",c=0!==parseFloat(r.quote_volume)?Formatter.priceTicker(r.quote_volume):"-",d=null!==r.bid_price?Formatter.priceTicker(r.bid_price):"-",u=null!==r.ask_price?Formatter.priceTicker(r.ask_price):"-",h=null!==r.last_price?Formatter.priceTicker(r.last_price):"-",m={marketName:n.name,marketId:n.id,baseVolume:e,quoteVolume:o,bid:a,ask:i,lastPrice:l,eBaseVolume:e!=s?s:"",eQuoteVolume:o!=c?c:"",eBid:a!=d?d:"",eAsk:i!=u?u:"",eLastPrice:l!=h?h:""};this.template.replace(m),this.containerBody.append(this.template.content),this.template.reset()}}e.tableSorter.sort(),r.controller.eventDispatcher.trigger("moduleRendered",{container:r.containerBody})}},DexTradesRenderer=function(e,t){let r=this;this.data=e,this.controller=t,this.container=jQuery("#tradesTable"),this.containerBody=jQuery("#tradesTableBody"),this.template=new DexTemplate("trade-table-row"),this.emptyTable=new DexEmptyTablePlaceholderRenderer(r.controller,{type:dexLang.t("text_trades"),container:this.containerBody}),this.render=function(){if(this.data.length>0){let e=new DexTradesTableHeaderRenderer({tokenName:this.controller.selectedMarket.baseCurrency.symbol},this.controller);e.render(),this.data=this.data.reverse(),this.data.forEach(function(e){e.tokenPrice=web3.toBigNumber(e.price).dividedBy(web3.toBigNumber(e.amount)).toFixed()});for(let e=0;e<this.data.length;++e){let t=this.data[e];if(t.is_removed)this.containerBody.find('[data-signature="'+t.signature+'"]').remove();else{let e={price:Formatter.haxRound(Formatter.price(t.tokenPrice),r.controller.tokens[t.base_address].symbol),amount:Formatter.volume(t.amount),baseAmount:Formatter.volume(t.base_amount),date:Formatter.date(t.created),time:new Date(t.created).getTime(),type:t.type,txHash:t.eth_hash,signature:t.signature};this.template.replace(e),this.containerBody.prepend(this.template.content)}this.template.reset()}e.tableSorter.sort()}r.controller.switchController.isOnExchangePage()?r.controller.priceChartRenderer.render(e):r.controller.eventDispatcher.listen("pageStateChangedChart",function(){r.controller.priceChartRenderer.render(e)}),this.emptyTable.render(),r.controller.eventDispatcher.trigger("moduleRendered",{container:r.container})}},DexMarketSelectorRenderer=function(e,t){let r=this,n=jQuery("body");if(this.container=null,this.controller=e,this.containerId=t.containerId,this.containerSelector="#"+this.containerId,this.marketId=this.controller.selectedMarket.id,void 0!==this.controller.marketsRenderer.filter.value&&"ALL"!==this.controller.marketsRenderer.filter.value)for(let e in this.controller.markets){let t=this.controller.markets[e];if((t.baseCurrency.symbol===this.controller.marketsRenderer.filter.value||t.quoteCurrency.symbol===this.controller.marketsRenderer.filter.value)&&t.isEnabled){this.marketId=e;break}}this.templateBase=new DexTemplate("market-selector-base"),this.template=new DexTemplate("market-dropdown"),this.templateItem=new DexTemplate("market-selector-item"),this.templateSearchForm=new DexTemplate("market-dropdown-search-from"),this.render=function(){let e=dexLang.t("text_choose_market"),t="";this.templateBase.reset(),this.template.reset(),this.templateItem.reset(),this.templateSearchForm.reset();let r="";for(let n in this.controller.markets){if(!this.controller.markets[n].isEnabled||!this.controller.markets[n].isVisible)continue;let o={marketId:this.controller.markets[n].id,marketName:this.controller.markets[n].name,marketNameLower:this.controller.markets[n].name.toLowerCase()};this.templateItem.replace(o),n===this.marketId?(e=this.marketId,t=this.controller.markets[n].name):r+=this.templateItem.content,this.templateItem.reset()}let n={searchForm:this.templateSearchForm.content,items:r,selectedMarketName:t};this.template.replace(n),this.templateBase.replace("{marketSelect}",this.template.content),this.container=jQuery(this.containerSelector),this.container.html(this.templateBase.content),this.bindEvents()},n.off("click.market"+this.containerId),n.on("click.market"+this.containerId,this.containerSelector+" .market-select-container .change-market-selector",function(){let e=jQuery(this);r.marketId=e.data("market-id"),r.render()}),this.bindEvents=function(){this.container.on("submit.marketSearchMarket",".market-select-container .marketSearchText",function(){return!1}),this.container.off("keyup.marketSearchMarket"),this.container.on("keyup.marketSearchMarket",".market-select-container .marketSearchText",function(){let e=jQuery.trim(jQuery(this).val().toLowerCase());if(r.container.find(".search-result-not-found").hide(),""!==e){r.container.find("[data-market-name]").hide();let t=r.container.find('[data-market-name*="'+e+'"]');t.length>0?t.show():r.container.find(".search-result-not-found").show()}else r.container.find("[data-market-name]").show()})}},DexNewOrderChooseMarketPopupRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.template=new DexTemplate("new-order-choose-market-popup"),this.marketSelector=new DexMarketSelectorRenderer(this.controller,{containerId:"newOrderMarketChoose"}),this.render=function(){this.template.replace("{containerId}","newOrderMarketChoose"),new Modal({title:dexLang.t("text_choose_market"),content:this.template.content}),this.marketSelector.render()},r.off("click.chooseMarket"),r.on("click.chooseMarket","[data-choose-market]",function(){let e=t.controller.getMarket(t.marketSelector.marketId);e.isEnabled&&e.isVisible?(t.controller.changeLocationHash("#"+t.marketSelector.marketId),new DexNewOrderPopupRenderer(t.controller,e).render()):swal({title:dexLang.t("title_error"),text:dexLang.t("errmsg_disabled_market"),icon:"error"})})},DexNewOrderAlertPopupRenderer=function(e,t,r){let n=this,o=jQuery("body");this.controller=r,this.orderType="buy"===e?"sell":"buy",this.template=new DexTemplate("new-order-alert"),this.market=t,this.render=function(){let e=dexLang.t("text_go_to_"+this.orderType);return this.template.replace("{btnTitle}",e),this.template.content},o.off("click.go-to-list"),o.on("click.go-to-list","#modal .modal-body [data-go-to-list]",function(){n.controller.helper.closeModal(),jQuery('#orderbookTab a[href="#'+n.orderType+'List"]').trigger("click")}),o.off("click.place-order"),o.on("click.place-order","#modal .modal-body [data-place-order]",function(){new DexNewOrderPopupRenderer(n.controller,n.market,e).render(!0)})},DexNewOrderPopupRenderer=function(e,t,r){let n=this;this.controller=e,this.market=t,this.orderType=r||"buy",this.template=new DexTemplate("new-order-popup"),this.render=function(e){let t=this.market.id+"-"+("buy"===this.orderType?"sell":"buy");void 0===this.controller.marketsRenderer.data[t]||e?(new Modal({title:dexLang.t("title_new_order"),content:this.template.content,noModalBodyPadding:!0}),new DexBuyFormRenderer(n.controller,n.market).render(),new DexSellFormRenderer(n.controller,n.market).render(),jQuery('#modal [data-order-type-form="'+n.orderType+'"] a').trigger("click")):new Modal({title:dexLang.t("title_new_order_alert"),content:new DexNewOrderAlertPopupRenderer(this.orderType,this.market,this.controller).render()})}},DexSellFormRenderer=function(e,t){let r=this;this.controller=e,this.template=new DexTemplate("sell-form"),this.container=jQuery("#sellForm"),this.market=t||this.controller.selectedMarket,this.form=null,this.strictRate=null,this.formDifficulty="basic",this.orderEventNames=[],this.orderEventResults={},this.isFormDifficultyBasic=function(){return"basic"===r.formDifficulty},this.validateCryptoPriceBelow=function(e,t){"hard"===t?r.market.lowerHardPriceMarginRate:r.market.lowerPriceMarginRate;return!!r.checkCryptoPriceMargin(e,"below",t)||(r.container.find(".estimatedRate").addClass("error-text"),!1)},this.validateCryptoPriceAbove=function(e,t){"hard"===t?r.market.upperHardPriceMarginRate:r.market.upperPriceMarginRate;return!!r.checkCryptoPriceMargin(e,"above",t)||(r.container.find(".estimatedRate").addClass("error-text"),!1)},this.checkCryptoPriceMargin=function(e,t,n){let o="hard"===n?r.market.upperHardPriceMarginRate:r.market.upperPriceMarginRate,a="hard"===n?r.market.lowerHardPriceMarginRate:r.market.lowerPriceMarginRate,i="below"===t?a:o;if(i){let n=r.controller.cryptoPrices.getCurrentPrice(r.market.baseCurrency)/r.controller.cryptoPrices.getCurrentPrice(r.market.quoteCurrency);if("below"===t){if(i&&e<n-n*i)return!1}else if(i&&e>n+n*i)return!1}return!0},this.validateOrderCnt=function(){return r.controller.orderPlacedCounter<100},this.render=function(){if(this.controller.user.hasAccount()){let e=r.controller.tokenPrices.getETHPriceByAddress(this.market.baseCurrencyAddress,!1),t=r.controller.tokenPrices.getETHPriceByAddress(this.market.quoteCurrencyAddress,!1),n=t>0?e/t:0,o={baseTokenName:this.market.baseCurrency.symbol,baseTokenAddress:this.market.baseCurrencyAddress,quoteTokenName:this.market.quoteCurrency.symbol,quoteTokenAddress:this.market.quoteCurrencyAddress,fiatSymbol:this.controller.currencySelector.currentCurrency.toUpperCase(),estimatedRateNumber:0,currentRateNumber:Formatter.price(n),marketName:this.market.name};this.template.replace(o),this.container.html(this.template.content),this.controller.massOrderEnabled||this.container.find(".mass-order").remove(),this.market.isSellEnabled?(this.container.find(".form-enabled-container").show(),this.container.find(".form-disabled-container").remove()):(this.container.find(".form-enabled-container").remove(),this.container.find(".form-disabled-container").show()),this.calculateExpires(),this.form=new DexForm("#sell-form",this.rules)}else this.container.html(new DexTemplate("empty-balance-form").content)},this.container.on("click",".form-difficulty-select-container button",function(){let e=jQuery(this);r.container.find(".form-difficulty-select-container button.btn-primary").removeClass("btn-primary").addClass("btn-secondary"),e.removeClass("btn-secondary").addClass("btn-primary"),r.container.find(".form-container .sell-form").hide(0,function(){let t=e.data("target");r.container.find(".sell-form-"+t).show(0),r.formDifficulty=t})}),this.container.off("change.useWorldMarketPrice"),this.container.on("change.useWorldMarketPrice",".useWorldMarketPrice",function(e){if(jQuery(this).prop("checked")){let e=r.container.find(".sell-form-basic .quoteTokenAmount");e.attr("disabled","disabled");let t=r.container.find(".orderPrice"),n=r.controller.tokenPrices.getETHPriceByAddress(r.market.baseCurrencyAddress,!1),o=r.controller.tokenPrices.getETHPriceByAddress(r.market.quoteCurrencyAddress,!1),a=n>0?n/o:0;t.val(Formatter.price(a)),r.container.find(".currentRateNumber, .estimatedRateNumber").text(Formatter.price(a)),r.calculateFormValues(e[0],t[0])}else r.container.find(".sell-form-basic .quoteTokenAmount").removeAttr("disabled")}),this.container.off("change.amountcopy"),this.container.on("change.amountcopy",".baseTokenAmount, .quoteTokenAmount",function(){let e=jQuery(this),t=e.val();e.hasClass("baseTokenAmount")?r.container.find(".baseTokenAmount").val(t):r.container.find(".quoteTokenAmount").val(t)}),this.calculateFormValues=function(e,t){if(""===(t=jQuery(t)).val())return;let n,o,a=r.container.find(".baseTokenAmount"),i=r.container.find(".useWorldMarketPrice"),l=r.container.find(".orderPrice"),s=r.container.find(".estimatedRateNumber"),c=r.container.find(".quoteTokenAmount"),d=r.container.find(".orderFiatPrice"),u=r.container.find(".usdAmount"),h=r.controller.tokenPrices.getUSDPriceByAddress(r.market.quoteCurrencyAddress)*r.controller.fiatPrices.getUsdPriceBySymbol(r.controller.currencySelector.currentCurrency),m=1/h,p=0;a.val()&&a.val(Formatter.haxRound(parseFloat(Formatter.sanitizeInputNumber(a.val())),r.market.baseCurrency.symbol)),jQuery(e).hasClass("orderPrice")?d.val(Formatter.round(parseFloat(Formatter.sanitizeInputNumber(l.val()))*h,2)):jQuery(e).hasClass("orderFiatPrice")&&(l.val(Formatter.price(parseFloat(Formatter.sanitizeInputNumber(d.val()))*m)),s.text(parseFloat(Formatter.sanitizeInputNumber(d.val()))*m)),jQuery(e).hasClass("quoteTokenAmount")?u.val(Formatter.round(parseFloat(Formatter.sanitizeInputNumber(c.val()))*h,2)):jQuery(e).hasClass("usdAmount")&&c.val(Formatter.price(parseFloat(Formatter.sanitizeInputNumber(u.val()))*m,r.market.quoteCurrency.symbol)),o=web3.toBigNumber(Formatter.sanitizeInputNumber(a.val()));let f=[],y=[];!1===i.prop("checked")&&r.isFormDifficultyBasic()?(f=[l[0],d[0]],y=[a[0],a[1],c[0],c[1],u[0]]):(f=[a[1],a[0],l[0],d[0]],y=[c[0],c[1],u[0]]),jQuery.inArray(t[0],f)>-1&&(n=web3.toBigNumber(Formatter.sanitizeInputNumber(l.val())),p=o.mul(n),c.val(Formatter.price(p.toNumber(),r.market.quoteCurrency.symbol)),h=web3.toBigNumber(h.toString()),u.val(Formatter.round(p.mul(h).toNumber(),2))),jQuery.inArray(t[0],y)>-1&&(n=(p=web3.toBigNumber(Formatter.sanitizeInputNumber(c.val()))).dividedBy(o),l.val(Formatter.price(n.toNumber())),s.text(Formatter.price(n.toNumber())),h=web3.toBigNumber(h.toString()),d.val(Formatter.round(n.mul(h),2))),r.form.validate()&&(r.container.find(".estimatedRate").removeClass("error-text"),r.container.find(".priceErrorNotification .error-text").text(""))},this.container.on("change",".baseTokenAmount, .quoteTokenAmount, .orderPrice, .orderFiatPrice, .usdAmount",function(e){r.calculateFormValues(this,e.target)}),this.calculateExpires=function(){let e,t,n,o=r.container.find(".expire-hours"),a=r.container.find(".expire-minutes"),i=r.container.find(".expire-seconds"),l=r.container.find(".expire-timestamp");e=parseInt(o.val()),t=parseInt(a.val()),n=parseInt(i.val()),n+=3600*e+60*t,l.val(n)},this.container.on("change",".expire-hours, .expire-minutes, .expire-seconds",function(){r.calculateExpires()}),this.rules=[[["baseTokenAmount","orderPrice","expire"],"required",dexLang.t("errmgs_field_required")],["baseTokenAmount","number",dexLang.t("errmsg_amount_to_sell_number")],["baseTokenAmount",{validatorName:"greaterEqual",params:{value:r.controller.minAmount}},dexLang.t("errmsg_too_low")],["orderPrice","number",dexLang.t("errmsg_price_number")],["orderPrice",function(e){return r.validateCryptoPriceBelow(e,"hard")},function(){return setTimeout(function(){swal({title:dexLang.t("text_lower_hard_price_margin_warning_title"),text:dexLang.t("text_lower_hard_price_margin_warning"),type:"error",html:!0,confirmButtonColor:"#66004a"})},1e3),""}],["orderPrice",function(e){return r.validateCryptoPriceAbove(e,"hard")},function(){return setTimeout(function(){swal({title:dexLang.t("text_upper_hard_price_margin_warning_title"),text:dexLang.t("text_upper_hard_price_margin_warning"),type:"error",html:!0,confirmButtonColor:"#66004a"})},1e3),""}],["orderPrice","notNull",dexLang.t("errmsg_not_null")],["expire","integer",dexLang.t("errmsg_expires_number")],["expire",{validatorName:"greaterEqual",params:{value:3600}},dexLang.t("errmsg_expire_too_low")],["expire",{validatorName:"lowerEqual",params:{value:259200}},dexLang.t("errmsg_expire_too_high")],["kyc",{validatorName:"checkUserKyc",params:{user:r.controller.user}},{"not-approved":dexLang.t("text_complete_kyc"),pending:dexLang.t("text_review_kyc")}]],r.controller.user.hasAccount()&&this.rules.push(["baseTokenAmount",{validatorName:"lowerEqual",params:{value:r.controller.user.selectedAccount.balances[r.market.baseCurrencyAddress].dex.toString()}},dexLang.t("errmsg_insufficient_funds")]),r.controller.massOrderEnabled&&(this.rules.push(["orderAmount","required",dexLang.t("errmgs_field_required")]),this.rules.push(["orderAmount","integer","Order Amount must be an integer and greater than 0!"]),this.rules.push(["orderAmount",{validatorName:"greater",params:{value:0}},"Order Amount must be an integer and greater than 0!"])),this.container.off("submit.sellformsubmit"),this.container.on("submit.sellformsubmit","#sell-form",function(){let e=this;if(!r.market.isSellEnabled)return swal({title:dexLang.t("title_order_info"),text:dexLang.t("text_order_information_disabled_sell",{marketName:r.market.name}),icon:"info"}),!1;let t=r.form.serializeForm();return t.baseTokenAmount=parseFloat(Formatter.sanitizeInputNumber(t.baseTokenAmount)),t.orderPrice=parseFloat(Formatter.sanitizeInputNumber(t.orderPrice)),t.quoteTokenAmount=parseFloat(Formatter.sanitizeInputNumber(t.quoteTokenAmount)),r.form.validate(!0)&&r.priceMarginPopup(t.orderPrice,function(){authenticateUser2fa("place_order_in_exchange",function(){function n(e){r.controller.api.order(r.market.baseCurrencyAddress,r.market.quoteCurrencyAddress,t.baseTokenAmount.toString(),r.market.baseCurrency.decimals,t.quoteTokenAmount.toString(),r.market.quoteCurrency.decimals,"sell",t.expire,function(t,n){r.handleOnOrder(t,n,e)})}r.container.find(".estimatedRate").removeClass("error-text"),r.container.find(".priceErrorNotification .error-text").text("");let o=(r.controller.massOrderEnabled?Math.ceil(t.orderAmount):1)-1;r.controller.helper.closeModal(),r.controller.helper.showFullPageLoader(),r.orderEventNames=[],r.orderEventResults={};for(let e=o,t=0;e>=0;e--,t++){let o="onSellOrder"+e;r.orderEventNames.push(o),setTimeout(function(){n(o)},10*t)}r.controller.eventDispatcher.waitForAllEvents(r.orderEventNames,function(){r.controller.helper.hideFullPageLoader(),r.controller.eventDispatcher.trigger("onSellOrder")}),r.controller.tracking.log(5,51,"Sell order placed: "+r.controller.selectedMarket.name),e.reset()})}),!1}),this.priceMarginPopup=function(e,t){r.checkCryptoPriceMargin(e,"below")?r.checkCryptoPriceMargin(e,"above")?"function"==typeof t&&t():setTimeout(function(){swal({title:dexLang.t("text_upper_price_margin_warning_title"),text:dexLang.t("text_upper_price_margin_warning"),type:"warning",showCancelButton:!0,confirmButtonColor:"#66004a",confirmButtonText:dexLang.t("text_yes"),cancelButtonText:dexLang.t("text_no")},function(e){e&&"function"==typeof t&&t()})},1e3):setTimeout(function(){swal({title:dexLang.t("text_lower_price_margin_warning_title"),text:dexLang.t("text_lower_price_margin_warning"),type:"warning",showCancelButton:!0,confirmButtonColor:"#66004a",confirmButtonText:dexLang.t("text_yes"),cancelButtonText:dexLang.t("text_no")},function(e){e&&"function"==typeof t&&t()})},1e3)},this.generateOrders=function(e){e=e||100;let t=r.controller.tokenPrices.getETHPriceByAddress(this.market.baseCurrencyAddress,!1),n=r.controller.tokenPrices.getETHPriceByAddress(this.market.quoteCurrencyAddress,!1),o=n>0&&t>0?t/n:.2,a=Formatter.price(o),i=r.market.upperPriceMarginRate-r.market.lowerPriceMarginRate+r.market.lowerPriceMarginRate;function l(e,t,n){let o=[r.market.baseCurrencyAddress,r.market.quoteCurrencyAddress,e.toString(),r.market.baseCurrency.decimals,t.toString(),r.market.quoteCurrency.decimals,"sell","86400",function(e,t){r.handleOnOrder(e,t,n)}];r.controller.api.order(...o)}i=i||1,r.orderEventNames=[],r.orderEventResults={};for(let t=0,n=0;t<e;t++,n++){let e=Math.random()*i,o=parseFloat(a)*e,s=10*Math.random()*Math.random(),c="onSellOrder"+t;r.orderEventNames.push(c),setTimeout(function(){l(o,s,c)},10*n)}r.controller.eventDispatcher.waitForAllEvents(r.orderEventNames,function(){r.controller.helper.hideFullPageLoader(),r.controller.eventDispatcher.trigger("onSellOrder")})},this.handleOnOrder=function(e,t,n){let o={success:!0,message:""};e?(o.success=!1,o.message=e.message):"OK"!==t[1]&&(o.success=!1,o.message=t,r.controller.helper.closeModal(),void 0!==t[2]&&(o.message=t[2].text,swal({title:t[2].title,text:t[2].text,icon:"error"}))),r.orderEventResults[n]=o,r.controller.eventDispatcher.trigger(n)},this.controller.eventDispatcher.ignore("onSellOrder"),this.controller.eventDispatcher.listen("onSellOrder",function(){if(1===r.orderEventNames.length)r.orderEventResults[r.orderEventNames[0]]&&r.orderEventResults[r.orderEventNames[0]].success?swal({title:dexLang.t("title_order_placed"),text:dexLang.t("text_order_placed"),icon:"success"}):swal({title:dexLang.t("title_error"),text:r.orderEventResults[r.orderEventNames[0]].message,icon:"error"});else{let e=0,t=0;for(let n in r.orderEventResults)e+=r.orderEventResults[n].success?0:1,t+=r.orderEventResults[n].success?1:0;let n=e>0?dexLang.t("text_order_information_error",{errorCnt:e,successCnt:t}):dexLang.t("text_order_information_success",{successCnt:t});swal({title:dexLang.t("title_order_info"),text:n,icon:"info"})}jQuery('#orderbookTab a[href="#sellList"]').trigger("click")})},DexBuyFormRenderer=function(e,t){let r=this;this.controller=e,this.template=new DexTemplate("buy-form"),this.container=jQuery("#buyForm"),this.market=t||this.controller.selectedMarket,this.form=null,this.strictRate=null,this.formDifficulty="basic",this.orderEventNames=[],this.orderEventResults={},this.isFormDifficultyBasic=function(){return"basic"===r.formDifficulty},this.validateCryptoPriceBelow=function(e,t){"hard"===t?r.market.lowerHardPriceMarginRate:r.market.lowerPriceMarginRate;return!!r.checkCryptoPriceMargin(e,"below",t)||(r.container.find(".estimatedRate").addClass("error-text"),!1)},this.validateCryptoPriceAbove=function(e,t){"hard"===t?r.market.upperHardPriceMarginRate:r.market.upperPriceMarginRate;return!!r.checkCryptoPriceMargin(e,"above",t)||(r.container.find(".estimatedRate").addClass("error-text"),!1)},this.checkCryptoPriceMargin=function(e,t,n){e=parseFloat(e);let o="hard"===n?r.market.upperHardPriceMarginRate:r.market.upperPriceMarginRate,a="hard"===n?r.market.lowerHardPriceMarginRate:r.market.lowerPriceMarginRate,i="below"===t?a:o;if(i){let n=r.controller.cryptoPrices.getCurrentPrice(r.market.baseCurrency)/r.controller.cryptoPrices.getCurrentPrice(r.market.quoteCurrency);if("below"===t){if(i&&e<n-n*i)return!1}else if(i&&e>n+n*i)return!1}return!0},this.validateOrderCnt=function(){return r.controller.orderPlacedCounter<100},this.render=function(){if(this.controller.user.hasAccount()){let e=r.controller.tokenPrices.getETHPriceByAddress(this.market.baseCurrencyAddress,!1),t=r.controller.tokenPrices.getETHPriceByAddress(this.market.quoteCurrencyAddress,!1),n=t>0?e/t:0,o={baseTokenName:this.market.baseCurrency.symbol,baseTokenAddress:this.market.baseCurrencyAddress,quoteTokenName:this.market.quoteCurrency.symbol,quoteTokenAddress:this.market.quoteCurrencyAddress,fiatSymbol:this.controller.currencySelector.currentCurrency.toUpperCase(),estimatedRateNumber:0,currentRateNumber:Formatter.price(n),marketName:this.market.name};this.template.replace(o),this.container.html(this.template.content),this.controller.massOrderEnabled||this.container.find(".mass-order").remove(),this.market.isBuyEnabled?(this.container.find(".form-enabled-container").show(),this.container.find(".form-disabled-container").remove()):(this.container.find(".form-enabled-container").remove(),this.container.find(".form-disabled-container").show()),this.calculateExpires(),this.form=new DexForm("#buy-form",this.rules)}else this.container.html(new DexTemplate("empty-balance-form").content)},this.container.on("click",".form-difficulty-select-container button",function(){let e=jQuery(this);r.container.find(".form-difficulty-select-container button.btn-primary").removeClass("btn-primary").addClass("btn-secondary"),e.removeClass("btn-secondary").addClass("btn-primary"),r.container.find(".form-container .buy-form").hide(0,function(){let t=e.data("target");r.container.find(".buy-form-"+t).show(0),r.formDifficulty=t})}),this.container.off("change.useWorldMarketPrice"),this.container.on("change.useWorldMarketPrice",".useWorldMarketPrice",function(e){if(jQuery(this).prop("checked")){let e=r.container.find(".buy-form-basic .quoteTokenAmount");e.attr("disabled","disabled");let t=r.container.find(".orderPrice"),n=r.controller.tokenPrices.getETHPriceByAddress(r.market.baseCurrencyAddress,!1),o=r.controller.tokenPrices.getETHPriceByAddress(r.market.quoteCurrencyAddress,!1),a=n>0?n/o:0;t.val(Formatter.price(a)),r.container.find(".currentRateNumber, .estimatedRateNumber").text(Formatter.price(a)),r.calculateFormValues(e[0],t[0])}else r.container.find(".buy-form-basic .quoteTokenAmount").removeAttr("disabled")}),this.container.off("change.amountcopy"),this.container.on("change.amountcopy",".baseTokenAmount, .quoteTokenAmount",function(){let e=jQuery(this),t=e.val();e.hasClass("baseTokenAmount")?r.container.find(".baseTokenAmount").val(t):r.container.find(".quoteTokenAmount").val(t)}),this.calculateFormValues=function(e,t){if(""===(t=jQuery(t)).val())return;let n,o,a=r.container.find(".baseTokenAmount"),i=r.container.find(".useWorldMarketPrice"),l=r.container.find(".orderPrice"),s=r.container.find(".estimatedRateNumber"),c=r.container.find(".quoteTokenAmount"),d=r.container.find(".orderFiatPrice"),u=r.container.find(".usdAmount"),h=r.controller.tokenPrices.getUSDPriceByAddress(r.market.quoteCurrencyAddress)*r.controller.fiatPrices.getUsdPriceBySymbol(r.controller.currencySelector.currentCurrency),m=1/h,p=0;a.val()&&a.val(Formatter.haxRound(parseFloat(Formatter.sanitizeInputNumber(a.val())),r.market.baseCurrency.symbol)),jQuery(e).hasClass("orderPrice")?d.val(Formatter.round(parseFloat(Formatter.sanitizeInputNumber(l.val()))*h,2)):jQuery(e).hasClass("orderFiatPrice")&&(l.val(Formatter.price(parseFloat(Formatter.sanitizeInputNumber(d.val()))*m)),s.text(parseFloat(Formatter.sanitizeInputNumber(d.val()))*m)),jQuery(e).hasClass("quoteTokenAmount")?u.val(Formatter.round(parseFloat(Formatter.sanitizeInputNumber(c.val()))*h,2)):jQuery(e).hasClass("usdAmount")&&c.val(Formatter.price(parseFloat(Formatter.sanitizeInputNumber(u.val()))*m)),o=web3.toBigNumber(Formatter.sanitizeInputNumber(a.val()));let f=[],y=[];!1===i.prop("checked")&&r.isFormDifficultyBasic()?(f=[l[0],d[0]],y=[a[0],a[1],c[0],c[1],u[0]]):(f=[a[1],a[0],l[0],d[0]],y=[c[0],c[1],u[0]]),jQuery.inArray(t[0],f)>-1&&(n=web3.toBigNumber(Formatter.sanitizeInputNumber(l.val())),p=o.mul(n),c.val(Formatter.price(p.toNumber())),h=web3.toBigNumber(h.toString()),u.val(Formatter.round(p.mul(h).toNumber(),2))),jQuery.inArray(t[0],y)>-1&&(n=(p=web3.toBigNumber(Formatter.sanitizeInputNumber(c.val()))).dividedBy(o),l.val(Formatter.price(n.toNumber())),s.text(Formatter.price(n.toNumber())),h=web3.toBigNumber(h.toString()),d.val(Formatter.round(n.mul(h),2))),r.form.validate()&&(r.container.find(".estimatedRate").removeClass("error-text"),r.container.find(".priceErrorNotification .error-text").text(""))},this.container.on("change",".baseTokenAmount, .quoteTokenAmount, .orderPrice, .orderFiatPrice, .usdAmount",function(e){r.calculateFormValues(this,e.target)}),this.calculateExpires=function(){let e,t,n,o=r.container.find(".expire-hours"),a=r.container.find(".expire-minutes"),i=r.container.find(".expire-seconds"),l=r.container.find(".expire-timestamp");e=parseInt(o.val()),t=parseInt(a.val()),n=parseInt(i.val()),n+=3600*e+60*t,l.val(n)},this.container.on("change",".expire-hours, .expire-minutes, .expire-seconds",function(){r.calculateExpires()}),this.rules=[[["baseTokenAmount","orderPrice","expire"],"required",dexLang.t("errmgs_field_required")],["baseTokenAmount","number",dexLang.t("errmsg_amount_to_buy_number")],["baseTokenAmount",{validatorName:"greaterEqual",params:{value:r.controller.minAmount}},dexLang.t("errmsg_too_low")],["orderPrice","number",dexLang.t("errmsg_price_number")],["orderPrice",function(e){return r.validateCryptoPriceBelow(e,"hard")},function(){return swal({title:dexLang.t("text_lower_hard_price_margin_warning_title"),text:dexLang.t("text_lower_hard_price_margin_warning"),type:"error",html:!0,confirmButtonColor:"#66004a"}),""}],["orderPrice",function(e){return r.validateCryptoPriceAbove(e,"hard")},function(){return swal({title:dexLang.t("text_upper_hard_price_margin_warning_title"),text:dexLang.t("text_upper_hard_price_margin_warning"),type:"error",html:!0,confirmButtonColor:"#66004a"}),""}],["orderPrice","notNull",dexLang.t("errmsg_not_null")],["expire","integer",dexLang.t("errmsg_expires_number")],["expire",{validatorName:"greaterEqual",params:{value:20}},dexLang.t("errmsg_expire_too_low")],["expire",{validatorName:"lowerEqual",params:{value:259200}},dexLang.t("errmsg_expire_too_high")],["kyc",{validatorName:"checkUserKyc",params:{user:r.controller.user}},{"not-approved":dexLang.t("text_complete_kyc"),pending:dexLang.t("text_review_kyc")}]],r.controller.user.hasAccount()&&this.rules.push(["quoteTokenAmount",{validatorName:"lowerEqual",params:{value:r.controller.user.selectedAccount.balances[r.market.quoteCurrencyAddress].dex.toString()}},dexLang.t("errmsg_insufficient_funds")]),r.controller.massOrderEnabled&&(this.rules.push(["orderAmount","required",dexLang.t("errmgs_field_required")]),this.rules.push(["orderAmount","integer","Order Amount must be an integer and greater than 0!"]),this.rules.push(["orderAmount",{validatorName:"greater",params:{value:0}},"Order Amount must be an integer and greater than 0!"])),this.container.off("submit.buyformsubmit"),this.container.on("submit.buyformsubmit","#buy-form",function(){let e=this;if(!r.market.isBuyEnabled)return swal({title:dexLang.t("title_order_info"),text:dexLang.t("text_order_information_disabled_buy",{marketName:r.market.name}),icon:"info"}),!1;let t=r.form.serializeForm();return t.baseTokenAmount=parseFloat(Formatter.sanitizeInputNumber(t.baseTokenAmount)),t.orderPrice=parseFloat(Formatter.sanitizeInputNumber(t.orderPrice)),t.quoteTokenAmount=parseFloat(Formatter.sanitizeInputNumber(t.quoteTokenAmount)),r.form.validate(!0)&&r.priceMarginPopup(t.orderPrice,function(){authenticateUser2fa("place_order_in_exchange",function(){function n(e){let n=[r.market.baseCurrencyAddress,r.market.quoteCurrencyAddress,t.baseTokenAmount.toString(),r.market.baseCurrency.decimals,t.quoteTokenAmount.toString(),r.market.quoteCurrency.decimals,"buy",t.expire,function(t,n){r.handleOnOrder(t,n,e)}];r.controller.api.order(...n)}r.container.find(".estimatedRate").removeClass("error-text"),r.container.find(".priceErrorNotification .error-text").text("");let o=(r.controller.massOrderEnabled?Math.ceil(t.orderAmount):1)-1;r.controller.helper.closeModal(),r.controller.helper.showFullPageLoader();let a=[];for(let e=o,t=0;e>=0;e--,t++){let r="onBuyOrder"+e;a.push(r),setTimeout(function(){n(r)},10*t)}r.controller.eventDispatcher.waitForAllEvents(a,function(){r.controller.helper.hideFullPageLoader(),r.controller.eventDispatcher.trigger("onBuyOrder")}),r.controller.tracking.log(5,51,"Buy order placed: "+r.controller.selectedMarket.name),e.reset()})}),!1}),this.priceMarginPopup=function(e,t){r.checkCryptoPriceMargin(e,"below")?r.checkCryptoPriceMargin(e,"above")?"function"==typeof t&&t():setTimeout(function(){swal({title:dexLang.t("text_upper_price_margin_warning_title"),text:dexLang.t("text_upper_price_margin_warning"),type:"warning",showCancelButton:!0,confirmButtonColor:"#66004a",confirmButtonText:dexLang.t("text_yes"),cancelButtonText:dexLang.t("text_no")},function(e){e&&"function"==typeof t&&t()})},1e3):setTimeout(function(){swal({title:dexLang.t("text_lower_price_margin_warning_title"),text:dexLang.t("text_lower_price_margin_warning"),type:"warning",showCancelButton:!0,confirmButtonColor:"#66004a",confirmButtonText:dexLang.t("text_yes"),cancelButtonText:dexLang.t("text_no")},function(e){e&&"function"==typeof t&&t()})},1e3)},this.generateOrders=function(e){e=e||100;let t=r.controller.tokenPrices.getETHPriceByAddress(this.market.baseCurrencyAddress,!1),n=r.controller.tokenPrices.getETHPriceByAddress(this.market.quoteCurrencyAddress,!1),o=n>0&&t>0?t/n:.2,a=Formatter.price(o),i=r.market.upperPriceMarginRate-r.market.lowerPriceMarginRate+r.market.lowerPriceMarginRate;function l(e,t,n){let o=[r.market.baseCurrencyAddress,r.market.quoteCurrencyAddress,e.toString(),r.market.baseCurrency.decimals,t.toString(),r.market.quoteCurrency.decimals,"buy","86400",function(e,t){r.handleOnOrder(e,t,n)}];r.controller.api.order(...o)}i=i||1,r.orderEventNames=[],r.orderEventResults={};for(let t=0,n=0;t<e;t++,n++){let e=Math.random()*i,o=parseFloat(a)*e,s=10*Math.random()*Math.random(),c="onBuyOrder"+t;r.orderEventNames.push(c),setTimeout(function(){l(o,s,c)},10*n)}r.controller.eventDispatcher.waitForAllEvents(r.orderEventNames,function(){r.controller.helper.hideFullPageLoader(),r.controller.eventDispatcher.trigger("onBuyOrder")})},this.handleOnOrder=function(e,t,n){let o={success:!0,message:""};e?(o.success=!1,o.message=t):"OK"!==t[1]&&(o.success=!1,o.message=t,r.controller.helper.closeModal(),void 0!==t[2]&&(o.message=t[2].text,swal({title:dexLang.t("title_error"),text:t[2].text,icon:"error"}))),r.orderEventResults[n]=o,r.controller.eventDispatcher.trigger(n)},this.controller.eventDispatcher.ignore("onBuyOrder"),this.controller.eventDispatcher.listen("onBuyOrder",function(){if(1===r.orderEventNames.length)r.orderEventResults[r.orderEventNames[0]]&&r.orderEventResults[r.orderEventNames[0]].success?swal({title:dexLang.t("title_order_placed"),text:dexLang.t("text_order_placed"),icon:"success"}):swal({title:dexLang.t("title_error"),text:r.orderEventResults[r.orderEventNames[0]].message,icon:"error"});else{let e=0,t=0;for(let n in r.orderEventResults)e+=r.orderEventResults[n].success?0:1,t+=r.orderEventResults[n].success?1:0;let n=e>0?dexLang.t("text_order_information_error",{errorCnt:e,successCnt:t}):dexLang.t("text_order_information_success",{successCnt:t});swal({title:dexLang.t("title_order_info"),text:n,icon:"info"})}jQuery('#orderbookTab a[href="#buyList"]').trigger("click")})},DexDepositFormRenderer=function(e,t){let r=this,n=jQuery("body");this.controller=t,this.tokenAddress=e,this.token=this.controller.tokens[this.tokenAddress],this.template=new DexTemplate("deposit-form"),this.render=function(){let e=r.controller.user.selectedAccount.balances[r.tokenAddress].wallet.toString();this.token.address===ETH_ADDRESS&&(e=0);let t={tokenSymbol:r.token.symbol,tokenAddress:r.token.address,value:e};return this.template.replace(t),this.template.content},this.rulesEth=[["amount",{validatorName:"lowerEqual",params:{value:r.controller.user.selectedAccount.balances[ETH_ADDRESS].wallet.toString()}},dexLang.t("errmsg_insufficient_funds")],["amount",{validatorName:"greaterEqual",params:{value:r.controller.minAmount}},dexLang.t("errmsg_too_low")],["amount","required",dexLang.t("errmgs_field_required")],["amount","number",dexLang.t("errmsg_amount_number")],["kyc",{validatorName:"checkUserKyc",params:{user:r.controller.user}},{"not-approved":dexLang.t("text_complete_kyc"),pending:dexLang.t("text_review_kyc")}]],this.rulesToken=[["amount",{validatorName:"lowerEqual",params:{value:r.controller.user.selectedAccount.balances[r.tokenAddress].wallet.toString()}},dexLang.t("errmsg_insufficient_funds")],["amount",{validatorName:"greaterEqual",params:{value:r.controller.minAmount}},dexLang.t("errmsg_too_low")],["amount","required",dexLang.t("errmgs_field_required")],["amount","number",dexLang.t("errmsg_amount_number")],["kyc",{validatorName:"checkUserKyc",params:{user:r.controller.user}},{"not-approved":dexLang.t("text_complete_kyc"),pending:dexLang.t("text_review_kyc")}]],n.off("submit.depositform"),n.on("submit.depositform","#deposit-token-form",function(){return r.tokenAddress===ETH_ADDRESS?r.depositEthereum(this):r.depositToken(this),!1}),this.depositEthereum=function(e){let t=r.controller.helper.serializeForm(e),n=new DexFormValidator(this.rulesEth,t);if(r.controller.helper.clearFormError(e),n.validate()){let e=web3.toBigNumber(Formatter.sanitizeInputNumber(t.amount)).shift(ETH_DECIMALS),n=r.controller.user.selectedAccount.balances[ETH_ADDRESS].wallet.origValue,o=r.controller.helper.createTransactionObj({toAddress:r.controller.dexVault.contract.contractAddress,fromAddress:dexEth.userAddress,contract:r.controller.dexVault.contract.contract,functionName:"deposit",applyFunctionData:[ETH_ADDRESS,e],value:e});dexEth.call("eth_estimateGas",[o],function(t,o){if(t)new DexApiErrorHandler(t,"deposit",r.controller);else{let t=web3.fromWei(r.controller.gasApi.getGasPrice(),"gwei"),a=web3.toBigNumber(web3.toWei(o,"gwei")),i=e.mul(r.controller.tokens[ETH_ADDRESS].depositFeeRate);a=a.mul(t);let l=n.minus(e).minus(a).lt(0),s=e.minus(i);l?(r.controller.helper.closeModal(),swal({title:dexLang.t("title_warning"),text:dexLang.t("text_insufficient_funds_for_gas",{eth:web3.fromWei(a.toFixed(),"ether"),eur:web3.toBigNumber(web3.fromWei(a.toFixed(),"ether")).mul(web3.toBigNumber(r.controller.tokenPrices.getCurrentFiatPriceByAddress(ETH_ADDRESS))).toFixed(2),fiatSymbol:r.controller.currencySelector.currentCurrency.symbol}),icon:"warning"})):new Modal({title:dexLang.t("title_confirm_deposit"),content:new DexDepositConfirmRenderer({estimateGas:a,depositFee:i,amountCredited:s,tokenAddr:ETH_ADDRESS},function(){r.controller.dexVault.deposit(ETH_ADDRESS,e.toFixed(),r.depositCallback),r.controller.user.selectedAccount.balances[r.tokenAddress].refreshable()},r.controller).render(),modalOptions:{backdrop:!1}})}})}else new DexFormErrorRenderer(n.getErrors(),"#deposit-token-form").render();return!1},this.depositCallback=function(e,t){e?new DexApiErrorHandler(e,"deposit",r.controller):(swal({title:dexLang.t("title_deposit_processing"),text:new DexTemplate("deposit-confirm-success").replace({txHash:t}).content,icon:"success",html:!0}),new DexTransactionProcessingPopupRenderer(t,r.controller))},this.depositToken=function(e){let t=r.controller.helper.serializeForm(e),n=new DexFormValidator(r.rulesToken,t);if(r.controller.helper.clearFormError(e),n.validate()){let e=r.controller.tokens[r.tokenAddress],n=Formatter.formatForApi(Formatter.sanitizeInputNumber(t.amount),e.decimals);var o=e.contract();let a=r.controller.user.selectedAccount.balances[ETH_ADDRESS].wallet.origValue,i=function(){let n=web3.toBigNumber(Formatter.sanitizeInputNumber(t.amount)).shift(e.decimals),o=r.controller.helper.createTransactionObj({toAddress:r.controller.dexVault.contract.contractAddress,fromAddress:dexEth.userAddress,contract:r.controller.dexVault.contract.contract,functionName:"deposit",applyFunctionData:[e.address,n]});dexEth.call("eth_estimateGas",[o],function(t,o){if(t)setTimeout(function(){e.getAllowance(s)},1e3);else{let t=web3.fromWei(r.controller.gasApi.getGasPrice(),"gwei"),i=web3.toBigNumber(web3.toWei(o,"gwei")),l=n.mul(r.token.depositFeeRate);i=i.mul(t);let s=n.minus(l);a.lt(i)?(r.controller.helper.closeModal(),swal({title:dexLang.t("title_dear_customer"),text:dexLang.t("text_insufficient_funds_for_gas",{eth:web3.fromWei(i.toFixed(),"ether"),eur:web3.toBigNumber(web3.fromWei(i.toFixed(),"ether")).mul(web3.toBigNumber(r.controller.tokenPrices.getCurrentFiatPriceByAddress(ETH_ADDRESS))).toFixed(2),fiatSymbol:r.controller.currencySelector.currentCurrency.symbol}),icon:"warning"})):new Modal({title:dexLang.t("title_confirm_deposit"),content:new DexDepositConfirmRenderer({estimateGas:i,depositFee:l,amountCredited:s,decimals:r.token.decimals,tokenAddr:e.address},function(){r.controller.dexVault.deposit(e.address,n,r.depositTokenCallback),r.controller.user.selectedAccount.balances[r.tokenAddress].refreshable(),r.controller.tracking.log(2,21)},r.controller).render()})}})},l=!1,s=function(){if(e.allowance.toNumber()>=parseFloat(Formatter.sanitizeInputNumber(t.amount)))i();else if(l)setTimeout(function(){e.getAllowance(s)},1e3);else{r.controller.helper.closeModal();let t=r.controller.helper.createTransactionObj({toAddress:e.address,fromAddress:dexEth.userAddress,contract:o.contract.contract,functionName:"approve",applyFunctionData:[r.controller.dexVault.contract.contractAddress,n]});dexEth.call("eth_estimateGas",[t],function(t,i){if(t)r.controller.helper.closeModal(),new DexApiErrorHandler(t,"approve",r.controller);else{let t=web3.fromWei(r.controller.gasApi.getGasPrice(),"gwei"),c=web3.toBigNumber(web3.toWei(i,"gwei"));c=c.mul(t),a.gt(c)?(l=!0,o.approve(r.controller.dexVault.contract.contractAddress,n,function(t,n){t?new DexApiErrorHandler(t,"approve",r.controller):(swal({title:dexLang.t("title_deposit_processing"),text:new DexTemplate("apporve-confirm-success").replace({txHash:n}).content,icon:"success",html:!0}),new DexTransactionProcessingPopupRenderer(n,r.controller,"processing-popup",!1),setTimeout(function(){e.getAllowance(s)},1e3))})):(r.controller.helper.closeModal(),swal({title:dexLang.t("title_dear_customer"),text:dexLang.t("text_insufficient_funds_for_gas",{eth:web3.fromWei(c.toFixed(),"ether"),eur:web3.toBigNumber(web3.fromWei(c.toFixed(),"ether")).mul(web3.toBigNumber(r.controller.tokenPrices.getCurrentFiatPriceByAddress(ETH_ADDRESS))).toFixed(2),fiatSymbol:r.controller.currencySelector.currentCurrency.symbol}),icon:"warning"}))}})}};e.getAllowance(s)}else new DexFormErrorRenderer(n.getErrors(),"#deposit-token-form").render();return!1},this.depositTokenCallback=function(e,t){e?new DexApiErrorHandler(e,"deposit",r.controller):(swal({title:dexLang.t("title_deposit_processing"),text:new DexTemplate("deposit-confirm-success").replace({txHash:t}).content,icon:"success",html:!0}),new DexTransactionProcessingPopupRenderer(t,r.controller))}},DexWithdrawFormRenderer=function(e,t){let r=this,n=jQuery("body");this.controller=t,this.tokenAddress=e,this.token=this.controller.tokens[this.tokenAddress],this.template=new DexTemplate("withdraw-form"),this.render=function(){let e=this.controller.tokens[this.tokenAddress],t=r.tokenAddress===ETH_ADDRESS?r.controller.user.selectedAccount.balances[ETH_ADDRESS].dex.toString():r.controller.user.selectedAccount.balances[r.tokenAddress].dex.toString(),n={tokenSymbol:e.symbol,tokenAddress:e.address,value:t};return this.template.replace(n),this.template.content},this.rulesEth=[["amount",{validatorName:"lowerEqual",params:{value:r.controller.user.selectedAccount.balances[ETH_ADDRESS].dex.toString()}},dexLang.t("errmsg_insufficient_funds")],["amount",{validatorName:"greaterEqual",params:{value:r.controller.minAmount}},dexLang.t("errmsg_too_low")],["amount","required",dexLang.t("errmgs_field_required")],["amount","number",dexLang.t("errmsg_amount_number")],["kyc",{validatorName:"checkUserKyc",params:{user:r.controller.user}},{"not-approved":dexLang.t("text_complete_kyc"),pending:dexLang.t("text_review_kyc")}]],this.rulesToken=[["amount",{validatorName:"lowerEqual",params:{value:r.controller.user.selectedAccount.balances[r.tokenAddress].dex.toString()}},dexLang.t("errmsg_insufficient_funds")],["amount",{validatorName:"greaterEqual",params:{value:r.controller.minAmount}},dexLang.t("errmsg_too_low")],["amount","required",dexLang.t("errmgs_field_required")],["amount","number",dexLang.t("errmsg_amount_number")],["kyc",{validatorName:"checkUserKyc",params:{user:r.controller.user}},{"not-approved":dexLang.t("text_complete_kyc"),pending:dexLang.t("text_review_kyc")}]],n.off("submit.withdrawform"),n.on("submit.withdrawform","#withdraw-token-form",function(){let e=this;return authenticateUser2fa("withdraw_from_vault",function(){r.tokenAddress===ETH_ADDRESS?r.withdrawEthereum(e):r.withdrawToken(e)}),!1}),this.withdrawEthereum=function(e){let t=r.controller.helper.serializeForm(e),n=new DexFormValidator(this.rulesEth,t);if(r.controller.helper.clearFormError(e),n.validate()){let e=r.controller.user.selectedAccount.balances[ETH_ADDRESS].wallet.origValue,n=web3.toBigNumber(Formatter.sanitizeInputNumber(t.amount)).mul(web3.toBigNumber(10).pow(ETH_DECIMALS)),o=r.controller.helper.createTransactionObj({toAddress:r.controller.dexVault.contract.contractAddress,fromAddress:dexEth.userAddress,contract:r.controller.dexVault.contract.contract,functionName:"withdraw",applyFunctionData:[ETH_ADDRESS,n]});dexEth.call("eth_estimateGas",[o],function(o,a){if(o)r.controller.helper.closeModal(),new DexApiErrorHandler(o,"withdraw",r.controller);else{let o=web3.fromWei(r.controller.gasApi.getGasPrice(),"gwei"),i=web3.toBigNumber(web3.toWei(a,"gwei")),l=n.mul(r.controller.tokens[ETH_ADDRESS].withdrawFeeRate);i=i.mul(o);let s=(n=n.minus(i)).minus(l);e.lt(i)?(r.controller.helper.closeModal(),swal({title:dexLang.t("title_warning"),text:dexLang.t("text_insufficient_funds_for_gas",{eth:web3.fromWei(i.toFixed(),"ether"),eur:web3.toBigNumber(web3.fromWei(i.toFixed(),"ether")).mul(web3.toBigNumber(r.controller.tokenPrices.getCurrentFiatPriceByAddress(ETH_ADDRESS))).toFixed(2),fiatSymbol:r.controller.currencySelector.currentCurrency.symbol}),icon:"warning"})):new Modal({title:dexLang.t("title_confirm_withdraw"),content:new DexWithdrawConfirmRenderer({estimateGas:i,withdrawFee:l,amountCredited:s,tokenAddr:ETH_ADDRESS},function(){r.controller.dexVault.withdraw(ETH_ADDRESS,Formatter.formatForApi(Formatter.sanitizeInputNumber(t.amount),ETH_DECIMALS),function(e,t){e?r.withdrawErrorCallback(e):r.withdrawSuccessCallback(t)}),r.controller.user.selectedAccount.balances[r.tokenAddress].refreshable(),r.controller.tracking.log(2,22)},r.controller).render()})}})}else new DexFormErrorRenderer(n.getErrors(),"#withdraw-token-form").render();return!1},this.withdrawSuccessCallback=function(){swal({title:dexLang.t("title_withdraw_processing"),text:new DexTemplate("withdraw-confirm-success").replace({txHash:result}).content,icon:"success",html:!0}),new DexTransactionProcessingPopupRenderer(result,r.controller)},this.withdrawErrorCallback=function(e){new DexApiErrorHandler(e,"withdraw",r.controller)},this.withdrawToken=function(e){let t=r.controller.helper.serializeForm(e),n=new DexFormValidator(this.rulesToken,t);if(r.controller.helper.clearFormError(e),n.validate()){let e=r.controller.user.selectedAccount.balances[ETH_ADDRESS].wallet.origValue,n=web3.toBigNumber(Formatter.sanitizeInputNumber(t.amount)).mul(web3.toBigNumber(10).pow(r.controller.tokens[r.tokenAddress].decimals)),o=r.controller.helper.createTransactionObj({toAddress:r.controller.dexVault.contract.contractAddress,fromAddress:dexEth.userAddress,contract:r.controller.dexVault.contract.contract,functionName:"withdraw",applyFunctionData:[r.controller.tokens[r.tokenAddress].address,n]});dexEth.call("eth_estimateGas",[o],function(o,a){if(o)r.controller.helper.closeModal(),new DexApiErrorHandler(o,"withdraw",r.controller);else{let o=web3.fromWei(r.controller.gasApi.getGasPrice(),"gwei"),i=web3.toBigNumber(web3.toWei(a,"gwei")),l=n.mul(r.token.withdrawFeeRate);i=i.mul(o);let s=n.minus(l);e.lt(i)?(r.controller.helper.closeModal(),swal({title:dexLang.t("title_warning"),text:dexLang.t("text_insufficient_funds_for_gas",{eth:web3.fromWei(i.toFixed(),"ether"),eur:web3.toBigNumber(web3.fromWei(i.toFixed(),"ether")).mul(web3.toBigNumber(r.controller.tokenPrices.getCurrentFiatPriceByAddress(ETH_ADDRESS))).toFixed(2),fiatSymbol:r.controller.currencySelector.currentCurrency.symbol}),icon:"warning"})):new Modal({title:dexLang.t("title_confirm_withdraw"),content:new DexWithdrawConfirmRenderer({estimateGas:i,withdrawFee:l,amountCredited:s,decimals:r.token.decimals,tokenAddr:r.controller.tokens[r.tokenAddress].address},function(){r.controller.dexVault.withdraw(r.controller.tokens[r.tokenAddress].address,Formatter.formatForApi(Formatter.sanitizeInputNumber(t.amount),r.controller.tokens[r.tokenAddress].decimals),function(e,t){e?r.withdrawTokenErrorCallback(e):r.withdrawTokenSuccessCallback(t)}),r.controller.user.selectedAccount.balances[r.tokenAddress].refreshable()},r.controller).render()})}})}else new DexFormErrorRenderer(n.getErrors(),"#withdraw-token-form").render();return!1},this.withdrawTokenSuccessCallback=function(e){swal({title:dexLang.t("title_withdraw_processing"),text:new DexTemplate("withdraw-confirm-success").replace({txHash:e}).content,icon:"success",html:!0}),new DexTransactionProcessingPopupRenderer(e,r.controller)},this.withdrawTokenErrorCallback=function(e){new DexApiErrorHandler(e,"withdraw",r.controller)}},DexWithdrawConfirmRenderer=function(e,t,r){let n=this,o=jQuery("body");this.data=e,this.controller=r,this.template=new DexTemplate("withdraw-confirm"),this.render=function(){let e={estimatedGas:Formatter.formatForDisplay(Formatter.formatForPage(this.data.estimateGas)),withdrawFee:Formatter.formatForDisplay(Formatter.formatForPage(this.data.withdrawFee,this.data.decimals)),amountCredited:Formatter.formatForDisplay(Formatter.formatForPage(this.data.amountCredited,this.data.decimals)),withdrawTokenSymbol:this.controller.tokens[this.data.tokenAddr].symbol,withdrawTokenAddress:this.controller.tokens[this.data.tokenAddr].address};return this.template.replace(e),this.template.content},o.off("click.confirm-withdraw"),o.on("click.confirm-withdraw","#modal #modalContent [data-confirm-withdraw]",function(){"function"==typeof t&&(t(),n.controller.helper.closeModal())})},DexTradeFormConfirmRenderer=function(e,t){let r=this,n=jQuery("body");this.controller=t,this.template=new DexTemplate("trade-confirm"),this.render=function(){return this.template.content},n.off("click.confirm-trade"),n.on("click.confirm-trade","#modal #modalContent [data-confirm-trade]",function(){"function"==typeof e&&(e(),r.controller.helper.closeModal())})},DexTradeFormRenderer=function(e,t){let r=this,n=jQuery("body");this.data=e,this.controller=t,this.template=new DexTemplate("trade-form"),this.fee=0,n.on("change","#modal #trade-form-container .baseAvailableAmount, #modal #trade-form-container .quoteAvailableAmount",function(e){let t,n=jQuery("#modal #trade-form-container"),o=n.find(".baseAvailableAmount"),a=n.find(".quoteAvailableAmount"),i=n.find(".fee"),l=jQuery(e.target).hasClass("baseAvailableAmount");l?(t=r.calculateAll(Formatter.sanitizeInputNumber(o.val()),r.data,l),a.val(Formatter.formatForDisplay(t.quoteAvailableAmount.toFixed())),o.val(Formatter.formatForDisplay(Formatter.sanitizeInputNumber(o.val())))):(t=r.calculateAll(Formatter.sanitizeInputNumber(a.val()),r.data,l),o.val(Formatter.formatForDisplay(t.baseAvailableAmount.toFixed())),a.val(Formatter.formatForDisplay(Formatter.sanitizeInputNumber(a.val())))),i.val(t.fee),n.find(".totalSpend").text(Formatter.price(t.totalSpend)),n.find(".totalSpendEth").data("convertable-price",t.totalSpendEth),n.find(".tokenSpendSymbol").text(t.tokenSpendSymbol),n.find(".totalReceive").text(Formatter.price(t.totalReceive)),n.find(".totalReceiveEth").data("convertable-price",t.totalReceiveEth),n.find(".tokenReceiveSymbol").text(t.tokenReceiveSymbol),r.controller.currencySelector.refresh();let s=jQuery("#trade-form")[0],c=r.controller.helper.serializeForm(s),d=new DexFormValidator(r.rules,c);r.controller.helper.clearFormError(s),d.validate()||new DexFormErrorRenderer(d.getErrors(),s).render()}),this.rules=[[["baseAvailableAmount","quoteAvailableAmount"],"required",dexLang.t("errmgs_field_required")],["baseAvailableAmount","number",dexLang.t("errmsg_number_invalid")],["baseAvailableAmount",{validatorName:"lowerEqual",params:{value:parseFloat(this.data.available_amount)}},dexLang.t("errmsg_too_much")],["baseAvailableAmount",{validatorName:"greaterEqual",params:{value:r.controller.minAmount}},dexLang.t("errmsg_too_low")]],this.calculateAll=function(e,t,n){let o,a;e=Formatter.sanitizeInputNumber(e);let i,l=r.controller.tokenPrices.getETHPriceByAddress(this.controller.selectedMarket.baseCurrencyAddress,!1),s=r.controller.tokenPrices.getETHPriceByAddress(this.controller.selectedMarket.quoteCurrencyAddress,!1),c={baseAvailableAmount:null,quoteAvailableAmount:null,fee:null,totalSpend:null,totalSpendEth:null,tokenSpendSymbol:null,totalReceive:null,totalReceiveEth:null,tokenReceiveSymbol:null};return n?(a=(o=web3.toBigNumber(e)).mul(t.quote_amount).dividedBy(t.base_amount),c.baseAvailableAmount=o,c.quoteAvailableAmount=a):(o=(a=web3.toBigNumber(e)).mul(t.base_amount).dividedBy(t.quote_amount),c.quoteAvailableAmount=a,c.baseAvailableAmount=o),"buy"===r.data.type?(i=a.mul(r.controller.selectedMarket.takeFeeRate),c.totalReceive=parseFloat(a)+parseFloat(i),c.totalReceiveEth=s*c.totalReceive,c.tokenReceiveSymbol=this.controller.selectedMarket.quoteCurrency.symbol,c.tokenReceiveAddress=this.controller.selectedMarket.quoteCurrencyAddress,c.totalSpend=o,c.totalSpendEth=l*c.totalSpend,c.tokenSpendSymbol=this.controller.selectedMarket.baseCurrency.symbol,c.tokenSpendAddress=this.controller.selectedMarket.baseCurrencyAddress):(i=a.mul(r.controller.selectedMarket.takeFeeRate),c.totalSpend=parseFloat(a)+parseFloat(i),c.totalSpendEth=s*c.totalSpend,c.tokenSpendSymbol=this.controller.selectedMarket.quoteCurrency.symbol,c.tokenSpendAddress=this.controller.selectedMarket.quoteCurrencyAddress,c.totalReceive=o,c.totalReceiveEth=l*c.totalReceive,c.tokenReceiveSymbol=this.controller.selectedMarket.baseCurrency.symbol,c.tokenReceiveAddress=this.controller.selectedMarket.baseCurrencyAddress),r.fee=i,c.fee=i,c},this.render=function(){let t=new Date(this.data.expire),n=r.calculateAll(this.data.available_amount,this.data,!0),o=e.make_address===r.controller.user.selectedAccount.address,a=r.controller.tokenPrices.getCurrentFiatPriceByAddress(this.controller.selectedMarket.baseCurrencyAddress,!1),i=r.controller.tokenPrices.getCurrentFiatPriceByAddress(this.controller.selectedMarket.quoteCurrencyAddress,!1),l=r.controller.tokenPrices.getETHPriceByAddress(this.controller.selectedMarket.baseCurrencyAddress,!1),s=r.controller.tokenPrices.getETHPriceByAddress(this.controller.selectedMarket.quoteCurrencyAddress,!1),c={baseTokenSymbol:this.controller.selectedMarket.baseCurrency.symbol,baseTokenAddr:this.controller.selectedMarket.baseCurrencyAddress,quoteTokenSymbol:this.controller.selectedMarket.quoteCurrency.symbol,quoteTokenAddr:this.controller.selectedMarket.quoteCurrencyAddress,baseAvailableAmount:Formatter.formatForDisplay(n.baseAvailableAmount.toFixed()),quoteAvailableAmount:Formatter.formatForDisplay(n.quoteAvailableAmount.toFixed()),price:Formatter.price(Formatter.sanitizeInputNumber(this.data.price)),baseTokenPrice:Formatter.priceFiat(a,this.controller.currencySelector.currentCurrency),baseTokenPriceEth:l,quoteTokenPrice:Formatter.priceFiat(i,this.controller.currencySelector.currentCurrency),quoteTokenPriceEth:s,expireTimestamp:t.getTime(),expire:t.toLocaleString(),typeText:dexLang.t("text_order_type_"+this.data.type),typeTextInfo:dexLang.t("text_order_type_info_"+this.data.type).replace("{tokenName}",this.controller.selectedMarket.baseCurrency.symbol),fee:n.fee.toFixed(),totalSpend:Formatter.price(n.totalSpend),tokenSpendSymbol:n.tokenSpendSymbol,tokenSpendAddress:n.tokenSpendAddress,totalSpendEth:Formatter.formatForDisplay(n.totalSpendEth),totalReceive:Formatter.price(n.totalReceive),tokenReceiveSymbol:n.tokenReceiveSymbol,tokenReceiveAddress:n.tokenReceiveAddress,totalReceiveEth:Formatter.formatForDisplay(n.totalReceiveEth),yourOrder:o?'<h4 class="text-center text-danger">'+dexLang.t("text_your_order")+"</h4>":""};return this.template.replace(c),r.controller.tracking.log(4,412,this.controller.selectedMarket.id),this.template.content},n.off("submit.tradeformsubmit"),n.on("submit.tradeformsubmit","#trade-form",function(){let e=this;return authenticateUser2fa("trade_in_exchange",function(){let t=r.controller.helper.serializeForm(e);if(t.baseAvailableAmount=parseFloat(Formatter.sanitizeInputNumber(t.baseAvailableAmount)),"buy"===r.data.type){let e=dexLang.t("errmsg_not_enough_token");e=e.replace("{tokenSymbol}",r.controller.selectedMarket.baseCurrency.symbol);let t=parseFloat(r.controller.user.selectedAccount.balances[r.controller.selectedMarket.baseCurrencyAddress].dex.toString());r.rules.push(["baseAvailableAmount",{validatorName:"lowerEqual",params:{value:t}},e])}else{let e=dexLang.t("errmsg_not_enough_token");e=e.replace("{tokenSymbol}",r.controller.selectedMarket.quoteCurrency.symbol);let t=parseFloat(r.controller.user.selectedAccount.balances[r.controller.selectedMarket.quoteCurrencyAddress].dex.toString())-parseFloat(r.fee);r.rules.push(["quoteAvailableAmount",{validatorName:"lowerEqual",params:{value:t}},e])}let n=[...r.rules];n.push(["kyc",{validatorName:"checkUserKyc",params:{user:r.controller.user}},{"not-approved":dexLang.t("text_complete_kyc"),pending:dexLang.t("text_review_kyc")}]);let o=new DexFormValidator(n,t);if(r.controller.helper.clearFormError(e),o.validate()){let n=web3.toBigNumber(Formatter.formatForApi(t.baseAvailableAmount,r.controller.selectedMarket.baseCurrency.decimals));r.controller.helper.disableFormInputs(e);let o=new Date(r.data.expire).getTime()/1e3,a=[r.data.base_address,r.data.quote_address,web3.toBigNumber(Formatter.formatForApi(r.data.base_amount,r.controller.selectedMarket.baseCurrency.decimals)),web3.toBigNumber(Formatter.formatForApi(r.data.quote_amount,r.controller.selectedMarket.quoteCurrency.decimals)),"buy"===r.data.type,o,r.data.nonce,r.data.make_address,n,r.data.ecds_v.toString(),r.data.ecds_r,r.data.ecds_s,r.callback];r.data.make_address===r.controller.user.selectedAccount.address?new Modal({title:dexLang.t("title_warning"),content:new DexTradeFormConfirmRenderer(function(){r.controller.dexExchange.trade(...a)},r.controller).render()}):r.controller.dexExchange.trade(...a)}else new DexFormErrorRenderer(o.getErrors(),"#modal #trade-form-container #trade-form").render()}),!1}),this.callback=function(e,t){r.controller.helper.closeModal(),e?new DexApiErrorHandler(e,"trade",r.controller):(swal({title:dexLang.t("title_goodjob"),text:dexLang.t("text_trade_success"),icon:"success"}),r.controller.tracking.log(5,52,r.controller.selectedMarket.id),r.controller.user.selectedAccount.balances[r.data.base_address].refreshable(),r.controller.user.selectedAccount.balances[r.data.quote_address].refreshable(),new DexTransactionProcessingPopupRenderer(t,r.controller))},this.controller.eventDispatcher.ignore("expiredOrder."+e.signature),this.controller.eventDispatcher.listen("expiredOrder."+e.signature,function(){r.controller.eventDispatcher.ignore("expiredOrder."+e.signature),r.controller.helper.closeModal(),swal({title:dexLang.t("title_order_expired"),text:dexLang.t("text_order_expired"),icon:"info"})})},DexMultiTradeFormRenderer=function(e,t){let r=this,n=jQuery("body");this.container=jQuery("#multi-trade-form-container"),this.controller=t,this.template=new DexTemplate("multi-trade-form"),this.templateOrdersHeader=new DexTemplate("multi-trade-table-header"),this.templateOrdersRow=new DexTemplate("multi-trade-table-row"),this.orders=e,this.render=function(){let e={baseAvailableAmount:0,baseTokenSymbol:this.controller.selectedMarket.baseCurrency.symbol,price:0,quoteTokenSymbol:this.controller.selectedMarket.quoteCurrency.symbol,totalSpend:0,tokenSpendSymbol:"",tokenSpendAddress:"",totalReceive:0,tokenReceiveSymbol:"",tokenReceiveAddress:"",totalFee:0,feeSymbol:""},t=jQuery("<tbody/>");this.templateOrdersHeader.replace({baseTokenAddress:this.controller.selectedMarket.baseCurrencyAddress,baseTokenSymbol:this.controller.selectedMarket.baseCurrency.symbol,quoteTokenAddress:this.controller.selectedMarket.quoteCurrencyAddress,quoteTokenSymbol:this.controller.selectedMarket.quoteCurrency.symbol});let n=jQuery("<thead/>");n.append(this.templateOrdersHeader.content);for(let n=0;n<this.orders.length;++n){let o=this.orders[n],a=jQuery(o).data(),i=web3.toBigNumber(a.quote_amount).dividedBy(web3.toBigNumber(a.base_amount)),l=r.calculateAll(a,i);e.baseAvailableAmount=web3.toBigNumber(l.baseAvailableAmount).add(e.baseAvailableAmount),e.price=i.add(e.price),e.totalSpend=web3.toBigNumber(l.totalSpend).add(e.totalSpend),e.totalReceive=web3.toBigNumber(l.totalReceive).add(e.totalReceive),e.totalFee=web3.toBigNumber(l.fee).add(e.totalFee),e.feeSymbol=this.controller.selectedMarket.baseCurrency.symbol,e.tokenReceiveSymbol=l.tokenReceiveSymbol,e.tokenReceiveAddress=l.tokenReceiveAddress,e.tokenSpendSymbol=l.tokenSpendSymbol,e.tokenSpendAddress=l.tokenSpendAddress,this.templateOrdersRow.replace({signature:a.signature,type:a.type,price:Formatter.formatForDisplay(i.toFixed()),baseAvailableAmount:Formatter.formatForDisplay(l.baseAvailableAmount.toFixed()),quoteAvailableAmount:Formatter.formatForDisplay(l.quoteAvailableAmount.toFixed())}),t.append(this.templateOrdersRow.content),this.templateOrdersRow.reset()}e.baseAvailableAmount=Formatter.formatForDisplay(e.baseAvailableAmount),e.price=Formatter.formatForDisplay(e.price.dividedBy(this.orders.length).toFixed()),e.totalReceive=Formatter.formatForDisplay(e.totalReceive.toFixed()),e.totalFee=Formatter.formatForDisplay(e.totalFee.toFixed()),e.totalSpend=Formatter.formatForDisplay(e.totalSpend.toFixed()),this.template.replace(e);let o=jQuery('<table class="table table-condensed table-borderless"/>');return o.append(n),o.append(t),this.template.replace("{ordersTable}",o[0].outerHTML),this.template.content},this.calculateAll=function(e,t){let n,o,a,i=r.controller.tokenPrices.getETHPriceByAddress(this.controller.selectedMarket.baseCurrencyAddress,!1),l=r.controller.tokenPrices.getETHPriceByAddress(this.controller.selectedMarket.quoteCurrencyAddress,!1),s={baseAvailableAmount:null,quoteAvailableAmount:null,fee:null,totalSpend:null,totalSpendEth:null,tokenSpendSymbol:null,totalReceive:null,totalReceiveEth:null,tokenReceiveSymbol:null};return o=(n=web3.toBigNumber(e.available_amount)).mul(e.quote_amount).dividedBy(e.base_amount),s.baseAvailableAmount=n,s.quoteAvailableAmount=o,"buy"===e.type?(a=o.mul(r.controller.selectedMarket.takeFeeRate),s.totalReceive=parseFloat(o)+parseFloat(a),s.totalReceiveEth=l*s.totalReceive,s.tokenReceiveSymbol=this.controller.selectedMarket.quoteCurrency.symbol,s.tokenReceiveAddress=this.controller.selectedMarket.quoteCurrencyAddress,s.totalSpend=n,s.totalSpendEth=i*s.totalSpend,s.tokenSpendSymbol=this.controller.selectedMarket.baseCurrency.symbol,s.tokenSpendAddress=this.controller.selectedMarket.baseCurrencyAddress):(a=o.mul(r.controller.selectedMarket.takeFeeRate),s.totalSpend=parseFloat(o)+parseFloat(a),s.totalSpendEth=l*s.totalSpend,s.tokenSpendSymbol=this.controller.selectedMarket.quoteCurrency.symbol,s.tokenSpendAddress=this.controller.selectedMarket.quoteCurrencyAddress,s.totalReceive=n,s.totalReceiveEth=i*s.totalReceive,s.tokenReceiveSymbol=this.controller.selectedMarket.baseCurrency.symbol,s.tokenReceiveAddress=this.controller.selectedMarket.baseCurrencyAddress),r.fee=a,s.fee=a,s},n.off("submit.multitradeformsubmit"),n.on("submit.multitradeformsubmit","#multi-trade-form",function(){if(r.controller.helper.loginConfirmPopup()){let e,t,o=web3.toBigNumber("0"),a=[];for(let t=0;t<r.orders.length;++t){let n,i,l=r.orders[t],s=jQuery(l).data();n=(i="buy"===(e=s.type)?web3.toBigNumber(s.available_amount):web3.toBigNumber(s.available_amount).mul(s.quote_amount).dividedBy(s.base_amount)).mul(r.controller.selectedMarket.takeFeeRate),o=o.add(i.add(n)),a.push("trade_"+s.signature),console.log("amount",i.toFixed()),console.log("fee",n.toFixed())}if(t="buy"===e?r.controller.user.selectedAccount.balances[r.controller.selectedMarket.baseCurrencyAddress].dex.value:r.controller.user.selectedAccount.balances[r.controller.selectedMarket.quoteCurrencyAddress].dex.value,console.log("balance",t.toFixed()),console.log("total",o.toFixed()),t.gte(o)){r.controller.eventDispatcher.waitForAllEvents(a);let e=[],t=[],n=[],o=[],i=[],l=[],s=[],c=[],d=[],u=[],h=[],m=[];for(let a=0;a<r.orders.length;++a){let p=r.orders[a],f=jQuery(p).data();jQuery(p).hide(),r.controller.helper.disableFormInputs(this),e.push(f.base_address),t.push(f.quote_address),n.push(web3.toBigNumber(Formatter.formatForApi(f.base_amount,r.controller.selectedMarket.baseCurrency.decimals))),o.push(web3.toBigNumber(Formatter.formatForApi(f.quote_amount,r.controller.selectedMarket.quoteCurrency.decimals))),i.push("buy"===f.type),l.push(new Date(f.expire).getTime()/1e3),s.push(f.nonce),c.push(f.make_address),d.push(Formatter.formatForApi(f.available_amount,r.controller.selectedMarket.baseCurrency.decimals)),u.push(f.ecds_v.toString()),h.push(f.ecds_r),m.push(f.ecds_s)}r.controller.dexExchange.multiTrade(e,t,n,o,i,l,s,c,d,u,h,m,function(e,t){e||(r.controller.helper.closeModal(),swal({title:dexLang.t("title_goodjob"),text:dexLang.t("text_trade_success"),icon:"success"}),r.controller.user.selectedAccount.balances[r.controller.selectedMarket.baseCurrencyAddress].refreshable(),r.controller.user.selectedAccount.balances[r.controller.selectedMarket.quoteCurrencyAddress].refreshable(),new DexTransactionProcessingPopupRenderer(t,r.controller))})}else n.find("#modal .error").text(dexLang.t("errmsg_insufficient_funds"))}return!1})},DexMultiCancelFormRenderer=function(e,t,r){let n=this,o=jQuery("body");this.container=jQuery("#multi-cancel-form-container"),this.controller=t,this.template=new DexTemplate("multi-cancel-form"),this.orders=e,this.applyFunctionData=[],this.render=function(){n.applyFunctionData=[],new Modal({title:dexLang.t("title_multi_cancel"),content:n.controller.helper.processingDiv});let t=[],r=[],o=[],a=[],i=[],l=[],s=[],c=[],d=[],u=[];for(let e=0;e<n.orders.length;++e){let h=n.orders[e],m=jQuery(h).data();n.controller.helper.disableFormInputs(this),t.push(m.base_address),r.push(m.quote_address),o.push(web3.toBigNumber(Formatter.formatForApi(m.base_amount,n.controller.selectedMarket.baseCurrency.decimals))),a.push(web3.toBigNumber(Formatter.formatForApi(m.quote_amount,n.controller.selectedMarket.quoteCurrency.decimals))),i.push("buy"===m.type),l.push(new Date(m.expire).getTime()/1e3),s.push(m.nonce),c.push(m.ecds_v.toString()),d.push(m.ecds_r),u.push(m.ecds_s)}n.applyFunctionData=[t,r,o,a,i,l,s,c,d,u];let h=n.controller.helper.createTransactionObj({toAddress:n.controller.dexExchange.contract.contractAddress,fromAddress:dexEth.userAddress,contract:n.controller.dexExchange.contract.contract,functionName:"multiCancel",applyFunctionData:n.applyFunctionData,value:null});dexEth.call("eth_estimateGas",[h],function(t,r){if(t)new DexApiErrorHandler(t,"order-cancellation",n.controller);else{let t=web3.fromWei(n.controller.gasApi.getGasPrice(),"gwei"),o=web3.toBigNumber(web3.toWei(r,"gwei"));o=o.mul(t);let a={orderCnt:e.length,gasEth:Formatter.formatForPage(o),gasGwei:web3.fromWei(o,"gwei")};n.template.replace(a),new Modal({title:dexLang.t("title_multi_cancel"),content:n.template.content})}})},o.off("submit.multicancelformsubmit"),o.on("submit.multicancelformsubmit","#multi-cancel-form",function(){return n.controller.user.checkUserKyc()&&(n.controller.helper.disableFormInputs(this),n.applyFunctionData.push(function(e,t){e?new DexApiErrorHandler(e,"order-cancellation",n.controller):(n.controller.helper.closeModal(),swal({title:dexLang.t("title_goodjob"),text:dexLang.t("text_cancel_success"),icon:"success"}),jQuery(n.orders).remove(),"function"==typeof r&&r.call(),new DexTransactionProcessingPopupRenderer(t,n.controller))}),n.controller.dexExchange.multiCancel(...n.applyFunctionData)),!1})},DexGasPriceFormRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.template=new DexTemplate("gas-price-form"),this.gasMultiplierOptions={1:"none",1.05:"5%",1.1:"10%",1.15:"15%",1.2:"20%",1.25:"25%"},this.render=function(){let t,r=web3.fromWei(this.controller.gasApi.settings.gasPrice,"gwei"),n=this.controller.gasApi.settings.gasMultiplier,o="";for(let e in this.gasMultiplierOptions)t="",n===e&&(t='selected="selected"'),o+='<option value="'+e+'"'+t+">"+this.gasMultiplierOptions[e]+"</option>";let a=e.tokenPrices.getUSDPriceByAddress(ETH_ADDRESS),i=web3.fromWei(this.controller.gasApi.safelow,"ether"),l=web3.fromWei(this.controller.gasApi.standard,"ether"),s=web3.fromWei(this.controller.gasApi.fast,"ether"),c={safeLowNow:web3.fromWei(this.controller.gasApi.safelow,"gwei"),standardNow:web3.fromWei(this.controller.gasApi.standard,"gwei"),fastNow:web3.fromWei(this.controller.gasApi.fast,"gwei"),safeLowNowEth:i,standardNowEth:l,fastNowEth:s,safeLowNowFiat:web3.toBigNumber(web3.fromWei(this.controller.gasApi.safelow,"ether")).mul(a).toFixed(),standardNowFiat:web3.toBigNumber(web3.fromWei(this.controller.gasApi.standard,"ether")).mul(a).toFixed(),fastNowFiat:web3.toBigNumber(web3.fromWei(this.controller.gasApi.fast,"ether")).mul(a).toFixed(),gasMultiplierOptions:o,gasPrice:r};return this.template.replace(c),this.template.content},this.afterRender=function(){this.toggleForms(),this.controller.currencySelector.refresh()},jQuery("#modal").on("change",'[name="gasSetType"]',function(){t.controller.gasApi.settings.gasSetType=jQuery(this).val(),t.toggleForms()}),this.toggleForms=function(){let e=jQuery("#gas-price-form"),t=this.controller.gasApi.settings.gasSetType===GASSETTYPE_AUTOMATIC?GASSETTYPE_MANUAL:GASSETTYPE_AUTOMATIC;e.find("#gas-"+this.controller.gasApi.settings.gasSetType).prop("checked",!0),e.find(".form-"+t+" :input").parent().addClass("disabled"),e.find(".form-"+t+" :input").prop("disabled",!0),e.find(".form-"+this.controller.gasApi.settings.gasSetType+" :input").parent().removeClass("disabled"),e.find(".form-"+this.controller.gasApi.settings.gasSetType+" :input").removeAttr("disabled"),e.find('[name="gasType"]').parent().removeClass("active"),e.find('[name="gasType"][value="'+this.controller.gasApi.settings.gasType+'"]').parent().addClass("active"),e.find('[name="gasType"][value="'+this.controller.gasApi.settings.gasType+'"]').prop("checked",!0),e.find(".form-"+t).removeClass("active"),e.find(".form-"+this.controller.gasApi.settings.gasSetType).addClass("active")},this.rulesAuto=[[["gasMultiplier","gasSetType","gasType"],"required",dexLang.t("errmgs_field_required")],["gasMultiplier","number",dexLang.t("errmsg_gasmultiplier_number")],["gasSetType",{validatorName:"in",params:[GASSETTYPE_AUTOMATIC,GASSETTYPE_MANUAL]},dexLang.t("errmsg_invalid_type")],["gasType",{validatorName:"in",params:[GASTYPE_SAFELOW,GASTYPE_STANDARD,GASTYPE_FAST]},dexLang.t("errmsg_invalid_gas_type")]],this.rulesManual=[[["gasMultiplier","gasSetType","gasPrice"],"required",dexLang.t("errmgs_field_required")],["gasPrice","number",dexLang.t("errmsg_gasprice_number")],["gasPrice",{validatorName:"greater",params:{value:1e-8}},dexLang.t("errmsg_gasprice_greater_then_min",{min:"0.000000001"})]],r.off("submit.gaspriceform"),r.on("submit.gaspriceform","#gas-price-form",function(){let e=t.controller.helper.serializeForm(this),r=t.controller.gasApi.settings.gasSetType===GASSETTYPE_AUTOMATIC?t.rulesAuto:t.rulesManual,n=new DexFormValidator(r,e);return n.validate()?(t.controller.gasApi.settings.gasSetType=e.gasSetType,t.controller.gasApi.settings.gasType=e.gasType,t.controller.gasApi.settings.gasPrice=web3.toWei(e.gasPrice,"gwei"),t.controller.gasApi.settings.gasMultiplier=e.gasMultiplier,t.controller.gasApi.settings.gasSetType===GASSETTYPE_MANUAL?(dexEth.gasPrice=web3.toWei(e.gasPrice,"gwei"),dexEth.gasMultiplier=t.controller.gasApi.settings.gasMultiplier):t.controller.gasApi.load(),t.controller.storage.setItem("gasSettings",JSON.stringify(t.controller.gasApi.settings)),t.controller.helper.closeModal()):new DexFormErrorRenderer(n.getErrors(),"#gas-price-form").render(),!1})},DexPriceChartRenderer=function(e){let t=this;this.controller=e,this.data=null,this.serie=[],this.serieAm=[],this.container=jQuery("#chartPrice"),this.chartContiner=jQuery(".exchange .box-trades-volume"),this.chart=null,this.defaultRange="",this.setData=function(e){this.serie=[],this.serieAm=[],e.forEach(function(e){t.controller.dexPriceChartDataCache.push(e)}),this.data=new Array(...t.controller.dexPriceChartDataCache)},this.render=function(e){(e=e||null)&&this.setData(e),this.prepareDataOhlc(),"line"===t.controller.storage.getItem("chart-type","line")?t.configAmLineChart("chartPrice"):t.configAmCharts("chartPrice"),t.createAmCharts(),t.controller.eventDispatcher.trigger("moduleRendered",{container:t.container})},this.prepareDataOhlc=function(e){this.serie=[],this.serieAm=[],e=e||"range-D",this.data.sort(function(e,t){return e.created>t.created}),this.data.forEach(function(r){r.origCreatedAt=r.created,r.createdAt=t.controller.helper.formatDateByRange(r.created,e)}),[...new Set(this.data.map(e=>e.createdAt))].forEach(e=>{var r={},n={},o=t.data.filter(t=>t.createdAt===e);o.sort(function(e,t){return e.origCreatedAt>t.origCreatedAt});var a=[],i=[];if(o.forEach(e=>a.push(e.tokenPrice)),o.forEach(e=>i.push(e.amount)),void 0!==o[0]){let l=t.controller.helper.arraySum(i);r.x=new Date(e).getTime(),r.open=parseFloat(o[0].tokenPrice),r.volume=l,r.high=Math.max(...a),r.low=Math.min(...a),r.close=parseFloat(o[o.length-1].tokenPrice),n.date=new Date(e).toISOString(),n.open=parseFloat(o[0].tokenPrice),n.high=Math.max(...a),n.low=Math.min(...a),n.close=parseFloat(o[o.length-1].tokenPrice),n.volume=l}t.serie.push(r),t.serieAm.push(n)})},t.createHighCharts=function(){t.chart=Highcharts.stockChart("chartPrice",{title:{text:"Price Chart"},scrollbar:{enabled:!1},credits:{enabled:!1},chart:{backgroundColor:"#F2F3F8",width:t.chartContiner.width(),height:t.chartContiner.height()/2,animation:!1},plotOptions:{series:{animation:!1}},rangeSelector:!1,navigator:{enabled:!1},yAxis:{min:0},series:[{name:"Price",type:"candlestick",data:t.serie,color:"#e76c6c",upColor:"#498458",dataGrouping:{units:[["week",[1]],["month",[1,2,3,4,6]]]}}]}),jQuery(".highcharts-label-box").attr("rx",2).attr("ry",2)},t.configAmCharts=function(e){t.chart=am4core.createFromConfig({responsive:{enabled:!0},paddingRight:20,dateFormatter:{inputDateFormat:"i"},numberFormatter:{numberFormat:"#,###.#############"},xAxes:[{type:"DateAxis",renderer:{grid:{location:0}},endLocation:3}],yAxes:[{type:"ValueAxis",tooltip:{disabled:!0}}],series:[{type:"CandlestickSeries",id:"s1",dataFields:{dateX:"date",valueY:"close",openValueY:"open",lowValueY:"low",highValueY:"high"},tooltipText:"Date:{dateX.formatDate('YYYY-MM-dd HH:mm:ss')}\nOpen:{openValueY.value}\nLow:{lowValueY.value}\nHigh:{highValueY.value}\nClose:{valueY.value}",dropFromOpenState:{properties:{fill:am4core.color("#e76c6c"),stroke:am4core.color("#e76c6c")}},riseFromOpenState:{properties:{fill:am4core.color("#498458"),stroke:am4core.color("#498458")}}},{type:"LineSeries",id:"s2",dataFields:{dateX:"date",valueY:"close"},defaultState:{properties:{visible:!1}},fill:am4core.color("#a8cbe5"),hiddenInLegend:!0,fillOpacity:.5,strokeOpacity:.5}],cursor:{type:"XYCursor"}},e,am4charts.XYChart);var r=t.chart.titles.create();r.text=dexLang.t("text_price_chart"),r.fontSize=15,r.marginBottom=10},t.createAmCharts=function(){t.chart.data=t.serieAm},t.configAmLineChart=function(e){t.chart=am4core.create(e,am4charts.XYChart),t.chart.leftAxesContainer.layout="vertical";var r=t.chart.xAxes.push(new am4charts.DateAxis);r.baseInterval={timeUnit:"second",count:1},r.renderer.grid.template.location=0,r.renderer.ticks.template.length=8,r.renderer.ticks.template.strokeOpacity=.1,r.renderer.grid.template.disabled=!0,r.renderer.ticks.template.disabled=!1,r.renderer.ticks.template.strokeOpacity=.2,r.renderer.minLabelPosition=.01,r.renderer.maxLabelPosition=.99,r.renderer.cellStartLocation=.3,r.renderer.cellStartLocation=.7,r.endLocation=5,r.keepSelection=!0,r.minHeight=30,r.groupData=!0,r.minZoomCount=5;var n=t.chart.yAxes.push(new am4charts.ValueAxis);n.tooltip.disabled=!0,n.zIndex=1,n.renderer.baseGrid.disabled=!0,n.height=am4core.percent(65),n.renderer.gridContainer.background.fill=am4core.color("#000000"),n.renderer.gridContainer.background.fillOpacity=.05,n.renderer.inside=!0,n.renderer.labels.template.verticalCenter="bottom",n.renderer.labels.template.padding(2,2,2,2),n.renderer.fontSize="0.8em";var o=t.chart.series.push(new am4charts.LineSeries);o.dataFields.dateX="date",o.dataFields.valueY="close",o.tooltipText="{valueY.value}",o.name="MSFT: Value",o.defaultState.transitionDuration=0;var a=t.chart.yAxes.push(new am4charts.ValueAxis);a.tooltip.disabled=!0,a.height=am4core.percent(35),a.zIndex=3,a.marginTop=30,a.renderer.baseGrid.disabled=!0,a.renderer.inside=!0,a.renderer.labels.template.verticalCenter="bottom",a.renderer.labels.template.padding(2,2,2,2),a.renderer.fontSize="0.8em",a.renderer.gridContainer.background.fill=am4core.color("#000000"),a.renderer.gridContainer.background.fillOpacity=.05;var i=t.chart.series.push(new am4charts.ColumnSeries);i.dataFields.dateX="date",i.dataFields.valueY="volume",i.yAxis=a,i.tooltipText="{valueY.value}",i.name="MSFT: Volume",i.groupFields.valueY="sum",i.defaultState.transitionDuration=0,t.chart.cursor=new am4charts.XYCursor;var l=new am4charts.XYChartScrollbar;l.series.push(o),l.marginBottom=20,l.scrollbarChart.xAxes.getIndex(0).minHeight=void 0,t.chart.scrollbarX=l}},DexDepthChartRenderer=function(e){let t=this;this.controller=e,this.chartContiner=jQuery(".exchange .box-trades-volume"),this.container=jQuery("#chartDepth"),this.chart=null,this.data=null,this.setData=function(){this.data=this.controller.dexDepthChartDataCache},this.render=function(){t.setData(),this.prepareData(),t.createAmCharts("chartDepth"),t.controller.eventDispatcher.trigger("moduleRendered",{container:t.container})},this.prepareData=function(){let e={buy:{},sell:{}};for(let t in this.data.buy){let r=this.data.buy[t],n=Math.ceil(1e5*r.price)/1e5;void 0===e.buy[n]?e.buy[n]=parseFloat(r.volume):e.buy[n]+=parseFloat(r.volume),e.sell[n]=0}for(let t in this.data.sell){let r=this.data.sell[t],n=Math.ceil(1e5*r.price)/1e5;void 0===e.sell[n]?e.sell[n]=parseFloat(r.volume):e.sell[n]+=parseFloat(r.volume),void 0===e.buy[n]&&(e.buy[n]=0)}let r=[];for(let t in e.buy){let n=parseFloat(e.buy[t]);t=parseFloat(t),r.push([t,n])}r.sort(function(e,t){return e[0]-t[0]});let n=[];for(let t in e.sell){let r=parseFloat(e.sell[t]);t=parseFloat(t),n.push([t,r])}n.sort(function(e,t){return e[0]-t[0]}),t.serieBuy=r,t.serieSell=n},t.createHighCharts=function(){t.chart=Highcharts.chart("chartDepth",{rangeSelector:!1,scrollbar:{enabled:!1},title:{text:"Depth Chart"},credits:{enabled:!1},chart:{backgroundColor:"#F2F3F8",width:t.chartContiner.width(),height:t.chartContiner.height()/2,animation:!1},plotOptions:{series:{animation:!1}},xAxis:{title:{text:dexLang.t("label_price")}},yAxis:{title:{text:dexLang.t("label_cumulative_bid_size")}},series:[{name:"Buy",type:"area",data:t.serieBuy,color:"#498458",tooltip:{},fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#d4e0e5"],[1,Highcharts.Color("#d4e0e5").setOpacity(0).get("rgba")]]}},{name:"Sell",type:"area",data:t.serieSell,color:"#e76c6c",tooltip:{},fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#d4e0e5"],[1,Highcharts.Color("#d4e0e5").setOpacity(0).get("rgba")]]}}]})},this.amXAxis,t.configAmCharts=function(){t.chart.responsive.enabled=!0,t.chart.numberFormatter.numberFormat="#,###.##",t.xAxis=t.chart.xAxes.push(new am4charts.CategoryAxis),t.xAxis.dataFields.category="value",t.xAxis.renderer.minGridDistance=50,t.xAxis.title.text=dexLang.t("label_price_depth",{market:t.controller.getCurrentMarketName()}),t.chart.yAxes.push(new am4charts.ValueAxis).title.text="Volume";var e=t.chart.series.push(new am4charts.StepLineSeries);e.dataFields.categoryX="value",e.dataFields.valueY="bidstotalvolume",e.strokeWidth=2,e.stroke=am4core.color("#498458"),e.fill=e.stroke,e.fillOpacity=.1,e.tooltipText='Bid: [bold]{categoryX.formatNumber("#,###.#############")}[/]\nTotal volume: [bold]{valueY}[/]\nVolume: [bold]{bidsvolume}[/]';var r=t.chart.series.push(new am4charts.StepLineSeries);r.dataFields.categoryX="value",r.dataFields.valueY="askstotalvolume",r.strokeWidth=2,r.stroke=am4core.color("#e76c6c"),r.fill=r.stroke,r.fillOpacity=.1,r.tooltipText='Ask: [bold]{categoryX.formatNumber("#,###.#############")}[/]\nTotal volume: [bold]{valueY}[/]\nVolume: [bold]{asksvolume}[/]';var n=t.chart.series.push(new am4charts.ColumnSeries);n.dataFields.categoryX="value",n.dataFields.valueY="bidsvolume",n.strokeWidth=0,n.fill=am4core.color("#000"),n.fillOpacity=.2;var o=t.chart.series.push(new am4charts.ColumnSeries);o.dataFields.categoryX="value",o.dataFields.valueY="asksvolume",o.strokeWidth=0,o.fill=am4core.color("#000"),o.fillOpacity=.2;var a=t.chart.titles.create();a.text=dexLang.t("text_depth_chart"),a.fontSize=15,a.marginBottom=10,t.chart.cursor=new am4charts.XYCursor},t.createAmCharts=function(e){function r(e){e=Object.values(e);let t={};for(let r=0;r<e.length;r++){let n=parseFloat(e[r].price);void 0===t[n]?t[n]={volume:parseFloat(e[r].volume),price:parseFloat(e[r].price)}:t[n].volume+=parseFloat(e[r].volume)}return t}function n(e,t,r){if((e=Object.values(e)).sort(function(e,t){return e.price>t.price?1:e.price<t.price?-1:0}),r)for(let r=e.length-1;r>=0;r--){r<e.length-1?e[r].totalvolume=parseFloat(e[r+1].totalvolume)+parseFloat(e[r].volume):e[r].totalvolume=parseFloat(e[r].volume),(n={}).value=parseFloat(e[r].price),n[t+"volume"]=parseFloat(e[r].volume),n[t+"totalvolume"]=parseFloat(e[r].totalvolume),o.unshift(n)}else for(let r=0;r<e.length;r++){var n;e[r].totalvolume=r>0?parseFloat(e[r-1].totalvolume)+parseFloat(e[r].volume):parseFloat(e[r].volume),(n={}).value=parseFloat(e[r].price),n[t+"volume"]=parseFloat(e[r].volume),n[t+"totalvolume"]=parseFloat(e[r].totalvolume),o.push(n)}}t.chart=am4core.create(e,am4charts.XYChart),t.configAmCharts();var o=[];let a=r(t.data.buy),i=r(t.data.sell);for(let e in a)void 0!==i[e]&&(i[e].volume>a[e].volume?(i[e].volume-=a[e].volume,delete a[e]):i[e].volume<a[e].volume?(a[e].volume-=i[e].volume,delete i[e]):(delete a[e],delete i[e]));n(a,"bids",!0),n(i,"asks",!1),t.xAxis.title.text=dexLang.t("label_price_depth",{market:t.controller.getCurrentMarketName()}),t.chart.data=o}},DexNewAccountRenderer=function(e,t){this.address=e,this.privateKey=t,this.template=new DexTemplate("new-account-popup"),this.render=function(){let e={address:this.address,privateKey:this.privateKey};return this.template.replace(e),this.template.content}},DexExportPrivateKeyRenderer=function(e){this.controller=e,this.template=new DexTemplate("export-private-key"),this.render=function(){let e=this.controller.user.selectedAccount.pk;null===e&&(e=dexLang.t("text_export_metamask"));let t={address:this.controller.user.selectedAccount.address,privateKey:e};return this.template.replace(t),this.template.content}},DexForgetAccountRenderer=function(e){let t=this;this.controller=e,this.container=jQuery("body"),this.template=new DexTemplate("forget-account"),this.render=function(){let e={address:this.controller.user.selectedAccount.address,privateKey:this.controller.user.selectedAccount.pk};return this.template.replace(e),this.template.content},this.container.off("submit.forgetaccount"),this.container.on("submit.forgetaccount","#forget-account",function(){return t.controller.user.doForgetAccount(),t.controller.helper.closeModal(),!1})},DexImportAccountFormRenderer=function(e,t){let r=this,n=jQuery("body");this.controller=e,this.callback=t||function(){},this.template=new DexTemplate("import-account-form"),this.render=function(){return this.template.content},this.rules=[[["address","privateKey"],"required",dexLang.t("errmgs_field_required")],["address","address",dexLang.t("errmsg_address_invalid")],["privateKey","privateKey",dexLang.t("errmsg_pk_invalid")]],n.off("submit.importaccountform"),n.on("submit.importaccountform","#import-account-form",function(){let e=r.controller.helper.serializeForm(this),n=new DexFormValidator(r.rules,e);if(n.validate()){let n=e.address,o=0===e.privateKey.indexOf("0x")&&e.privateKey.length>64?e.privateKey.substring(2):e.privateKey;r.controller.user.accounts[n]=new DexUserAccount({address:n,privateKey:o,metamask:!1,type:"imported",isNew:!0},r.controller),r.controller.user.changeAccount(n),r.controller.initPage(),r.controller.tracking.log(1,13),"function"==typeof t&&t()}else new DexFormErrorRenderer(n.getErrors(),"#import-account-form").render();return!1})},DexImportAccountPkFormRenderer=function(e,t,r){let n=this,o=jQuery("body");this.controller=e,this.address=t,this.callback=r||function(){},this.template=new DexTemplate("empty-account-pk-popup"),this.render=function(){this.template.replace("{address}",this.address),new Modal({title:"Import Private key",content:this.template.content})},this.rules=[[["privateKey"],"required",dexLang.t("errmgs_field_required")],["privateKey","privateKey",dexLang.t("errmsg_pk_invalid")]],o.off("submit.importaccountpkform"),o.on("submit.importaccountpkform","#import-pk-form",function(){let e=n.controller.helper.serializeForm(this),t=new DexFormValidator(n.rules,e);if(t.validate()){let t=n.address,o=0===e.privateKey.indexOf("0x")&&e.privateKey.length>64?e.privateKey.substring(2):e.privateKey;n.controller.user.accounts[t]=new DexUserAccount({address:t,privateKey:o,metamask:!1,type:"imported",isNew:!0},n.controller),n.controller.user.storeToStorage(),n.controller.user.changeAccount(t),"function"==typeof r&&r()}else new DexFormErrorRenderer(t.getErrors(),"#import-pk-form").render();return!1})},DexCurrencySelectorRenderer=function(e){let t=this,r=jQuery("body");this.controller=e,this.template=new DexTemplate("currency-selector"),this.templateItem=new DexTemplate("currency-selector-item"),this.container=jQuery("#currencySelector"),this.defaultCurrency="EUR",this.currentCurrency=this.controller.storage.getItem("currentCurrency",this.defaultCurrency),this.currencies={},this.eventsAdded=!1,this.initCurrencies=function(){for(let e in t.controller.tokenPrices.data)t.currencies[e]=e.toUpperCase();for(let e in t.controller.fiatPrices.data.USD)t.currencies[e]=e.toUpperCase()},this.render=function(){let e="";this.template.reset(),this.templateItem.reset();for(let t in this.currencies){if("ETH"===t)continue;if(this.currentCurrency===t){this.template.replace("{currentCurrencySymbol}",this.currentCurrency.toUpperCase()),this.template.replace("{currentCurrencySymbolSymbol}",Formatter.symbolArr[this.currentCurrency.toLowerCase()].symbol);continue}let r={currencyKey:t,currencySymbol:t.toUpperCase(),currencySymbolSymbol:Formatter.symbolArr[t.toLowerCase()].symbol};this.templateItem.replace(r),e+=this.templateItem.content,this.templateItem.reset()}this.template.replace("{items}",e),this.container.html(this.template.content),this.eventsAdded||(this.controller.eventDispatcher.listen("tokenPricesRefreshed fiatPricesRefreshed",t.refresh),this.eventsAdded=!0)},this.controller.eventDispatcher.listen("tokenPricesLoaded",this.initCurrencies),this.changeCurrency=function(e){if(null!==t.currencies&&void 0!==t.currencies[e]){t.controller.storage.setItem("currentCurrency",e),t.currentCurrency=e,t.render(),r.find(".dex-page [data-convertable-price], .dex-page [data-convertable-price-title], #modal [data-convertable-price], #modal [data-convertable-price-title]").each(function(e,r){let n=jQuery(r),o=parseFloat(n.data("convertable-price")),a=parseFloat(n.data("convertable-price-title")),i=parseInt(n.data("convert-decimals")),l=web3.toBigNumber(1);"base"===n.data("convertable-price-type")?l=t.getMultiplierBase():"quote"===n.data("convertable-price-type")&&(l=t.getMultiplierQuote());let s=!1;isNaN(o)&&(o=a,s=!0);let c=l.mul(web3.toBigNumber(o).mul(t.controller.tokenPrices.data.USD[ETH_ADDRESS])).mul(web3.toBigNumber(t.controller.fiatPrices.getUsdPriceBySymbol(t.currentCurrency)));s||n.html(Formatter.priceFiat(c.toFixed(),t.currentCurrency,i)),n.attr("title",Formatter.priceFiat(c.toFixed(),t.currentCurrency,i))})}},this.container.off("click.changeCurrency"),this.container.on("click.changeCurrency",".change-currency",function(){let e=jQuery(this).data("currency-key");t.changeCurrency(e),t.controller.tracking.log(4,49,e)}),this.refresh=function(){t.changeCurrency(t.currentCurrency)},this.getMultiplierBase=function(){let e;return t.controller.selectedMarket.baseCurrencyAddress===ETH_ADDRESS?e=1:(e=t.controller.tokenPrices.data.ETH[t.controller.selectedMarket.baseCurrencyAddress])||(e=0),web3.toBigNumber(e)},this.getMultiplierQuote=function(){let e;return t.controller.selectedMarket.quoteCurrencyAddress===ETH_ADDRESS?e=1:(e=t.controller.tokenPrices.data.ETH[t.controller.selectedMarket.quoteCurrencyAddress])||(e=0),web3.toBigNumber(e)}},DexAccountUnassignedRenderer=function(e){let t=this,r=jQuery("body");t.controller=e,t.template=new DexTemplate("account-unassigned"),t.render=function(){let e={unassignedText:dexLang.t("text_unassigned_account"),btnTitle:dexLang.t("btn-text-manage-addresses")};this.template.replace(e),new Modal({title:dexLang.t("title_error"),content:t.template.content,unClosable:!0})},r.on("click.gotomanageaddresses"),r.on("click.gotomanageaddresses","[data-go-to-manage-addresses]",function(){window.location="/addresses"})},DexTransactionProcessingPopupRenderer=function(e,t,r,n){let o=this;n=null==n||n,o.controller=t,o.trHash=e,o.trCompleted=!1,o.callCount=0,o.transaction=null,o.template=r||"transaction-processing-popup",o.render=function(){var e=new DexTemplate(o.template);e.replace({txHash:o.trHash}),web3.currentProvider&&!web3.currentProvider.isMetaMask&&e.hideSection("metamask-address"),new Modal({title:dexLang.t("title_processing"),content:e.content,afterClose:function(){clearInterval(o.loadInterval)}})},o.loadInterval=setInterval(function(){o.callCount++,dexEth.call("eth_getTransactionByHash",[o.trHash],function(e,t){e||(o.transaction=t,o.transaction.blockHash&&(o.trCompleted=!0,n&&o.controller.helper.closeModal(),swal.close(),clearInterval(o.loadInterval)),o.trCompleted||60!==o.callCount||(swal.close(),o.render()))})},1e3)},DexVolumePopupRenderer=function(e){let t=this;t.controller=e,t.template=new DexTemplate("volume-popup"),t.render=function(){new Modal({title:"Volume",content:t.template.content,size:"modal-fullscreen",afterShown:t.afterShown})},t.afterShown=function(){t.controller.renderers.popupTickerRenderer.render()}},DexPopupTickersRenderer=function(e,t){let r=this;this.data=e,this.controller=t,this.controller.renderers.popupTickerRenderer=this,this.template=new DexTemplate("ticker-table-row"),this.render=function(){this.container=jQuery("#popupTickerTable"),this.containerBody=jQuery("#popupTickerTableBody"),this.containerBody.html("");let e=new DexTickersTableHeaderRenderer(r.controller,{containerDiv:"#popupTickerTable",containerHeadDiv:"#popupTickerTableHead",containerBodyDiv:"#popupTickerTableBody",sortOptionsKey:"popupTickerTable",eventNamespace:"popuptickerlistsortby"});e.render();let t={};for(let e=0;e<this.data.length;e++){let r=this.data[e],n=this.controller.getMarketByAddresses(r.base_address,r.quote_address);if(void 0!==n&&void 0===t[n.id]){t[n.id]=n.id;let e=0!==parseFloat(r.base_volume)?Formatter.priceTicker(r.base_volume,8):"-",o=0!==parseFloat(r.quote_volume)?Formatter.priceTicker(r.quote_volume,8):"-",a=null!==r.bid_price?Formatter.priceTicker(r.bid_price,8):"-",i=null!==r.ask_price?Formatter.priceTicker(r.ask_price,8):"-",l=null!==r.last_price?Formatter.priceTicker(r.last_price,8):"-",s=0!==parseFloat(r.base_volume)?Formatter.priceTicker(r.base_volume):"-",c=0!==parseFloat(r.quote_volume)?Formatter.priceTicker(r.quote_volume):"-",d=null!==r.bid_price?Formatter.priceTicker(r.bid_price):"-",u=null!==r.ask_price?Formatter.priceTicker(r.ask_price):"-",h=null!==r.last_price?Formatter.priceTicker(r.last_price):"-",m={marketName:n.name,marketId:n.id,baseVolume:e,quoteVolume:o,bid:a,ask:i,lastPrice:l,eBaseVolume:e!=s?s:"",eQuoteVolume:o!=c?c:"",eBid:a!=d?d:"",eAsk:i!=u?u:"",eLastPrice:l!=h?h:""};this.template.replace(m),this.containerBody.append(this.template.content),this.template.reset()}}e.tableSorter.sort()}},DexFiatPrices=function(e,t){let r=this;this.controller=t,this.data=e,this.refreshPrices=function(e){this.setData(e),r.controller.eventDispatcher.trigger("fiatPricesRefreshed")},this.setData=function(e){for(let t in e){let n=e[t];for(let e in n)r.data[t][e]=1/parseFloat(n[e])}},this.getUsdPriceBySymbol=function(e){return void 0!==r.data.USD[e]?r.data.USD[e]:1},this.setData(e)},DexTokenPrices=function(e,t){let r=this;this.data=e,this.controller=t,this.refreshPrices=function(e){for(let t in e){let n=e[t],o=n[ETH_ADDRESS]||r.data[t][ETH_ADDRESS];for(let e in n)r.data[t][e]=n[e],void 0===r.data.ETH&&(r.data.ETH={}),r.data.ETH[e]=n[e]/o,null!==r.controller.user.selectedAccount&&void 0!==r.controller.user.selectedAccount.balances[e]&&(r.controller.user.selectedAccount.balances[e].isNullBalance||r.controller.eventDispatcher.trigger("balanceLoaded",{tokenAddress:e}))}r.controller.eventDispatcher.trigger("tokenPricesRefreshed")},this.refreshPrices(e),this.getUSDPriceByAddress=function(e,t){let n=r.data.USD[e];return t=t||!1,void 0!==n&&(null===n&&(n=0),t?Math.round(1e5*n,2)/1e5:n)},this.getETHPriceByAddress=function(e,t){let n=r.data.ETH[e];return t=t||!1,void 0!==n&&(null===n&&(n=0),t?Math.round(1e6*n,3)/1e6:n)},this.getCurrentFiatPriceByAddress=function(e){return r.data.ETH[e]*r.data.USD[ETH_ADDRESS]*r.controller.fiatPrices.getUsdPriceBySymbol(r.controller.currencySelector.currentCurrency)}},DexCryptoPrices=function(e,t){let r=this;this.controller=t,this.data=e,this.refreshPrices=function(e){this.setData(e),r.controller.eventDispatcher.trigger("cryptoPricesRefreshed")},this.setData=function(e){let t=parseFloat(r.controller.tokenPrices.getUSDPriceByAddress(ETH_ADDRESS,!1));for(let n in e){let o=e[n];for(let e in o)r.data[n][e]=parseFloat(o[e]),void 0===r.data.ETH&&(r.data.ETH={}),r.data.ETH["W"+e]=parseFloat(o[e])/t}},this.getCurrentPrice=function(e){return r.data.ETH[e.symbol]?r.data.ETH[e.symbol]:r.controller.tokenPrices.getETHPriceByAddress(e.address)},this.setData(e)},DexTokenValue=function(e,t,r){let n=this;this.tokenAddress=t,this.decimals=r.tokens[n.tokenAddress].decimals,this.origValue=e,this.value=Formatter.bigNumberFormatForApi(e,this.decimals),this.toUSD=function(){let e=r.tokenPrices.getUSDPriceByAddress(n.tokenAddress);return!1!==e?this.value.mul(e):0},this.toETH=function(){let e=r.tokenPrices.getETHPriceByAddress(n.tokenAddress,!0);return e?this.value.mul(e):0},this.toCurrentFiat=function(){let e=this.getMultiplierBase(),t=this.toETH();if(t){return t.mul(e.mul(r.tokenPrices.data.USD[ETH_ADDRESS])).mul(web3.toBigNumber(r.fiatPrices.getUsdPriceBySymbol(r.currencySelector.currentCurrency)))}return 0},this.toEur=function(){let e=this.toETH();if(e){return e.mul(r.tokenPrices.data.USD[ETH_ADDRESS]).mul(web3.toBigNumber(r.fiatPrices.getUsdPriceBySymbol("EUR")))}return 0},this.toString=function(){return this.value.toString()},this.toFixed=function(){return this.value.toFixed()},this.getMultiplier=function(){let e;return r.selectedMarket.quoteCurrency.address===ETH_ADDRESS?e=1:(e=r.tokenPrices.data.ETH[r.selectedMarket.quoteCurrency.address])||(e=1),web3.toBigNumber(e)},this.getMultiplierBase=function(){let e;return r.selectedMarket.baseCurrencyAddress===ETH_ADDRESS?e=1:(e=r.tokenPrices.data.ETH[r.selectedMarket.baseCurrencyAddress])||(e=1),web3.toBigNumber(e)},this.getMultiplierQuote=function(){let e;return r.selectedMarket.quoteCurrencyAddress===ETH_ADDRESS?e=1:(e=r.tokenPrices.data.ETH[r.selectedMarket.quoteCurrencyAddress])||(e=1),web3.toBigNumber(e)}},DexToken=function(e,t,r){let n=this;this.address=e,this.name=t.name,this.symbol=t.symbol,this.decimals=t.decimals,this.isBaseToken=t.isBaseToken,this.isQuoteToken=t.isQuoteToken,this.isVisible=t.isVisible,this.isEnabled=!1!==t.isEnabled,this.isDepositEnabled=t.isDepositEnabled||!1,this.ownerAddress=t.ownerAddress,this.isWrapped=t.isWrapped,this.depositFeeRate=t.depositFeeRate||0,this.withdrawFeeRate=t.withdrawFeeRate||0,this.allowance=null,t.priceMarginBelow&&(this.priceMarginBelow=parseFloat(Formatter.formatForPage(t.priceMarginBelow))),t.priceMarginAbove&&(this.priceMarginAbove=parseFloat(Formatter.formatForPage(t.priceMarginAbove)));let o=null;this.contract=function(){return null===o&&(o=new DexERC20Token({contractAddress:n.address})),o},this.getAllowance=function(e){this.contract().allowance(r.user.selectedAccount.address,r.dexVault.contract.contractAddress,function(t,r){t||(n.allowance=Formatter.bigNumberFormatForApi(r,n.decimals),"function"==typeof e&&e())})},this.getPriceMargins=function(){return n.priceMarginBelow||n.priceMarginAbove?{min:n.priceMarginBelow?1-n.priceMarginBelow:null,max:n.priceMarginAbove?1+n.priceMarginAbove:null}:null}},DexMarket=function(e,t,r){this.controller=r,this.id=e,this.name=t.name,this.baseCurrencyAddress=t.baseCurrencyAddress,this.quoteCurrencyAddress=t.quoteCurrencyAddress,this.isEnabled=t.isEnabled,this.isSellEnabled=t.isSellEnabled,this.isBuyEnabled=t.isBuyEnabled,this.upperPriceMarginRate=t.upperPriceMarginRate||null,this.lowerPriceMarginRate=t.lowerPriceMarginRate||null,this.upperHardPriceMarginRate=t.upperHardPriceMarginRate||null,this.lowerHardPriceMarginRate=t.lowerHardPriceMarginRate||null,this.makeFeeRate=t.makeFeeRate||0,this.takeFeeRate=t.takeFeeRate||0,this.isVisible=t.isVisible,this.baseCurrency=this.controller.tokens[this.baseCurrencyAddress],this.quoteCurrency=this.controller.tokens[this.quoteCurrencyAddress],this.orderData=[]},DexBalance=function(e,t,r){let n=this;this.accountAddress=e,this.tokenAddress=t,this.token=r.tokens[this.tokenAddress],this.dex=new DexTokenValue(web3.toBigNumber(0),this.tokenAddress,r),this.wallet=new DexTokenValue(web3.toBigNumber(0),this.tokenAddress,r),this.allowance=null,this.isNullBalance=!0,this.isLowBalance=!1,this.refreshFlag=!1,this.sortAfter=!0,this.load=function(){n.refreshBalances(),void 0!==n.accountAddress?(r.dexVault.balanceOf(n.tokenAddress,n.accountAddress,function(e,t){e||(n.dex=new DexTokenValue(t,n.tokenAddress,r),r.eventDispatcher.trigger("dexBalanceLoaded."+n.tokenAddress))}),n.tokenAddress===ETH_ADDRESS?dexEth.call("eth_getBalance",[n.accountAddress,"latest"],function(e,t){e||(n.wallet=new DexTokenValue(t,n.tokenAddress,r),r.eventDispatcher.trigger("walletBalanceLoaded."+n.tokenAddress))}):(this.token.contract().balanceOf(n.accountAddress,function(e,t){e||(n.wallet=new DexTokenValue(t,n.tokenAddress,r),r.eventDispatcher.trigger("walletBalanceLoaded."+n.tokenAddress))}),this.token.isDepositEnabled&&this.token.contract().allowance(n.accountAddress,r.dexVault.contract.contractAddress,function(e,t){e||(n.allowance=Formatter.bigNumberFormatForApi(t,n.token.decimals))}))):(n.dex=new DexTokenValue(web3.toBigNumber(0),n.tokenAddress,r),r.eventDispatcher.trigger("dexBalanceLoaded."+n.tokenAddress),n.wallet=new DexTokenValue(web3.toBigNumber(0),n.tokenAddress,r),r.eventDispatcher.trigger("walletBalanceLoaded."+n.tokenAddress),n.allowance=Formatter.bigNumberFormatForApi(web3.toBigNumber(0),n.token.decimals))},this.refreshBalances=function(){let e=n.dex.toFixed(),t=n.wallet.toFixed();jQuery('[data-refresh-balance="'+n.tokenAddress+'"]').addClass("rotating"),r.eventDispatcher.waitForAllEvents(["dexBalanceLoaded."+n.tokenAddress,"walletBalanceLoaded."+n.tokenAddress],function(){let o=n.dex.toFixed(),a=n.wallet.toFixed();n.isNullBalance="0"===o&&"0"===a,!0!==n.refreshFlag||e!==o||t!==a||n.isNullBalance?(n.refreshFlag=!1,r.eventDispatcher.trigger("balanceLoaded",{tokenAddress:n.tokenAddress,sortAfter:n.sortAfter})):setTimeout(n.refreshable,5e3)})},this.refreshable=function(){n.refreshFlag=!0,n.load()},this.refresh=function(){n.refreshFlag=!1,n.sortAfter=!1,n.load()},this.refreshAllowance=function(e){this.token.contract().allowance(n.accountAddress,r.dexVault.contract.contractAddress,function(t,r){t||(n.allowance=Formatter.bigNumberFormatForApi(r,n.token.decimals)),"function"==typeof e&&e.call(null)})}},DexStorage=function(e){this.prefix=e||"",this.hasLocalStorage=!1,this.hasSessionStorage=!1,this.data={},window.localStorage&&(this.hasLocalStorage=!0),window.sessionStorage&&(this.hasSessionStorage=!0),this.getItem=function(e,t){return e=this.prefix+e,t=void 0!==t?t:null,this.hasLocalStorage?window.localStorage.getItem(e)||t:this.hasSessionStorage?window.sessionStorage.getItem(e)||t:void 0!==this.data[e]?this.data[e]:t},this.setItem=function(e,t){return e=this.prefix+e,this.hasLocalStorage?window.localStorage.setItem(e,t):this.hasSessionStorage?window.sessionStorage.setItem(e,t):void(this.data[e]=t)},this.clear=function(){return this.hasLocalStorage?window.localStorage.clear():this.hasSessionStorage?window.sessionStorage.clear():void(this.data={})},this.removeItem=function(e){return e=this.prefix+e,this.hasLocalStorage?window.localStorage.removeItem(e):this.hasSessionStorage?window.sessionStorage.removeItem(e):void(void 0!==this.data[e]&&delete this.data[e])}},DexOrderExpireObserver=function(e){let t=this,r=(jQuery("body"),{}),n=null;this.controller=e,this.addOrder=function(e){r[e.signature]=new Date(e.expire).getTime()},this.observe=function(){n||(n=setInterval(function(){!function(){let e=(new Date).getTime();for(let n in r){let o=r[n];(o+=referenceTime)<e&&(t.controller.eventDispatcher.trigger("expiredOrder."+n),delete r[n])}}()},1e3))},this.controller.eventDispatcher.listen("marketChanged",function(){r={},clearInterval(n),n=null})},DexRendererFactory=function(e,t,r){this.data=e,this.type=t,this.controller=r,this.renderers={loadMarket:{orders:[DexOrdersRenderer],trades:[DexTradesRenderer],myOrders:[DexMyOrdersRenderer],myTrades:[DexMyTradesRenderer],myTransfers:[DexMyFundsRenderer],tickers:[DexTickersRenderer,DexPopupTickersRenderer]},loadHistory:{myOrders:[DexMyOrdersHistoryRenderer],myTrades:[DexMyTradesHistoryRenderer],myTransfers:[DexMyFundsHistoryRenderer]}},this.create=function(){if(this.data)for(var e in this.data)for(let t of this.renderers[this.type][e])new t(this.data[e],this.controller).render()}},DexFees=function(e){let t=this,r=jQuery("body");this.controller=e,this.market=this.controller.selectedMarket,this.eth={},this.baseToken={},this.quoteToken={},r.on("click",".action-about-fees",function(){let e,r,n,o,a,i;t.market=t.controller.selectedMarket,n=t.market.baseCurrency.depositFeeRate,o=t.market.baseCurrency.withdrawFeeRate,a=t.market.quoteCurrency.depositFeeRate,i=t.market.quoteCurrency.withdrawFeeRate,e=t.market.takeFeeRate,r=t.market.makeFeeRate;let l={takeFee:Formatter.percent(e),makeFee:Formatter.percent(r),baseDepositFee:Formatter.percent(n),baseWithdrawFee:Formatter.percent(o),quoteDepositFee:Formatter.percent(a),quoteWithdrawFee:Formatter.percent(i),baseTokenSymbol:t.controller.selectedMarket.baseCurrency.symbol,quoteTokenSymbol:t.controller.selectedMarket.quoteCurrency.symbol},s=new DexTemplate("fee-popup");s.replace(l),new Modal({title:dexLang.t("text_about_fees"),content:s.content}),t.controller.tracking.log(3,31)})},DexUser=function(e){let t=this,r=jQuery("body");this.controller=e,this.storageKey="DexData",this.accounts={},this.selectedAccount=null,this.metamaskInterval=null,this.hasAccount=function(){return!jQuery.isEmptyObject(this.accounts)},this.hasSelectedAccount=function(){return null!==this.selectedAccount},this.getMetamaskStatus=function(){return web3.currentProvider&&web3.currentProvider.isMetaMask},this.refreshMetamaskAccounts=function(e){web3.eth.getAccounts(e)},this.hasMetamaskAccount=function(){return web3.currentProvider&&0!==web3.eth.accounts.length},this.isValidAddress=function(e){return void 0!==t.controller.initialAccounts[e]},this.getAccountCnt=function(){return Object.keys(t.accounts).length},this.getMetamaskAddress=function(){return this.hasMetamaskAccount()?ethereumjs.Util.toChecksumAddress(web3.eth.accounts[0].toString("hex")):null},this.checkUserKyc=function(e){let r=!1,n="not-approved";return e=e||!1,jQuery.ajax({url:"/dex-v2/check-kyc",data:{},dataType:"json",async:!1,success:function(e){r="approved"===e.result,n=e.result}}),r||("pending"===n?setTimeout(function(){swal({title:dexLang.t("title_dear_customer"),text:dexLang.t("text_review_kyc"),icon:"error"},function(e){e&&(jQuery(".logo-action").trigger("click"),t.controller.helper.closeModal())})},1e3):setTimeout(function(){swal({title:dexLang.t("title_dear_customer"),text:dexLang.t("text_complete_kyc"),icon:"error"},function(e){e&&(jQuery(".logo-action").trigger("click"),t.controller.helper.closeModal())})},1e3)),e?n:r},this.storeToStorage=function(){let r={};for(let e in t.accounts){let n=t.accounts[e];r[e]=n.toStorage()}let n={accounts:r};e.storage.setItem(t.storageKey,JSON.stringify(n))},this.changeAccount=function(e,r){if(r=r||!1,t.getMetamaskStatus()){if(null!==t.selectedAccount&&t.selectedAccount.metamask&&t.accounts[e].metamask&&!r)return void new Modal({title:dexLang.t("title_warning"),content:dexLang.t("text_change_account_metamask_metamask")})}else if(void 0!==t.accounts[e]&&t.accounts[e].metamask)return void new Modal({title:dexLang.t("title_warning"),content:new DexTemplate("add-metamask-warning").content});this.setSelectedAccount(e),t.controller.userMenuRenderer.render(),this.controller.balanceRenderer.render(),this.storeToStorage(),this.watchMetamaskAccountChange(),this.selectedAccount.metamask||null!==this.selectedAccount.pk||new DexImportAccountPkFormRenderer(t.controller,this.selectedAccount.address,function(){t.controller.helper.closeModal()}).render()},this.setSelectedAccount=function(e){this.selectedAccount=this.accounts[e],dexEth.setAccount(this.selectedAccount.address,this.selectedAccount.pk),this.controller.api.setUserAddress(this.selectedAccount.address),this.controller.tokenPrices?this.selectedAccount.loadBalances():this.controller.eventDispatcher.listen("tokenPricesLoaded",function(){t.selectedAccount.loadBalances()}),t.controller.storage.setItem("selectedAddress",e),t.controller.eventDispatcher.trigger("user-has-account")},this.privacyPopup=function(e){e=e||!1,t.controller.storage.getItem("no-account-popup")&&!e||new DexPrivacyFormRenderer(t.controller).render()},this.changeToValidMetamaskPopupFlag=!1,this.watchLoggedMetamask=!1,this.watchMetamaskAccountChange=function(){this.getMetamaskStatus()&&(clearInterval(this.metamaskInterval),this.metamaskInterval=setInterval(function(){t.refreshMetamaskAccounts(function(){if(t.hasMetamaskAccount()){t.watchLoggedMetamask&&(t.controller.helper.closeModal(),t.watchLoggedMetamask=!1);let e=t.getMetamaskAddress();if(t.isValidAddress(e))!0===t.changeToValidMetamaskPopupFlag&&t.controller.helper.closeModal(),t.changeToValidMetamaskPopupFlag=!1,null===t.selectedAccount?(t.accounts[e]=new DexUserAccount({address:e,privateKey:null,metamask:!0,type:"metamask",isNew:!0},t.controller),t.changeAccount(e,!0),t.controller.initPage(),t.controller.helper.closeModal()):e!==t.selectedAccount.address&&(void 0===t.accounts[e]&&(t.accounts[e]=new DexUserAccount({address:e,privateKey:null,metamask:!0,type:"metamask",isNew:!0},t.controller)),t.selectedAccount.metamask&&(t.changeAccount(e,!0),t.controller.initPage(),t.controller.helper.closeModal()));else if(!t.changeToValidMetamaskPopupFlag){t.changeToValidMetamaskPopupFlag=!0;for(let e in t.controller.initialAccounts){let r=t.controller.initialAccounts[e];if(t.accounts[e]=new DexUserAccount({address:e,privateKey:null,metamask:r.metamask,type:r.type,isNew:!0},t.controller),t.controller.userMenuRenderer.render(),r.metamask){new Modal({title:dexLang.t("title_warning"),content:dexLang.t("text_change_account_metamask",{account:e})});break}}}}else t.selectedAccount.metamask&&(t.watchLoggedMetamask=!0,new Modal({title:dexLang.t("title_important"),content:dexLang.t("text_metamask_init"),unClosable:!0}))})},1e3))};let n=e.storage.getItem(this.storageKey);null!==n&&(n=JSON.parse(n));for(let e in t.controller.initialAccounts){let r=null,o=t.controller.initialAccounts[e];null!==n&&void 0!==n.accounts[e]&&(r=n.accounts[e].pk),t.accounts[e]=new DexUserAccount({address:e,privateKey:r,metamask:o.metamask,type:o.type,isNew:!1},t.controller)}t.getMetamaskStatus()&&(this.hasMetamaskAccount()&&web3.eth.accounts.forEach(function(e){e=ethereumjs.Util.toChecksumAddress(e.toString("hex"));t.isValidAddress(e)&&void 0===t.accounts[e]&&(t.accounts[e]=new DexUserAccount({address:e,privateKey:null,metamask:!0,type:"metamask",isNew:!0},t.controller))}),web3.version.getNetwork((e,r)=>{r=parseInt(r),"csr.live"===window.location.host&&1!==r?t.showNetworkAlert(r,1):"csr.live"!==window.location.host&&3!==r&&t.showNetworkAlert(r,3)}),this.watchMetamaskAccountChange()),this.showNetworkAlert=function(e,t){$.getJSON("https://chainid.network/chains.json",function(r){let n=targetNetwork=dexLang.t("text_unknown_network");for(let o in r)r[o].chainId==e&&(n=r[o].name),r[o].chainId==t&&(targetNetwork=r[o].name);new Modal({title:dexLang.t("title_error"),content:dexLang.t("text_wrong_network",{currentNetwork:'<span class="text-danger"><strong>'+n+"</strong></span>",targetNetwork:'<span class="text-success"><strong>'+targetNetwork+"</strong></span>"})})})},this.postInstantiate=function(){if(t.hasAccount()){let e=t.controller.storage.getItem("selectedAddress",!1);if(e&&(t.isValidAddress(e)||(e=!1)),t.getMetamaskStatus()&&!e&&t.hasMetamaskAccount()&&(e=t.getMetamaskAddress(),t.isValidAddress(e)||(e=!1)),!e)for(let t in this.accounts)this.accounts[t].metamask||(e=t);e&&t.changeAccount(e),1===t.getAccountCnt()&&t.hasMetamaskAccount()&&!t.getMetamaskStatus()?new Modal({title:dexLang.t("title_warning"),content:new DexTemplate("add-metamask-warning").content,afterClose:function(){window.history.back()}}):e?t.privacyPopup():new Modal({title:dexLang.t("title_warning"),content:new DexTemplate("add-metamask-warning").content,afterClose:function(){t.privacyPopup()}})}else r.addClass("no-account"),t.controller.eventDispatcher.trigger("user-has-no-account"),t.selectedAccount=new DexUserAccount({type:"guest"},t.controller),t.controller.tokenPrices?(t.controller.balanceRenderer.render(),t.selectedAccount.loadBalances()):this.controller.eventDispatcher.listen("tokenPricesLoaded",function(){t.controller.balanceRenderer.render(),t.selectedAccount.loadBalances()}),t.privacyPopup();t.controller.eventDispatcher.trigger("user-post-instantitiate")},r.on("click",".action-download-metamask",function(){t.controller.tracking.log(4,43)}),t.controller.eventDispatcher.listen("user-has-no-account",function(){if(t.getMetamaskStatus())for(let e in t.controller.initialAccounts){if(t.controller.initialAccounts[e].metamask){new Modal({title:dexLang.t("title_warning"),content:dexLang.t("text_change_account_metamask",{account:e})});break}}})},DexUserAccount=function(e,t){let r=this;this.address=e.address,this.metamask=e.metamask||!1,this.pk=e.privateKey,this.allowance=null,this.type=e.type,this.isNew=e.isNew||!1,this.balances={},this.loadBalances=function(){let e=Object.keys(t.tokens);for(let r=0;r<e.length;r+=100){dexEth.defer(!0);let n=e.slice(r,r+100);for(let e=0;e<n.length;e++){let r=n[e];this.balances[r]=new DexBalance(this.address,r,t),this.balances[r].load()}dexEth.defer(!1)}},this.refreshAll=function(){this.balances={},this.loadBalances()},this.refreshBalancesForCurrentMarket=function(){this.refreshBalanceByAddress([t.selectedMarket.baseCurrencyAddress,t.selectedMarket.quoteCurrencyAddress])},this.refreshBalanceByAddress=function(e){let t;(t=e instanceof Array?e:new Array(e)).forEach(function(e){r.balances[e]&&r.balances[e].refresh()})},this.toStorage=function(){return{address:r.address,metamask:r.metamask,pk:r.pk,isNew:r.isNew,allowance:r.allowance}},this.isGuest=function(){return"guest"===r.type}},DexForm=function(e,t){let r=this;this.form=e instanceof jQuery?e:jQuery(e),this.defaults={},this.rules=t,this.allInputs=this.form.find("input, textarea, select"),this.allInputs.each(function(e,t){let n=r.form.attr("id")+"-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,8);void 0===t.id?t.id=n:n=t.id,r.defaults[n]=t.value}),this.setInputChanged=function(){r.allInputs.each(function(e,t){let n=jQuery(t);n.hasClass("changed")||r.defaults[t.id]!==t.value&&n.addClass("changed")})},this.validate=function(e){let t;return e=e||!1,t=new DexFormValidator(this.rules,e?this.serializeForm():this.serializeChangedForm()),this.clearFormError(),!!t.validate()||(new DexFormErrorRenderer(t.getErrors(),this.form).render(),!1)},this.serializeChangedForm=function(){this.setInputChanged();let e={};return this.form.serializeArray().map(function(t){jQuery(t).hasClass("changed")&&(e[t.name]=t.value)}),e},this.serializeForm=function(){let e={};return this.form.serializeArray().map(function(t){e[t.name]=t.value}),e},this.clearFormError=function(){this.form.find(".has-error").removeClass("has-error"),this.form.find(".help-block").text("")},this.disableFormInputs=function(){this.form.find(".form-control, .btn").prop("disabled",!0)}},DexFormValidator=function(e,t){let r=this;this.errors={},this.requiredFields=[],this.validate=function(){return jQuery(e).each(function(e,t){let n=t[0];"required"===t[1]&&(n instanceof Array?n.forEach(function(e){r.requiredFields.push(e)}):r.requiredFields.push(n))}),jQuery(e).each(function(e,t){let n=t[0],o=t[1],a=t[2];n instanceof Array?n.forEach(function(e){r.validateField(e,o,a)}):r.validateField(n,o,a)}),jQuery.isEmptyObject(this.errors)},this.validateField=function(e,n,o){let a=jQuery.inArray(e,r.requiredFields)>-1,i=t[e],l=!1;if(void 0!==t[e]&&(a||!a&&""!==i))if("function"==typeof n)l=n(i),this.parseValidatorResult(l,o)||(r.errors[e]=this.getMessage(l,o));else if("string"==typeof n)l=r[n](i),this.parseValidatorResult(l,o)||(r.errors[e]=this.getMessage(l,o));else{let t=n.validatorName,a=n.params;l=r[t](i,a),this.parseValidatorResult(l,o)||void 0===r.errors[e]&&(r.errors[e]=this.getMessage(l,o))}},this.parseValidatorResult=function(e,t){return"boolean"==typeof e?e:"object"==typeof t&&"string"==typeof e&&void 0===t[e]},this.getMessage=function(e,t){return"object"==typeof t?t[e]?t[e]:JSON.stringify(t):"function"==typeof t?t():t},this.getErrors=function(){return r.errors},this.number=function(e){return e=Formatter.sanitizeInputNumber(e),!isNaN(parseFloat(e))&&isFinite(e)},this.address=function(e){return!!/^0x[0-9a-fA-F]{40}$/i.test(e)},this.privateKey=function(e){return!!/^(0x)?[0-9a-f]{64}$/i.test(e)},this.integer=function(e){return/^\+?(0|[0-9]\d*)$/.test(e)},this.lower=function(e,t){return e=Formatter.sanitizeInputNumber(e),parseFloat(e)<parseFloat(t.value)},this.lowerEqual=function(e,t){return e=Formatter.sanitizeInputNumber(e),parseFloat(e)<=parseFloat(t.value)},this.greater=function(e,t){return e=Formatter.sanitizeInputNumber(e),parseFloat(e)>parseFloat(t.value)},this.greaterEqual=function(e,t){return e=Formatter.sanitizeInputNumber(e),parseFloat(e)>=parseFloat(t.value)},this.equal=function(e,t){return e===t.value},this.in=function(e,t){return jQuery.inArray(e,t)>-1},this.required=function(e){return""!==e},this.notNull=function(e){return 0!==parseFloat(e)},this.checkUserKyc=function(e,t){return t.user.checkUserKyc(!0)}},DexFormErrorRenderer=function(e,t){this.container=t instanceof jQuery?t:jQuery(t),this.render=function(){for(let t in e){let r=this.container.find('[name="'+t+'"]'),n=(r=jQuery(r)).closest(".form-group");n.addClass("has-error"),n.find(".help-block").text(e[t])}}},DexEventDispatcher=function(){let e=this,t=jQuery("body"),r=[];this.listen=function(e,r){t.on(e,r)},this.ignore=function(e){t.off(e)},this.trigger=function(r,n){r&&(n=n||{},t.trigger(r,n),e.checkWaitFor(r,n))},this.waitForAllEvents=function(e,t,n){n=n||[],r.push([e,t,n])},this.checkWaitFor=function(e,t){r.forEach(function(n,o){if(void 0!==r[o]){r[o][0].indexOf(e)>=0&&(r[o][0]=r[o][0].filter(function(t){return t!==e}),jQuery.isEmptyObject(t)||r[o][2].push(t),0===r[o][0].length&&(r[o][1].call(null,[r[o][2]]),r=r.filter(function(e){return 0!==e[0].length})))}})}};const GASSETTYPE_AUTOMATIC="automatic",GASSETTYPE_MANUAL="manual",GASTYPE_SAFELOW="safelow",GASTYPE_STANDARD="standard",GASTYPE_FAST="fast";var DexGasApi=function(e){let t=this,r=jQuery("body");this.controller=e,this.apiUrl="https://ethgasstation.info/json/ethgasAPI.json",this.standard=null,this.fast=null,this.safelow=null,this.block_time=null,this.fastestWait=null,this.fastWait=null,this.safeLowWait=null,this.blockNum=null,this.avgWait=null,this.speed=null,this.fastest=null,this.blockTimeStack=[];let n=JSON.stringify({gasSetType:GASSETTYPE_AUTOMATIC,gasType:GASTYPE_FAST,gasPrice:4e9,gasMultiplier:1});this.settings=JSON.parse(this.controller.storage.getItem("gasSettings",n)),this.load=function(e){e=e||function(){},jQuery.ajax({dataType:"json",url:this.apiUrl,data:{},async:!1,success:function(r){r&&(t.standard=web3.toWei(r.average/10,"gwei"),t.safelow=web3.toWei(r.safeLow/10,"gwei"),t.fast=web3.toWei(r.fast/10,"gwei"),t.fastestWait=r.fastestWait,t.fastWait=r.fastWait,t.safeLowWait=r.safeLowWait,t.blockNum=r.blockNum,t.avgWait=r.avgWait,t.speed=r.speed,t.fastest=r.fastest,dexEth.gasPrice=t.settings.gasSetType===GASSETTYPE_MANUAL?t.settings.gasPrice:t[t.settings.gasType],dexEth.gasMultiplier=t.settings.gasMultiplier,"function"==typeof e&&e())}})},this.getGasPrice=function(){return t.settings.gasSetType===GASSETTYPE_MANUAL?t.settings.gasPrice:(this.load(),t[t.settings.gasType])},this.load(),this.setGasPrice=function(){this.load(function(){if(t.controller.helper.loginConfirmPopup()){let e=new DexGasPriceFormRenderer(t.controller);new Modal({title:dexLang.t("title_set_gas_price"),content:e.render()}),e.afterRender()}})},r.on("click",".action-set-gas-price",function(){t.setGasPrice()})},DexPageController=function(e){let t=jQuery("body"),r=jQuery(window),n=this;this.renderers={},this.isDev=e.isDev||!1,this.helper=new DexHelper(this),this.dexName=e.dexName||"Dex",this.initialAccounts=e.initialAccounts||{},this.apiUrl=e.apiUrl,this.minAmount=e.minAmount||.001,this.storage=new DexStorage("Dex"),this.defaultMarket=e.defaultMarket||"",this.multitradeEnabled=e.multitradeEnabled||!1,this.multitradeStatus=!1,this.multicancelEnabled=e.multicancelEnabled||!1,this.multicancelStatus=!1,this.multifundsEnabled=e.multifundsEnabled||!1,this.multiwithdrawStatus=!1,this.multidepositStatus=!1,this.massOrderEnabled=e.massOrderEnabled||!1,this.showUserNames=e.showUserNames||!1;let o=this.storage.getItem("selectedMarket")||this.defaultMarket;this.tokens={},this.markets={},this.wrappedTokens={},this.symbolToAddr={},this.directToMarket=!1,function(e,t){for(let r in t.tokens)e.tokens[r]=new DexToken(r,t.tokens[r],e),e.symbolToAddr[e.tokens[r].symbol]=r,e.tokens[r].isWrapped&&(e.wrappedTokens[r]=e.tokens[r])}(n,e),function(e,t){for(let r in t.markets)null!==t.markets[r].quoteCurrencyAddress&&(e.markets[r]=new DexMarket(r,t.markets[r],e))}(n,e),""!==location.hash&&(o=location.hash.substr(1),this.directToMarket=!0),this.filterTokenAddress=void 0!==this.tokens[e.filterTokenAddress]?this.tokens[e.filterTokenAddress].address:null,this.selectedMarket=void 0!==this.markets[o]?this.markets[o]:this.markets[this.defaultMarket],this.tokenPrices=null,this.fiatPrices=null,this.cryptoPrices=null,this.eventDispatcher=new DexEventDispatcher,this.gasPrice=null,this.gasApi=new DexGasApi(this),this.marketsRenderer=new DexMarketsRenderer(this),this.balanceRenderer=this.multifundsEnabled?new DexMultiMyBalanceRenderer(this):new DexMyBalanceRenderer(this),this.marketSelectorRenderer=new DexMarketDropdownRenderer(this),this.myTransactionsRenderer=new DexMyTransactionsRenderer(this),this.currencySelector=new DexCurrencySelectorRenderer(this),this.orderExpireObserver=new DexOrderExpireObserver(this),this.tracking=new DexTracking,this.getCurrentMarketName=function(){return this.selectedMarket.name},this.getMarket=function(e){return this.markets[e]?this.markets[e]:null},this.getMarketByAddresses=function(e,t){if(n.tokens[e]&&n.tokens[t]){let r=n.tokens[e].symbol+"-"+n.tokens[t].symbol;return n.getMarket(r)}},this.chartsTradesVolumeRenderer=new DexChartsTradesVolumeRenderer(this),this.priceChartRenderer=new DexPriceChartRenderer(this),this.depthChartRenderer=new DexDepthChartRenderer(this),this.dexPriceChartDataCache=[],this.dexDepthChartDataCache={},this.orderPlacedCounter=0,this.resetCachedCartData=function(){n.dexPriceChartDataCache=[],n.dexDepthChartDataCache={buy:{},sell:{}}},this.resetCachedCartData(),this.handleOnLoadMarket=function(e){new DexRendererFactory(e,"loadMarket",n).create(),n.tracking.log(4,42,n.selectedMarket.id)},this.handleOnLoadHistory=function(e){if(!n.switchController.isOnExchangePage()){new DexRendererFactory(e,"loadHistory",n).create()}},this.handleOnLoadOrders=function(e){n.marketsRenderer.setData(e),n.marketsRenderer.render()},this.handleOnLoadPrices=function(e){null===n.tokenPrices?(void 0!==e.fiat&&(n.fiatPrices=new DexFiatPrices(e.fiat,n),n.eventDispatcher.trigger("fiatPricesLoaded")),void 0!==e.eth_token&&(n.tokenPrices=new DexTokenPrices(e.eth_token,n),n.eventDispatcher.trigger("tokenPricesLoaded")),void 0!==e.crypto&&(n.cryptoPrices=new DexCryptoPrices(e.crypto,n),n.eventDispatcher.trigger("cryptoPricesLoaded"))):(void 0!==e.eth_token&&n.tokenPrices.refreshPrices(e.eth_token),void 0!==e.fiat&&n.fiatPrices.refreshPrices(e.fiat),void 0!==e.crypto&&n.cryptoPrices.refreshPrices(e.crypto))},this.handleOnRefresh=function(){new DexRefreshRenderer(n)},this.initMarketSelector=function(){this.marketSelectorRenderer.render()},this.resetPage=function(){jQuery('[data-reset-page="1"]').html(""),jQuery(".loading.loaded").removeClass("loaded")},this.eventDispatcher.listen("moduleRendered",function(e,t){t.container.closest(".module").addClass("loaded")}),this.dexExchange=window.dexExchange,this.dexVault=window.dexVault,this.api=new DexApi({url:this.apiUrl,contractAddress:n.dexExchange.contract.contractAddress,userAddress:window.dexEth.userAddress}),this.api.addEventHandler("getMarket",this.handleOnLoadMarket),this.api.addEventHandler("getHistory",this.handleOnLoadHistory),this.api.addEventHandler("getOrders",this.handleOnLoadOrders),this.api.addEventHandler("getPrices",this.handleOnLoadPrices),this.api.addEventHandler("refresh",this.handleOnRefresh),this.loadMarket=function(e){n.api.getMarket(e.baseCurrencyAddress,e.quoteCurrencyAddress,31104e3,function(e,t){e||n.handleOnLoadMarket(t)})},this.loadHistory=function(){n.api.getHistory(function(e,t){e||n.handleOnLoadHistory(t)})},this.loadOrders=function(){n.api.getOrders(function(e,t){e||n.handleOnLoadOrders(t)})},this.loadPrices=function(){n.api.getPrices(function(e,t){e||n.handleOnLoadPrices(t)})},this.user=new DexUser(this),this.user.hasAccount()&&window.dexEth.setAccount(this.user.address),this.switchController=new DexSwitchController(this),this.mobileTabController=new DexMobileTabController(this),this.userMenuRenderer=new DexUserMenuRenderer(this.user,this),this.initPage=function(){n.resetPage(),n.resetCachedCartData(),n.myTransactionsRenderer.render(),this.directToMarket?null===n.tokenPrices?n.eventDispatcher.listen("tokenPricesLoaded",function(){n.directToMarket=!1,n.changeMarket(n.selectedMarket.id)}):(n.directToMarket=!1,n.changeMarket(n.selectedMarket.id)):(n.switchController.isOnExchangePage()?this.loadMarket(n.selectedMarket):n.loadHistory(),n.loadOrders())},this.api.ws.onopen=function(){n.initPage(),n.loadPrices()},this.fees=new DexFees(this),this.refreshBalancesForCurrentMarket=function(){n.user.hasAccount()&&n.user.selectedAccount.refreshBalancesForCurrentMarket()},this.user.postInstantiate(),this.changeMarketType="buy",this.changeMarket=function(e){let t=n.markets[e]?n.markets[e]:null;t.isEnabled&&t.isVisible?(jQuery('#orderbookTab a[href="#'+n.changeMarketType+'List"]').trigger("click"),n.selectedMarket=t,n.storage.setItem("selectedMarket",t.id),n.eventDispatcher.trigger("marketChanged"),n.initPage(),n.initMarketSelector(),n.refreshBalancesForCurrentMarket(),new DexTokenGuidesRenderer(n).render()):swal({title:dexLang.t("title_error"),text:dexLang.t("errmsg_invalid_market"),icon:"error"})},this.changeLocationHash=function(e){e===window.location.hash?r.trigger("hashchange"):window.location.hash=e},t.on("click",".change-market",function(){let e=jQuery(this).data("market-id"),t=jQuery(this).data("type");n.changeMarketType=jQuery.inArray(t,["buy","sell"]>-1)?t:"buy";let r="#"+e;n.changeLocationHash(r)}),this.userMenuRenderer.render(),r.on("hashchange",function(e){if(""!==location.hash){let e=location.hash.substr(1);n.changeMarket(e)}else jQuery(".logo-action").trigger("click")}),this.eventDispatcher.listen("pageStateChanged",function(){n.myTransactionsRenderer.render(),n.switchController.isOnExchangePage()?jQuery(".header-toggle-container-on-market:visible").fadeOut(200,function(){jQuery(".header-toggle-container-on-exchange:hidden").fadeIn(200)}):(jQuery(".header-toggle-container-on-exchange:visible").fadeOut(200,function(){jQuery(".header-toggle-container-on-market:hidden").fadeIn(200)}),n.loadHistory())}),this.eventDispatcher.listen("tokenPricesLoaded",function(){n.currencySelector.render()}),this.eventDispatcher.listen("user-has-no-account",function(){t.addClass("no-account"),n.balanceRenderer.render()}),this.eventDispatcher.listen("user-has-account",function(){t.removeClass("no-account")}),this.eventDispatcher.listen("marketChanged",function(){n.orderPlacedCounter=0}),setInterval(function(){jQuery(".personal [data-auto-update-time], .exchange [data-auto-update-time], .my-trades [data-auto-update-time]").each(function(e,t){let r=jQuery(t),n=r.data("auto-update-time");r.text(Formatter.dateDiff(n))})},1e3),t.off("click.newOrder"),t.on("click.newOrder",".new-order-button",function(){if(n.helper.loginConfirmPopup()){let e=jQuery(this).data("event-type"),t="no-market";if(n.switchController.isOnExchangePage()){let e=jQuery("#orderbookTab").find("li.active").data("order-type");new DexNewOrderPopupRenderer(n,n.selectedMarket,e).render(),t=n.selectedMarket.name}else{let e=jQuery(this).data("market-id");void 0===n.markets[e]?new DexNewOrderChooseMarketPopupRenderer(n).render():(new DexNewOrderPopupRenderer(n,n.markets[e]).render(),t=e.name)}n.tracking.log(4,41,t,e)}}),t.off("click.copyText"),t.on("click.copyText","[data-copy-text]",function(e){e.stopPropagation();let t=jQuery(this),r=t.data("copy-text"),o=n.helper.getRandomString();t.after('<input id="'+o+'">');let a=jQuery("#"+o);a.css({position:"absolute",left:-9999}),a.val(r),n.helper.copyFromElementToClipboard(a[0]),a.remove()}),t.on("mouseenter","[data-symbol-hover]",function(){let e=jQuery(this),t=e.data("symbol-hover"),r="",o="top";"-"!==t&&"+"!==t||(o="-"===t?"bottom":"top",t=e.data("token-addr")),""===t&&(t=ETH_ADDRESS),void 0!==n.tokens[t]&&(r=n.tokens[t].name),e.data("addition-title")&&(r=r+" "+e.data("addition-title"))}),t.on("mouseenter","a.change-market",function(){let e=jQuery(this),t=e.data("token-addr"),r=e.data("token-addr-base"),o="";void 0!==n.tokens[t]&&void 0!==n.tokens[r]&&(o=n.tokens[t].name+"/"+n.tokens[r].name)}),t.on("keydown","[data-input-type]",function(e){let t=this.selectionStart!==this.selectionEnd;if((e.ctrlKey||e.metaKey)&&jQuery.inArray(e.keyCode,[67,86,88])>-1)return!0;let r=jQuery(this),o=jQuery(this).data("input-type"),a=jQuery(this).data("decimals"),i=-1;void 0!==n.tokens[o]&&(i=n.tokens[o].decimals),"number"===o&&a&&(i=a);let l=[8,9,13,16,17,18,35,36,37,38,39,40,45,46,225],s=[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105].concat(l),c=r.val(),d=c.indexOf(".");if(jQuery.inArray(e.keyCode,[108,188])>-1&&d<0&&r.val(r.val()+"."),jQuery.inArray(e.keyCode,[192])>-1&&r.val(r.val()+"0"),!t)if(i>0)if(d<0)s.push(190);else{if(c.substr(d).length>i&&this.selectionStart>d)return jQuery.inArray(e.keyCode,l)>-1}else 0!==i&&d<0&&s.push(190);return jQuery.inArray(e.keyCode,s)>-1}),jQuery("div > .info-box").parent().on("mouseenter",function(){let e=jQuery(this),t=parseInt(e.data("shake"))||0;t%3==0&&e.find(".info-box-help-toggle").effect("shake",{distance:2}),t+=1,e.data("shake",t)})};