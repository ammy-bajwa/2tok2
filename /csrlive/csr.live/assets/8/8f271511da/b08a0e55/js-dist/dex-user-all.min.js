var Modal=function(e,t){let n=this;this.title=e.title||"",this.content=e.content||"",this.size=e.size||"modal-md",this.noModalBodyPadding=e.noModalBodyPadding||!1,this.modalOptions=t||{},this.modalOptions.backdrop="static",this.afterClose=e.afterClose||null,this.afterShown=e.afterShown||null,this.unClosable=e.unClosable||!1;let a=jQuery("#modal"),r=jQuery("#modalHeaderTitle"),o=jQuery("#modalContent");a.off("hidden.bs.modal"),this.resetModalContent=function(){r.html(""),o.html(""),a.find(".modal-body").removeClass("no-padding"),a.find("button.close").show()},this.resetModalContent(),this.noModalBodyPadding&&a.find(".modal-body").addClass("no-padding"),r.html(this.title),o.html(this.content),a.modal(this.modalOptions),this.unClosable&&(a.off("keydown.dismiss.bs.modal"),a.find("button.close").hide()),jQuery("#modal .modal-dialog").removeClass("modal-md").addClass(this.size);let s=jQuery(".modal-body").find('[data-toggle="tooltip"]');s.length>0&&s.tooltip(),null!==this.afterClose&&a.on("hidden.bs.modal",function(){"function"==typeof n.afterClose&&n.afterClose()}),null!==this.afterShown&&a.on("shown.bs.modal",function(){"function"==typeof n.afterShown&&n.afterShown()})},DexNewAccountRenderer=function(e,t,n,a){let r=this;this.address=e,this.privateKey=t,this.template=new DexTemplate("new-account-popup"),this.controller=n,this.templateApprove=new DexTemplate("new-account-popup-approve"),this.form=null,this.formApporve=null,this.callback=a||function(){},this.validateAuthenticatorCode=function(e){let t=!1;return jQuery.ajax({url:"/wallet/default/validate-authenticator-code",type:"post",dataType:"json",async:!1,data:{csrfParam:yii.getCsrfToken(),authenticatorCode:e},success:function(e){t=e.result}}),t},this.rules=[[["confirm"],"required",dexLang.t("errmsg_must_confirm")],["confirm",{validatorName:"equal",params:{value:"accepted"}},dexLang.t("errmsg_must_confirm")]],this.rulesApprove=[[["privateKey"],"required",dexLang.t("errmsg_field_required")],["privateKey",{validatorName:"equal",params:{value:r.privateKey}},dexLang.t("errmsg_pk_invalid")]],this.render=function(){let e={address:this.address,privateKey:this.privateKey};this.template.replace(e),new Modal({title:dexLang.t("title_new_acc"),content:this.template.content}),r.form=new DexForm("#new-address-confirm-form",this.rules),jQuery("body").off("submit.new-address-confirm-form"),jQuery("body").on("submit.new-address-confirm-form","#new-address-confirm-form",function(){return r.form.validate(!0)&&r.renderApprove(),!1})},r.addressCreated=!1,this.renderApprove=function(){new Modal({title:dexLang.t("title_new_acc"),content:this.templateApprove.content,afterClose:function(){r.addressCreated&&new Modal({title:dexLang.t("title_address_added"),content:new DexTemplate("address-added").content})}}),r.formApporve=new DexForm("#new-address-confirm-form-approve",this.rulesApprove),jQuery("body").off("submit.new-address-confirm-form-approve"),jQuery("body").on("submit.new-address-confirm-form-approve","#new-address-confirm-form-approve",function(){return r.formApporve.validate(!0)&&(r.addressCreated=!0,r.controller.helper.closeModal(),r.callback()),!1})}},DexImportAccountFormRenderer=function(e,t){let n=this;this.controller=e,this.callback=t||function(){},this.template=new DexTemplate("import-account-form"),this.render=function(){return this.template.content},this.rules=[[["privateKey"],"required",dexLang.t("errmgs_field_required")],["privateKey","privateKey",dexLang.t("errmsg_pk_invalid")]],jQuery("body").off("submit.importaccountform"),jQuery("body").on("submit.importaccountform","#import-account-form",function(){let e=n.controller.helper.serializeForm(this),a=new DexFormValidator(n.rules,e);if(a.validate()){let a=0===e.privateKey.indexOf("0x")&&e.privateKey.length>64?e.privateKey.substring(2):e.privateKey,o=a.hex2bytes();var r=ethereumjs.Util.privateToAddress(o);r=ethereumjs.Util.toChecksumAddress(r.toString("hex"));let s=new DexUserAccount(r,a,!1,!0,n.controller);n.controller.user.accounts[r]=s,dexEth.setAccount(r,a);let i=n.controller.user.saveAddress(r,"imported");n.controller.user.storeToStorage(),n.controller.user.changeAccount(r),"function"==typeof t&&i&&t()}else new DexFormErrorRenderer(a.getErrors(),"#import-account-form").render();return!1})},DexImportAccountPkFormRenderer=function(e,t,n){let a=this;this.controller=e,this.address=t,this.callback=n||function(){},this.template=new DexTemplate("empty-account-pk-popup"),this.render=function(){this.template.replace("{address}",this.address),new Modal({title:"Import Private key",content:this.template.content})},this.rules=[[["privateKey"],"required",dexLang.t("errmgs_field_required")],["privateKey","privateKey",dexLang.t("errmsg_pk_invalid")]],jQuery("body").off("submit.importaccountpkform"),jQuery("body").on("submit.importaccountpkform","#import-pk-form",function(){let e=a.controller.helper.serializeForm(this),t=new DexFormValidator(a.rules,e);if(t.validate()){let t=a.address,r=0===e.privateKey.indexOf("0x")&&e.privateKey.length>64?e.privateKey.substring(2):e.privateKey,o=new DexUserAccount(t,r,!1,!0,a.controller);a.controller.user.accounts[t]=o,a.controller.user.storeToStorage(),a.controller.user.changeAccount(t),"function"==typeof n&&n()}else new DexFormErrorRenderer(t.getErrors(),"#import-pk-form").render();return!1})},DexForgetAccountRenderer=function(e,t){let n=this;this.controller=e,this.address=t,this.container=jQuery("body"),this.template=new DexTemplate("forget-account"),this.render=function(){let e={address:this.controller.user.accounts[n.address].address};return this.template.replace(e),this.template.content},this.container.off("submit.forgetaccount"),this.container.on("submit.forgetaccount","#forget-account",function(){return n.controller.user.doForgetAccount(n.address),n.controller.helper.closeModal(),!1})},DexDetectedMetamaskRenderer=function(e){this.controller=e,this.container=jQuery("#detected-new-metamask-account-container"),this.template=new DexTemplate("detected-metamask-login"),this.render=function(){let e={address:this.address};this.template.replace(e),this.container.html(this.template.content)}},DexDetectedNewMetamaskAccountRenderer=function(e,t){let n=this;this.address=t,this.controller=e,this.container=jQuery("#detected-new-metamask-account-container"),this.template=new DexTemplate("detected-new-metamask-account"),this.render=function(){let e={address:this.address};this.template.replace(e),this.container.html(this.template.content)},this.container.off("click.import-new-metamask-account"),this.container.on("click.import-new-metamask-account","#import-new-metamask-ok",function(){n.controller.helper.loginConfirmPopup(["address"])&&authenticateUser2fa("add_crypto_address",function(){n.controller.user.accounts[t]=new DexUserAccount(t,null,!0,!0,n.controller),dexEth.setAccount(t,null),n.controller.user.saveAddress(n.address,"metamask"),n.container.html("")})})},DexMyBalanceItemRenderer=function(e,t){let n=this;this.controller=t,this.tokenAddress=e,this.template=new DexTemplate("my-balance-item"),this.container=jQuery("#myBalanceContainer"),this.render=function(){let e,t,a,r,o,s=this.controller.user.selectedAccount.balances[this.tokenAddress];if(s.isNullBalance&&!s.isPrimary&&n.controller.hideNullBalances)return;e=this.controller.tokens[this.tokenAddress].symbol,a=this.controller.tokens[this.tokenAddress].name,o=this.controller.tokens[this.tokenAddress].decimals,t=e.toLowerCase(),r=a.toLowerCase();let i={tokenAddress:this.tokenAddress,tokenSymbol:e,tokenName:a,tokenSymbolLower:t,tokenNameLower:r,walletTokenBalance:Formatter.formatForDisplay(s.wallet,o),disabled:this.controller.tokens[this.tokenAddress].isDepositEnabled?"":"disabled"};this.template.replace(i);let l=this.container.find('[data-token-address="'+this.tokenAddress+'"]');if(l.length>0){let e=l.is(":visible");l.replaceWith(this.template.content),e&&this.container.find('[data-token-address="'+this.tokenAddress+'"]').show()}else this.container.append(this.template.content)},this.controller.eventDispatcher.listen("account-change",function(){n.container.find(".refresh-balance").addClass("rotating")})},DexMyBalanceRenderer=function(e){let t=this;this.controller=e,this.template=new DexTemplate("my-balance"),this.templateNoAccount=new DexTemplate("my-balance-no-account"),this.container=jQuery("#myBalanceContainer"),this.containerBalances=null,this.render=function(){this.controller.user.hasAccount()&&(this.container.html(this.template.content),this.controller.eventDispatcher.ignore("balanceLoaded"),this.controller.eventDispatcher.listen("balanceLoaded",function(e,n){new DexMyBalanceItemRenderer(n.tokenAddress,t.controller).render(),t.controller.eventDispatcher.trigger("balanceRendered"+n.tokenAddress)}),this.refreshAll())},this.allEvents=[];for(let e in this.controller.tokens)this.allEvents.push("balanceRendered"+e);this.refreshAll=function(){this.controller.eventDispatcher.waitForAllEvents(this.allEvents,function(){t.controller.eventDispatcher.trigger("tokenPricesRefreshed")})},this.container.off("click.refresh-balance"),this.container.on("click.refresh-balance",".refresh-balance",function(){let e=jQuery(this).parents(".account-balance").data("token-address");e&&(jQuery(this).addClass("rotating"),t.controller.user.selectedAccount.balances[e].load())})},DexBalance=function(e,t,n){let a=this;this.accountAddress=e,this.tokenAddress=t,this.token=n.tokens[this.tokenAddress],this.wallet=new DexTokenValue(web3.toBigNumber(0),this.tokenAddress,n),this.allowance=null,this.isNullBalance=!0,this.isPrimary=this.token.isQuoteToken,this.refreshFlag=!1,this.sortAfter=!0,this.load=function(){a.refreshBalances(),a.tokenAddress===n.helper.ethAddress?dexEth.call("eth_getBalance",[a.accountAddress,"latest"],function(e,t){e||(a.wallet=new DexTokenValue(t,a.tokenAddress,n),n.eventDispatcher.trigger("walletBalanceLoaded."+a.tokenAddress))}):(this.token.contract().balanceOf(a.accountAddress,function(e,t){e||(a.wallet=new DexTokenValue(t,a.tokenAddress,n),n.eventDispatcher.trigger("walletBalanceLoaded."+a.tokenAddress))}),this.token.isDepositEnabled&&this.token.contract().allowance(a.accountAddress,n.dexVault.contract.contractAddress,function(e,t){e||(a.allowance=Formatter.bigNumberFormatForApi(t,a.token.decimals))}))},this.refreshBalances=function(){let e=a.wallet.toFixed();n.eventDispatcher.waitForAllEvents(["walletBalanceLoaded."+a.tokenAddress],function(){let t=a.wallet.toFixed();a.isNullBalance="0"===t,!0!==a.refreshFlag||e!==t||a.isNullBalance?(a.refreshFlag=!1,n.eventDispatcher.trigger("balanceLoaded",{tokenAddress:a.tokenAddress,sortAfter:a.sortAfter})):setTimeout(a.refreshable,5e3)})},this.refreshable=function(){a.refreshFlag=!0,a.load()},this.refresh=function(){a.refreshFlag=!1,a.sortAfter=!1,a.load()}},Formatter={numbro:null,ethDecimals:18,timeZoneOffset:0,init:function(){this.numbro=numbro(0),this.timeZoneOffset=60*(new Date).getTimezoneOffset()},sanitizeInputNumber:function(e){return e.toString().replace(/[ ,]/,"")},price:function(e){return e=parseFloat(e),this.numbro.set(e),this.numbro.format({mantissa:9,thousandSeparated:!1})},symbolArr:{usd:{symbol:"$",template:"{symbol}{value}"},eur:{symbol:"€",template:"{symbol}{value}"},cny:{symbol:"¥",template:"{symbol}{value}"},jpy:{symbol:"¥",template:"{symbol}{value}"},krw:{symbol:"₩",template:"{symbol}{value}"},rub:{symbol:"₽",template:"{symbol}{value}"},sgd:{symbol:"S$",template:"{symbol}{value}"}},priceFiat:function(e,t,n){n=n||2,e=parseFloat(e);let a,r="{value} {symbol}",o="";return void 0!==this.symbolArr[t.toLowerCase()]?(o=this.symbolArr[t.toLowerCase()].symbol,r=this.symbolArr[t.toLowerCase()].template):o=t.toUpperCase(),e<.01&&0!=e&&(n=Math.abs(web3.toBigNumber(e).e)+1),this.numbro.set(e),a=this.numbro.format({mantissa:n}),r=(r=r.replace("{symbol}",o)).replace("{value}",a)},round:function(e,t){let n=Math.pow(10,t),a=e*n;return(a=Math.round(a))/n},volume:function(e){if(-1===(e=e.toString()).indexOf("."))return(e+=".000").substring(0,e.indexOf(".")+4);if(-1===e.indexOf("e")){let t=e.substring(e.indexOf("."));return t.padEnd(4,"0"),(e=e.substring(0,e.indexOf("."))+t).substring(0,e.indexOf(".")+4)}return e},percent:function(e){return this.numbro.set(e),this.numbro.format({output:"percent"})},int:function(e){return this.numbro.set(e),this.numbro.format({mantissa:0,thousandSeparated:!1})},date:function(e){return moment(e).format("MM-DD HH:mm:ss")},dateDiff:function(e){let t,n,a=parseInt((new Date).getTime()/1e3),r=parseInt(new Date(e).getTime()/1e3),o=a+referenceTime-r;return o>=31536e3?n=(t=parseInt(o/31536e3))>1?dexLang.t("text_x_years_ago"):dexLang.t("text_last_year"):o>=3024e3?n=(t=parseInt(o/3024e3))>1?dexLang.t("text_x_months_ago"):dexLang.t("text_last_month"):o>=604800?n=(t=parseInt(o/604800))>1?dexLang.t("text_x_weeks_ago"):dexLang.t("text_last_week"):o>=86400?n=(t=parseInt(o/86400))>1?dexLang.t("text_x_days_ago"):dexLang.t("text_yesterday"):o>=3600?n=(t=parseInt(o/3600))>1?dexLang.t("text_x_hours_ago"):dexLang.t("text_last_hour"):o>=60?n=(t=parseInt(o/60))>1?dexLang.t("text_x_minutes_ago"):dexLang.t("text_last_minute"):(t=0,n=dexLang.t("text_moments_ago")),n=n.replace("{num}",t)},bigNumberFormatForApi:function(e,t){return e.dividedBy(web3.toBigNumber(10).pow(t))},formatForApi:function(e,t){return web3.toBigNumber(e).mul(web3.toBigNumber(10).pow(t)).toFixed()},formatForPage:function(e,t){return t=t||Formatter.ethDecimals,web3.toBigNumber(e).dividedBy(web3.toBigNumber(10).pow(t)).toFixed()},formatForDisplay:function(e,t){return web3.toBigNumber(e).toFormat(t||null,null,{decimalSeparator:".",groupSeparator:",",groupSize:3})},formatBlockTime:function(e){return e.hours.toString().padStart(2,"0")+":"+e.minutes.toString().padStart(2,"0")+":"+e.seconds.toString().padStart(2,"0")}};Formatter.init();var DexToken=function(e,t,n){let a=this;this.address=e,this.name=t.name,this.symbol=t.symbol,this.decimals=t.decimals,this.isBaseToken=t.isBaseToken,this.isQuoteToken=t.isQuoteToken,this.isEnabled=t.isEnabled||!0,this.isDepositEnabled=t.isDepositEnabled||!1,this.ownerAddress=t.ownerAddress,this.isWrapped=t.isWrapped,this.allowance=null,this.wrappedDepositFee=t.wrappedDepositFee,this.wrappedDepositVat=t.wrappedDepositVat,this.wrappedWithdrawalFee=t.wrappedWithdrawalFee,this.wrappedWithdrawalVat=t.wrappedWithdrawalVat;let r=null;this.contract=function(){return null===r&&(r=a.isWrapped?new DexERC20WrappedToken({contractAddress:a.address}):new DexERC20Token({contractAddress:a.address})),r},this.getAllowance=function(e){this.contract().allowance(n.user.selectedAccount.address,a.ownerAddress,function(t,n){t||(a.allowance=Formatter.bigNumberFormatForApi(n,a.decimals),"function"==typeof e&&e())})}};function DexERC20WrappedToken(e){var t=this;this.contract=new DexContract({contractAddress:e.contractAddress,contractAbi:[{constant:!1,inputs:[{name:"spender",type:"address"},{name:"value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"spender",type:"address"},{name:"addedValue",type:"uint256"}],name:"increaseAllowance",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"renounceOwnership",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"isOwner",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"spender",type:"address"},{name:"subtractedValue",type:"uint256"}],name:"decreaseAllowance",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"to",type:"address"},{name:"value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{payable:!0,stateMutability:"payable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!1,name:"_address",type:"address"},{indexed:!1,name:"_value",type:"uint256"},{indexed:!1,name:"_ether",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"_address",type:"address"},{indexed:!1,name:"_value",type:"uint256"}],name:"Withdrawal",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"previousOwner",type:"address"},{indexed:!0,name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{constant:!1,inputs:[{name:"_address",type:"address"},{name:"_value",type:"uint256"},{name:"_ether",type:"uint256"}],name:"deposit",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_address",type:"address"},{name:"_value",type:"uint256"}],name:"withdraw",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"returnEther",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}]}),this.owner=function(e){t.contract.call("owner",[],e)},this.allowance=function(e,n,a){t.contract.call("allowance",[e,n],a)},this.approve=function(e,n,a){t.contract.call("approve",[e,n],a)},this.approveAndCall=function(e,n,a,r){t.contract.call("approveAndCall",[e,n,a],r)},this.balanceOf=function(e,n){t.contract.call("balanceOf",[e],n)},this.totalSupply=function(e){t.contract.call("totalSupply",[],e)},this.transfer=function(e,n,a){t.contract.call("transfer",[e,n],a)},this.transferFrom=function(e,n,a,r){t.contract.call("transferFrom",[e,n,a],r)},this.deposit=function(e,n,a,r){t.contract.call("deposit",[e,n,a],r)},this.withdraw=function(e,n,a){t.contract.call("withdraw",[e,n],a)}}var DexTokenValue=function(e,t,n){let a=this;this.tokenAddress=t,this.decimals=n.tokens[a.tokenAddress].decimals,this.value=Formatter.bigNumberFormatForApi(e,this.decimals),this.toUSD=function(){let e=n.tokenPrices.getUSDPriceByAddress(a.tokenAddress);return!1!==e?this.value.mul(e):0},this.toETH=function(){let e=n.tokenPrices.getETHPriceByAddress(a.tokenAddress);return e?this.value.mul(e):0},this.toCurrentFiat=function(){let e=this.getMultiplier(),t=this.toETH();if(t){return t.mul(e*n.tokenPrices.data.usd[n.helper.ethAddress])*n.fiatPrices.getUsdPriceBySymbol(n.currencySelector.currentCurrency)}return 0},this.toString=function(){return this.value.toString()},this.toFixed=function(){return this.value.toFixed()},this.getMultiplier=function(){let e;return n.selectedBaseToken.address===n.helper.ethAddress?e=1:(e=n.tokenPrices.data.eth[n.selectedBaseToken])||(e=1),e}},DexTemplate=function(e){this.id=e,this.getTemplate=function(){return jQuery("#dex-templates").find("#template-"+this.id).html()},this.content=this.getTemplate(),this.origContent=this.content,this.replace=function(e,t){if("object"==typeof e)for(let t in e)this.content=this.content.replace(new RegExp("{"+t+"}","g"),e[t]);else this.content=this.content.replace(new RegExp(e,"g"),t)},this.reset=function(){this.content=this.origContent},this.hideSection=function(e){let t=jQuery(this.content);t.find("section."+e).remove(),this.content=t.html()}},DexLanguage=function(e){this.data=e,this.t=function(e,t){t=t||{};let n=this.data[e];for(let e in t){let a="{"+e+"}";n=n.replace(new RegExp(a,"g"),t[e])}return n}},DexStorage=function(e){this.prefix=e||"",this.hasLocalStorage=!1,this.hasSessionStorage=!1,this.data={},window.localStorage&&(this.hasLocalStorage=!0),window.sessionStorage&&(this.hasSessionStorage=!0),this.getItem=function(e,t){return e=this.prefix+e,t=void 0!==t?t:null,this.hasLocalStorage?window.localStorage.getItem(e)||t:this.hasSessionStorage?window.sessionStorage.getItem(e)||t:void 0!==this.data[e]?this.data[e]:t},this.setItem=function(e,t){return e=this.prefix+e,this.hasLocalStorage?window.localStorage.setItem(e,t):this.hasSessionStorage?window.sessionStorage.setItem(e,t):void(this.data[e]=t)},this.clear=function(){return this.hasLocalStorage?window.localStorage.clear():this.hasSessionStorage?window.sessionStorage.clear():void(this.data={})},this.removeItem=function(e){return e=this.prefix+e,this.hasLocalStorage?window.localStorage.removeItem(e):this.hasSessionStorage?window.sessionStorage.removeItem(e):void(void 0!==this.data[e]&&delete this.data[e])}},DexHelper=function(e){let t=this;this.controller=e,this.ethAddress="0x0000000000000000000000000000000000000000",this.zeroUserAddress="0x0000000000000000000000000000000000000000",this.trexAddress="0x33d133f175b5cee9aac255448d52394818b76cd0",this.ethDecimals=18,this.defaultSortOptions=JSON.stringify({orderTableBuy:{sortBy:"price",sortOrder:-1},orderTableSell:{sortBy:"price",sortOrder:-1},tradesTable:{sortBy:"time",sortOrder:-1},myOrdersTable:{sortBy:"price",sortOrder:-1},myTradesTable:{sortBy:"time",sortOrder:-1},myFundsTable:{sortBy:"time",sortOrder:-1},myBalanceTable:{sortBy:"token-wallet-balance",sortOrder:-1,secondaryList:{"token-wallet-balance":"token-dex-balance","token-dex-balance":"token-wallet-balance"}},marketTable:{sortBy:"order-count",sortOrder:-1},tickerTable:{sortBy:"bid",sortOrder:-1}}),this.serializeForm=function(e){let t={};return jQuery(e).serializeArray().map(function(e){t[e.name]=e.value}),t},this.closeModal=function(){jQuery("body").find('[data-dismiss="modal"]').trigger("click")},this.clearFormError=function(e){e=e||"body",jQuery(e).find(".has-error").removeClass("has-error"),jQuery(e).find(".help-block").text("")},this.disableFormInputs=function(e){jQuery(e).find(".form-control, .btn").prop("disabled",!0)},this.removeLoading=function(e){e.closest("scroll").removeClass("loading")},this.copyToClipboard=function(e){var t=document.createElement("input");t.style.position="absolute",t.style.left="-9999px",t.setAttribute("readonly",""),t.value=e,document.body.appendChild(t);var n=this.copyFromElementToClipboard(t);return document.body.removeChild(t),n},this.copyFromElementToClipboard=function(e){if(navigator.userAgent.match(/ipad|iphone/i)){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t),e.setSelectionRange(0,999999)}else e.select();return document.execCommand("copy")},this.getRandomEventNamespace=function(){return"."+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)},this.getRandomString=function(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)},this.removeHashFromUri=function(){var e=window.location.toString();if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));window.history.replaceState({},document.title,t)}},this.loginStatusData=!1,this.loginStatusCallCnt=0,this.loginConfirmPopup=function(e){return e=e||[],t.loginStatusCallCnt++,5===t.loginStatusCallCnt&&(t.loginStatusData=!1,t.loginStatusCallCnt=0),!1===t.loginStatusData&&jQuery.ajax({url:"/dex-v2/get-login-status",data:{},dataType:"json",async:!1,success:function(e){t.loginStatusData=e}}),!(t.loginStatusData&&jQuery.inArray(t.loginStatusData.type,e)<=-1)||(swal({title:t.loginStatusData.title,text:t.loginStatusData.text,type:"warning",showCancelButton:!0,confirmButtonColor:"#66004a",confirmButtonText:t.loginStatusData.confirmButtonText,cancelButtonText:t.loginStatusData.cancelButtonText},function(e){e&&(window.location=t.loginStatusData.redirectUrl)}),!1)}},DexEventDispatcher=function(){let e=this,t=[];this.listen=function(e,t){jQuery("body").on(e,t)},this.ignore=function(e){jQuery("body").off(e)},this.trigger=function(t,n){n=n||{},jQuery("body").trigger(t,n),e.checkWaitFor(t,n)},this.waitForAllEvents=function(e,n){t.push([e,n,[]])},this.checkWaitFor=function(e,n){t.forEach(function(a,r){if(void 0!==t[r]){t[r][0].indexOf(e)>=0&&(t[r][0]=t[r][0].filter(function(t){return t!==e}),jQuery.isEmptyObject(n)||t[r][2].push(n),0===t[r][0].length&&(t[r][1].call(null,[t[r][2]]),t=t.filter(function(e){return 0!==e[0].length})))}})}},DexUserAccount=function(e,t,n,a,r){let o=this;n=n||!1,this.address="object"==typeof e?e.address:e,this.metamask=n,this.pk=t,this.allowance=null,this.isNew=a||!1,this.balances={},this.loadBalances=function(){let e=Object.keys(r.tokens);for(let t=0;t<e.length;t+=100){dexEth.defer(!0);let n=e.slice(t,t+100);for(let e=0;e<n.length;e++){let t=n[e];this.balances[t]=new DexBalance(this.address,t,r),this.balances[t].load()}dexEth.defer(!1)}},this.loadBaseTokenBalances=function(){let e=Object.keys(r.baseTokens);for(let t=0;t<e.length;t+=100){dexEth.defer(!0);let n=e.slice(t,t+100);for(let e=0;e<n.length;e++){let t=n[e];this.balances[t]=new DexBalance(this.address,t,r),this.balances[t].load()}dexEth.defer(!1)}},this.loadQuoteTokenBalances=function(){let e=Object.keys(r.quoteTokens);for(let t=0;t<e.length;t+=100){dexEth.defer(!0);let n=e.slice(t,t+100);for(let e=0;e<n.length;e++){let t=n[e];this.balances[t]=new DexBalance(this.address,t,r),this.balances[t].load()}dexEth.defer(!1)}},this.loadWrappedTokenBalances=function(){let e=Object.keys(r.wrappedTokens);for(let t=0;t<e.length;t+=100){dexEth.defer(!0);let n=e.slice(t,t+100);for(let e=0;e<n.length;e++){let t=n[e];this.balances[t]=new DexBalance(this.address,t,r),this.balances[t].load()}dexEth.defer(!1)}},this.refreshAll=function(){this.balances={},this.loadBalances()},this.refreshBalancesForCurrentMarket=function(){this.refreshBalanceByAddress([r.selectedToken.address,r.selectedBaseToken.address])},this.refreshBalanceByAddress=function(e){let t;(t=e instanceof Array?e:new Array(e)).forEach(function(e){o.balances[e]&&o.balances[e].refresh()})},this.toStorage=function(){return{address:o.address,metamask:o.metamask,pk:o.pk,isNew:o.isNew,allowance:o.allowance}}},DexUser=function(e){let t=this;this.controller=e,this.storageKey="DexData",this.accounts={},this.metamaskStatus=!1,this.metamaskInterval=null,this.selectedAccount=null,this.hasAccount=function(){return!jQuery.isEmptyObject(this.accounts)},this.getMetamaskStatus=function(){return web3.currentProvider&&web3.currentProvider.isMetaMask},this.getMetamaskAddress=function(){return this.hasMetamaskAccount()?ethereumjs.Util.toChecksumAddress(web3.eth.accounts[0].toString("hex")):null},this.refreshMetamaskAccounts=function(e){web3.eth.getAccounts(e)},this.hasMetamaskAccount=function(){return web3.currentProvider&&0!==web3.eth.accounts.length},this.storeToStorage=function(){let n={};for(let e in t.accounts){let a=t.accounts[e];n[e]=a.toStorage()}let a={accounts:n};e.storage.setItem(t.storageKey,JSON.stringify(a))},this.createAccount=function(){t.controller.helper.loginConfirmPopup(["address"])&&authenticateUser2fa("add_crypto_address",function(){let e=0,n=0;if(jQuery.ajax({url:"/wallet/default/address-count",type:"post",dataType:"json",async:!1,success:function(t){e=parseInt(t.addressCount),n=parseInt(t.addressLimit)}}),0!==n&&e<n||0===n){var a=keythereum.create().privateKey,r=ethereumjs.Util.privateToAddress(a);r=ethereumjs.Util.toChecksumAddress(r.toString("hex")),a=a.toString("hex"),t.accounts[r]=new DexUserAccount(r,a,!1,!0,t.controller),dexEth.setAccount(r,a),new DexNewAccountRenderer(r,a,t.controller,function(){t.saveAddress(r,"created"),t.storeToStorage()}).render()}else swal({title:dexLang.t("title_error"),text:dexLang.t("text_reached_account_limit"),icon:"error"})})},this.saveAddress=function(e,n){var a=!1;yii.getCsrfParam();t.metamaskStatus=!1;var r=e.substr(2),o=sha256(r.hex2bytes());return dexEth.personalSign(o,function(r,o){if(r)swal({title:dexLang.t("title_error"),text:dexLang.t("errmsg_must_sign"),icon:"error"}),new DexDetectedNewMetamaskAccountRenderer(t.controller,t.getMetamaskAddress()).render();else{var s=o.substr(2,64),i=o.substr(66,64),l=web3.toDecimal("0x"+o.substr(130));jQuery.ajax({url:t.controller.saveAddressUrl,type:"post",dataType:"json",async:!1,data:{csrfParam:yii.getCsrfToken(),address:e,r:s,s:i,v:l,type:n},success:function(e){e.result?(jQuery.pjax.reload({container:"#user-account-pjax",url:window.location.pathname}),a=!0):swal({title:dexLang.t("title_error"),text:e.message,icon:"error"}),t.metamaskStatus=!1}})}}),a},this.deleteAddress=function(e){yii.getCsrfParam();jQuery.ajax({url:t.controller.deleteAddressUrl,type:"post",dataType:"json",async:!1,data:{csrfParam:yii.getCsrfToken(),address:e},success:function(e){e.result?jQuery.pjax.reload({container:"#user-account-pjax",url:window.location.pathname}):swal({title:dexLang.t("title_error"),text:e.message,icon:"error"})}})},this.changeAccount=function(e){t.selectedAccount=t.accounts[e]?t.accounts[e]:null,t.selectedAccount&&dexEth.setAccount(t.selectedAccount.address,t.selectedAccount.pk)},this.importAccount=function(){t.controller.helper.loginConfirmPopup(["address"])&&authenticateUser2fa("add_crypto_address",function(){new Modal({title:dexLang.t("title_import_account"),content:new DexImportAccountFormRenderer(t.controller,function(){new Modal({title:dexLang.t("title_address_added"),content:new DexTemplate("address-added").content})}).render()})})},this.forgetAccount=function(e){t.controller.helper.loginConfirmPopup(["address"])&&authenticateUser2fa("delete_crypto_address",function(){new Modal({title:dexLang.t("title_forget_acc"),content:new DexForgetAccountRenderer(t.controller,e).render()})})},this.doForgetAccount=function(e){delete this.accounts[e],this.storeToStorage(),this.deleteAddress(e)},this.watchLoggedMetamask=!1,this.watchMetamaskAccountChange=function(){this.metamaskStatus&&(clearInterval(this.metamaskInterval),this.metamaskInterval=setInterval(function(){t.refreshMetamaskAccounts(function(){t.hasMetamaskAccount()?(t.watchLoggedMetamask&&(t.controller.helper.closeModal(),t.watchLoggedMetamask=!1,void 0!==t.controller.withdrawController&&t.controller.withdrawController.container.show()),web3.eth.accounts.forEach(function(e){e=ethereumjs.Util.toChecksumAddress(e.toString("hex")),void 0===t.accounts[e]&&new DexDetectedNewMetamaskAccountRenderer(t.controller,e).render()})):(t.watchLoggedMetamask=!0,new Modal({title:dexLang.t("title_important"),content:dexLang.t("text_metamask_init"),unClosable:!0}),void 0!==t.controller.withdrawController&&t.controller.withdrawController.container.hide())})},1e3))};let n=e.storage.getItem(this.storageKey);null!==n&&(n=JSON.parse(n));for(let e in t.controller.initialAccounts){let a=null,r=t.controller.initialAccounts[e];null!==n&&void 0!==n.accounts[e]&&(a=n.accounts[e].pk),t.accounts[e]=new DexUserAccount(e,a,r.metamask,!1,t.controller)}web3.currentProvider&&web3.currentProvider.isMetaMask&&(this.metamaskStatus=!0,this.hasMetamaskAccount()?web3.eth.accounts.forEach(function(e){e=ethereumjs.Util.toChecksumAddress(e.toString("hex")),void 0!==t.accounts[e]?t.accounts[e]=new DexUserAccount(e,null,!0,!0,t.controller):new DexDetectedNewMetamaskAccountRenderer(t.controller,e).render()}):new DexDetectedMetamaskRenderer(t.controller).render(),web3.version.getNetwork((e,n)=>{n=parseInt(n),"csr.live"===window.location.host&&1!==n?t.showNetworkAlert(n,1):"csr.live"!==window.location.host&&3!==n&&t.showNetworkAlert(n,3)}),this.watchMetamaskAccountChange()),this.showNetworkAlert=function(e,t){$.getJSON("https://chainid.network/chains.json",function(n){let a=targetNetwork=dexLang.t("text_unknown_network");for(let r in n)n[r].chainId==e&&(a=n[r].name),n[r].chainId==t&&(targetNetwork=n[r].name);new Modal({title:dexLang.t("title_error"),content:dexLang.t("text_wrong_network",{currentNetwork:'<span class="text-danger"><strong>'+a+"</strong></span>",targetNetwork:'<span class="text-success"><strong>'+targetNetwork+"</strong></span>"})})})},this.storeToStorage(),jQuery("body").on("click",".action-new-account",function(){t.createAccount()}),jQuery("body").on("click",".action-import-account",function(){t.importAccount()}),jQuery("body").on("click",".action-forget-account",function(){let e=jQuery(this).data("addr");t.forgetAccount(e)}),t.initDropDowns=function(){jQuery("#address-table-container").find(".action-show-pk, .action-delete-pk").map(function(e,n){let a=jQuery(n),r=a.data("addr");t.accounts[r]&&t.accounts[r].pk||a.hide()}),jQuery("#address-table-container").find(".action-import-pk").map(function(e,n){let a=jQuery(n),r=a.data("addr");t.accounts[r]&&!t.accounts[r].pk||a.hide()})},$(document).on("pjax:complete",function(){t.initDropDowns()}),t.initDropDowns(),jQuery("body").on("click",".action-delete-pk",function(){let e=jQuery(this),n=e.data("addr");t.accounts[n]&&t.accounts[n].pk&&(t.accounts[n].pk=null,e.hide(),e.parents("tr").find(".action-show-pk").hide(),e.parents("tr").find(".action-import-pk").show(),t.storeToStorage(),swal({title:dexLang.t("title_goodjob"),text:dexLang.t("text_pk_deleted"),icon:"success"}))}),jQuery("body").on("click",".action-show-pk",function(){let e=jQuery(this).data("addr");if(t.accounts[e]&&t.accounts[e].pk){let n=new DexTemplate("show-account-pk-popup");n.replace({address:e,privateKey:t.accounts[e].pk}),new Modal({title:dexLang.t("title_private_key"),content:n.content})}}),jQuery("body").on("click",".action-import-pk",function(){let e=jQuery(this),n=e.data("addr");t.accounts[n]&&!t.accounts[n].pk&&new DexImportAccountPkFormRenderer(t.controller,n,function(){t.controller.helper.closeModal(),e.hide(),e.parents("tr").find(".action-show-pk").show(),e.parents("tr").find(".action-delete-pk").show(),swal({title:dexLang.t("title_goodjob"),text:dexLang.t("text_pk_imported"),icon:"success"})}).render()})},DexForm=function(e,t){let n=this;this.form=e instanceof jQuery?e:jQuery(e),this.defaults={},this.rules=t,this.allInputs=this.form.find("input, textarea, select"),this.allInputs.each(function(e,t){let a=n.form.attr("id")+"-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,8);void 0===t.id?t.id=a:a=t.id,n.defaults[a]=t.value}),this.setInputChanged=function(){n.allInputs.each(function(e,t){let a=jQuery(t);a.hasClass("changed")||n.defaults[t.id]!==t.value&&a.addClass("changed")})},this.validate=function(e){let t;return e=e||!1,t=new DexFormValidator(this.rules,e?this.serializeForm():this.serializeChangedForm()),this.clearFormError(),!!t.validate()||(new DexFormErrorRenderer(t.getErrors(),this.form).render(),!1)},this.serializeChangedForm=function(){this.setInputChanged();let e={};return this.form.serializeArray().map(function(t){jQuery(t).hasClass("changed")&&(e[t.name]=t.value)}),e},this.serializeForm=function(){let e={};return this.form.serializeArray().map(function(t){e[t.name]=t.value}),e},this.clearFormError=function(){this.form.find(".has-error").removeClass("has-error"),this.form.find(".help-block").text("")},this.disableFormInputs=function(){this.form.find(".form-control, .btn").prop("disabled",!0)}},DexFormValidator=function(e,t){let n=this;this.errors={},this.requiredFields=[],this.validate=function(){return jQuery(e).each(function(e,t){let a=t[0];"required"===t[1]&&(a instanceof Array?a.forEach(function(e){n.requiredFields.push(e)}):n.requiredFields.push(a))}),jQuery(e).each(function(e,t){let a=t[0],r=t[1],o=t[2];a instanceof Array?a.forEach(function(e){n.validateField(e,r,o)}):n.validateField(a,r,o)}),jQuery.isEmptyObject(this.errors)},this.validateField=function(e,a,r){let o=jQuery.inArray(e,n.requiredFields)>-1,s=t[e];if(void 0!==t[e]&&(o||!o&&""!==s))if("function"==typeof a)a(s)||(n.errors[e]=r);else if("string"==typeof a)n[a](s)||(n.errors[e]=r);else{let t=a.validatorName,o=a.params;n[t](s,o)||void 0===n.errors[e]&&(n.errors[e]=r)}},this.getErrors=function(){return n.errors},this.number=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},this.address=function(e){return!!/^0x[0-9a-fA-F]{40}$/i.test(e)},this.privateKey=function(e){return!!/^(0x)?[0-9a-f]{64}$/i.test(e)},this.integer=function(e){return/^\+?(0|[1-9]\d*)$/.test(e)},this.lower=function(e,t){return parseFloat(e)<parseFloat(t.value)},this.lowerEqual=function(e,t){return parseFloat(e)<=parseFloat(t.value)},this.greater=function(e,t){return parseFloat(e)>parseFloat(t.value)},this.greaterEqual=function(e,t){return parseFloat(e)>=parseFloat(t.value)},this.equal=function(e,t){return e===t.value},this.in=function(e,t){return jQuery.inArray(e,t)>-1},this.required=function(e){return""!==e}},DexFormErrorRenderer=function(e,t){this.container=t instanceof jQuery?t:jQuery(t),this.render=function(){for(let t in e){let n=this.container.find('[name="'+t+'"]'),a=(n=jQuery(n)).closest(".form-group");a.addClass("has-error"),a.find(".help-block").text(e[t])}}},DexWithdrawController=function(e){let t=this;t.controller=e,t.controller.hideNullBalances=!1,t.container=jQuery("#withdraw-container"),t.container.show(),t.accountSelect=t.container.find(".withdraw-account-select"),t.amountInput=t.container.find(".withdraw-amount-input"),t.coinSelect=t.container.find(".withdraw-coin-select"),t.typeSelect=t.container.find(".withdraw-type-select"),t.balanceContainer=t.container.find(".withdraw-balance-container"),t.activeForm=jQuery("#withdraw-active-form"),t.account=null,t.token=null,this.allEvents=[];for(let e in t.controller.wrappedTokens)this.allEvents.push("balanceRendered"+e);t.accountSelect.on("change",function(){let e=jQuery(this).val();void 0!==t.controller.user.accounts[e]?(t.account=t.controller.user.accounts[e],null===t.account.pk&&!1===t.account.metamask?t.controller.eventDispatcher.trigger("empty-account-pk"):(t.controller.user.changeAccount(e),t.controller.eventDispatcher.trigger("withdraw-form-changed"))):jQuery(this).val("")}),t.coinSelect.on("change",function(){jQuery(this);let e=jQuery(this).find("option:selected").data("address");void 0!==t.controller.tokens[e]&&(t.token=t.controller.tokens[e],jQuery(".fee-amount").html(t.token.wrappedWithdrawalFee)),t.toggleNote(),t.toggleReferenceAddressInput(),t.controller.eventDispatcher.trigger("withdraw-form-changed")}),t.toggleNote=function(){jQuery.inArray(t.coinSelect.val(),WRAPPED_FIAT)>-1?(jQuery(".note-container").show(),t.amountInput.trigger("keyup")):jQuery(".note-container").hide()},t.toggleNote(),t.toggleReferenceAddressInput=function(){jQuery.inArray(t.coinSelect.val(),WRAPPED_CRYPTO)>-1?(jQuery("#reference_address_container").show(),jQuery("#reference_address_container").find(".hint-block").text(dexLang.t("text_address_validation_txt",{symbol:WRAPPED_TYPE_DATA[t.coinSelect.val()].symbolOriginal}))):jQuery("#reference_address_container").hide()},t.toggleReferenceAddressInput(),t.typeSelect.on("change",function(){t.toggleCustomInputs()}),t.toggleCustomInputs=function(){t.container.find(".custom-inputs").hide(),t.typeSelect.val()&&t.container.find(".custom-inputs."+t.typeSelect.val()).show()},t.toggleCustomInputs(),t.amountInput.on("keyup",function(){let e=parseFloat(t.amountInput.val()),n=0;isNaN(e)&&(e=0),null!==t.token&&(n=e-t.token.wrappedWithdrawalFee),n<0&&(n=0),jQuery(".get-amount").text(n)}),t.controller.eventDispatcher.listen("empty-account-pk",function(){new DexImportAccountPkFormRenderer(t.controller,t.account.address,function(){t.controller.helper.closeModal(),t.controller.eventDispatcher.trigger("withdraw-form-changed")}).render()}),t.controller.eventDispatcher.listen("withdraw-form-changed",function(){t.account&&(t.refreshWrappedBalances(),t.account.loadWrappedTokenBalances())}),this.refreshWrappedBalances=function(){this.controller.eventDispatcher.waitForAllEvents(this.allEvents,function(){t.controller.eventDispatcher.trigger("wrapped-balances-refreshed")})},t.controller.eventDispatcher.listen("wrapped-balances-refreshed",function(){let e=t.coinSelect.find("option:selected").data("address");void 0!==e&&(jQuery("#myBalanceContainer .account-balance").hide(),jQuery('#myBalanceContainer [data-token-address="'+e+'"]').show())}),t.activeForm.on("beforeValidateAttribute",function(e){if(null!==t.token&&null!==t.account){let e=t.account.balances[t.token.address],n=parseFloat(e.wallet.toFixed());t.activeForm.yiiActiveForm("find","userwithdrawform-amount").validate=function(e,t,a,r,o){t=Formatter.sanitizeInputNumber(t),yii.validation.required(t,a,{message:"Amount cannot be blank."}),yii.validation.number(t,a,{pattern:/^\s*[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/,message:"Amount must be a number.",max:n,tooBig:"Amount must be lower than your balance!",skipOnEmpty:1})}}}),t.activeForm.on("beforeValidate",function(){return!!t.controller.helper.loginConfirmPopup()}),t.activeForm.on("beforeSubmit.checkAuthentication",function(){return t.controller.helper.loginConfirmPopup()&&authenticateUser2fa("withdraw_wrapped_coin",function(){t.activeForm.off("beforeSubmit.checkAuthentication"),t.activeForm.on("beforeSubmit.checkAllowance",function(){let e=Formatter.formatForApi(t.amountInput.val(),t.token.decimals),n=!1,a=!1;new Modal({title:dexLang.t("title_processing"),content:new DexTemplate("processing-popup").content});var r=t.token.contract();let o=function(){t.token.allowance.toNumber()>=parseFloat(t.amountInput.val())||n&&a?(t.activeForm.off("beforeSubmit.checkAllowance"),t.activeForm.submit()):!n&&t.checkMetamaskUser(t.accountSelect.val())?(n=!0,r.owner(function(n,s){n||r.approve(s,e,function(e,n){e||(a=!0,setTimeout(function(){t.token.getAllowance(o)},1e3))})})):setTimeout(function(){t.token.getAllowance(o)},1e3)};return t.token.getAllowance(o),!1}),t.activeForm.submit()}),!1}),t.checkMetamaskUser=function(e){let n,a=t.controller.user;if(void 0!==a.accounts[e]&&(n=a.accounts[e]).metamask){if(!a.getMetamaskStatus())return swal({title:dexLang.t("title_warning"),text:dexLang.t("text_enable_metamask"),icon:"warning"}),!1;if(a.getMetamaskAddress()!==n.address)return swal({title:dexLang.t("title_warning"),text:dexLang.t("text_change_account_metamask",{account:n.address}),icon:"warning"}),!1}return!0}},DexViewBalancesController=function(e){let t=this;this.controller=e,this.addressSelect=jQuery("#address-select"),this.addressTypeSelect=jQuery("#address-type-select"),this.refreshBalances=function(){var e=this.addressSelect.val();t.controller.user.changeAccount(e),null!==t.controller.user.selectedAccount&&("quote"===t.addressTypeSelect.val()?t.controller.user.selectedAccount.loadQuoteTokenBalances():t.controller.user.selectedAccount.loadBalances())},this.addressSelect.length>0&&this.refreshBalances(),this.addressSelect.on("change",function(){t.controller.balanceRenderer.container.html(""),t.controller.eventDispatcher.trigger("account-change"),t.refreshBalances()}),this.addressTypeSelect.on("change",function(){t.controller.balanceRenderer.container.html(""),t.refreshBalances()}),setInterval(function(){t.controller.balanceRenderer.refreshAll(),t.controller.balanceRenderer.container.find(".refresh-balance").addClass("rotating"),t.refreshBalances()},5e3),jQuery("body").on("click.go-to-etherscan",".go-to-etherscan",function(){var e=t.addressSelect.val();window.open("https://etherscan.io/address/"+e,"_blank")})};const GASSETTYPE_AUTOMATIC="automatic",GASSETTYPE_MANUAL="manual",GASTYPE_SAFELOW="safelow",GASTYPE_STANDARD="standard",GASTYPE_FAST="fast",GASTYPE_FASTEST="fastest";var DexGasApi=function(e){let t=this;this.controller=e,this.apiUrl="https://ethgasstation.info/json/ethgasAPI.json",this.standard=null,this.fast=null,this.safelow=null,this.block_time=null,this.fastestWait=null,this.fastWait=null,this.safeLowWait=null,this.blockNum=null,this.avgWait=null,this.speed=null,this.fastest=null,this.blockTimeStack=[];let n=JSON.stringify({gasSetType:"automatic",gasType:"fastest",gasPrice:4e9,gasMultiplier:1});this.settings=JSON.parse(this.controller.storage.getItem("userGasSettings",n)),this.load=function(e){e=e||function(){},jQuery.ajax({dataType:"json",url:this.apiUrl,data:{},async:!1,success:function(n){n&&(t.standard=web3.toWei(n.average/10,"gwei"),t.safelow=web3.toWei(n.safeLow/10,"gwei"),t.fast=web3.toWei(n.fast/10,"gwei"),t.fastest=web3.toWei(n.fastest/10,"gwei"),t.fastestWait=n.fastestWait,t.fastWait=n.fastWait,t.safeLowWait=n.safeLowWait,t.blockNum=n.blockNum,t.avgWait=n.avgWait,t.speed=n.speed,dexEth.gasPrice="manual"===t.settings.gasSetType?t.settings.gasPrice:t[t.settings.gasType],dexEth.gasMultiplier=t.settings.gasMultiplier,"function"==typeof e&&e())}})},this.getGasPrice=function(){return"manual"===t.settings.gasSetType?t.settings.gasPrice:(this.load(),t[t.settings.gasType])},this.load()},DexUserController=function(e){let t=this;this.isDev=e.isDev||!1,this.saveAddressUrl=e.saveAddressUrl||!1,this.deleteAddressUrl=e.deleteAddressUrl||!1,this.initialAccounts=e.initialAccounts||null,this.authenticatorEnabled=e.authenticatorEnabled||!1,this.helper=new DexHelper(this),this.storage=new DexStorage("Dex"),this.eventDispatcher=new DexEventDispatcher,this.hideNullBalances=!0,this.tokens={},this.baseTokens={},this.quoteTokens={},this.wrappedTokens={},this.symbolToAddr={};for(let t in e.tokens)this.tokens[t]=new DexToken(t,e.tokens[t],this),this.symbolToAddr[this.tokens[t].symbol]=t,this.tokens[t].isBaseToken&&(this.baseTokens[t]=this.tokens[t]),this.tokens[t].isQuoteToken&&(this.quoteTokens[t]=this.tokens[t]),this.tokens[t].isWrapped&&(this.wrappedTokens[t]=this.tokens[t]);this.gasApi=new DexGasApi(this),this.balanceRenderer=new DexMyBalanceRenderer(this),this.user=new DexUser(this),this.dexVault=dexVault,this.balanceRenderer.render(),jQuery("body").off("click.copyText"),jQuery("body").on("click.copyText","[data-copy-text]",function(e){e.stopPropagation();let n=jQuery(this),a=n.data("copy-text"),r=t.helper.getRandomString();n.after('<input id="'+r+'">');let o=jQuery("#"+r);o.css({position:"absolute",left:-9999}),o.val(a),t.helper.copyFromElementToClipboard(o[0]),o.remove(),n.next().find(".tooltip-inner").text("Copied!")}),jQuery("#view-balances-container").length>0&&(this.viewBalancesController=new DexViewBalancesController(this)),jQuery("#withdraw-container").length>0&&(this.withdrawController=new DexWithdrawController(this))};